# 1.webçš„åŸºæœ¬æ¦‚å¿µ

## 1.1å‰è¨€

webå¼€å‘ï¼š

- webï¼Œç½‘é¡µçš„æ„æ€

- é™æ€web

  - htmlã€css
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼

- åŠ¨æ€web

  - æ·˜å®ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰çš„ç½‘ç«™ã€‚
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªäººåœ¨ä¸åŒçš„æ—¶é—´ï¼Œä¸åŒçš„åœ°ç‚¹çœ‹åˆ°çš„ä¿¡æ¯å„ä¸ç›¸åŒã€‚
  - æŠ€æœ¯æ ˆï¼šservlet/JSPï¼ŒASPï¼ŒPHP

  

  åœ¨javaä¸­ï¼ŒåŠ¨æ€webèµ„æºå¼€å‘çš„æŠ€æœ¯ç»Ÿç§°ä¸ºJavaWeb

## 1.2webåº”ç”¨ç¨‹åº

webåº”ç”¨ç¨‹åºï¼šå¯ä»¥æä¾›æµè§ˆå™¨è®¿é—®çš„ç¨‹åº

- a.html ã€b.html ... å¤šä¸ªwebèµ„æºï¼Œè¿™äº›webèµ„æºå¯ä»¥è¢«å¤–ç•Œè®¿é—®ï¼Œå¯¹å¤–ç•Œæä¾›æœåŠ¡ã€‚
- ä½ èƒ½è®¿é—®åˆ°çš„ä»»ä½•ä¸€ä¸ªé¡µé¢æˆ–è€…èµ„æºï¼Œéƒ½å­˜åœ¨äºè¿™ä¸ªä¸–ç•Œçš„æŸä¸€ä¸ªè§’è½çš„è®¡ç®—æœºä¸Šã€‚
- URL
- è¿™ä¸ªç»Ÿä¸€çš„webèµ„æºä¼šè¢«æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œwebåº”ç”¨ç¨‹åº-->tomcat:æœåŠ¡å™¨
- ä¸€ä¸ªwebåº”ç”¨ç”±å¤šéƒ¨åˆ†ç»„æˆï¼ˆé™æ€webï¼ŒåŠ¨æ€webï¼‰
  - html,css,js
  - jsp,servlet
  - javaç¨‹åº
  - jaråŒ…
  - é…ç½®æ–‡ä»¶ï¼ˆPropertiesï¼‰

webåº”ç”¨ç¼–å†™å®Œæ¯•åï¼Œè‹¥æƒ³æä¾›ç»™å¤–ç•Œè®¿é—®ï¼Œéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨æ¥ç»Ÿä¸€ç®¡ç†ã€‚

## 1.3é™æ€web

- `*.htm,*.html`è¿™äº›éƒ½æ˜¯ç½‘é¡µçš„åç¼€ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šä¸€ç›´å­˜åœ¨è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿›è¡Œè¯»å–ã€‚
- é™æ€webå­˜åœ¨ç¼ºç‚¹
  - webé¡µé¢æ— æ³•åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°éƒ½æ˜¯åŒä¸€ä¸ªé¡µé¢
    - è½®æ’­å›¾ï¼Œç‚¹å‡»ç‰¹æ•ˆï¼šä¼ªåŠ¨æ€
    - JavaScriptã€å®é™…å¼€å‘ä¸­ï¼Œå®ƒç”¨çš„æœ€å¤šã€‘
    - VBScript
  - å®ƒæ— æ³•å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æ— æ³•æŒä¹…åŒ–ï¼Œç”¨æˆ·æ— æ³•äº¤äº’ï¼‰

## 1.4åŠ¨æ€web

é¡µé¢ä¼šåŠ¨æ€å±•ç¤ºï¼šwebçš„é¡µé¢å±•ç¤ºçš„æ•ˆæœå› äººè€Œå¼‚

ç¼ºç‚¹ï¼š

- å‡å¦‚æœåŠ¡å™¨çš„åŠ¨æ€èµ„æºå‡ºç°äº†é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç¼–å†™æˆ‘ä»¬çš„åå°ç¨‹åºï¼Œé‡æ–°å‘å¸ƒã€‚
  - åœæœºç»´æŠ¤

ä¼˜ç‚¹ï¼š

- webé¡µé¢å¯ä»¥åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥çœ‹åˆ°ä¸åŒçš„é¡µé¢
- å®ƒå¯ä»¥ä¸æ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰

# 2.webæœåŠ¡å™¨è®²è§£

## 2.1æŠ€æœ¯è®²è§£

**ASP:**

- å¾®è½¯ï¼šå›½å†…æœ€æ—©æµè¡Œçš„å°±æ˜¯ASP
- åœ¨htmlä¸­åµŒå…¥äº†VBçš„è„šæœ¬ï¼ŒASP+COM
- åœ¨ASPå¼€å‘ä¸­ï¼ŒåŸºæœ¬ä¸€ä¸ªé¡µé¢éƒ½æ˜¯å‡ åƒè¡Œçš„ä¸šåŠ¡ä»£ç ï¼Œé¡µé¢æå…¶ä¹±
- ç»´æŠ¤æˆæœ¬é«˜
- C# 
- IIS



**PHP:**

- PHPå¼€å‘é€Ÿåº¦å¾ˆå¿«ï¼ŒåŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œè·¨å¹³å°ï¼Œä»£ç å¾ˆç®€å•
- æ— æ³•æ‰¿è½½å¤§è®¿é—®é‡çš„æƒ…å†µï¼ˆå±€é™æ€§ï¼‰



**JSP/Servlet:**

B/S:æµè§ˆå™¨å’ŒæœåŠ¡å™¨

C/S:å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨

- sunå…¬å¸ä¸»æ¨çš„B/Sæ¶æ„
- åŸºäºjavaè¯­è¨€çš„ï¼ˆæ‰€æœ‰çš„å¤§å…¬å¸ï¼Œæˆ–è€…ä¸€äº›å¼€æºçš„ç»„ä»¶ï¼Œéƒ½æ˜¯ç”¨javaå†™çš„ï¼‰
- å¯ä»¥æ‰¿è½½ä¸‰é«˜ï¼ˆé«˜å¹¶å‘ã€é«˜å¯ç”¨ã€é«˜æ€§èƒ½ï¼‰é—®é¢˜å¸¦æ¥çš„å½±å“
- è¯­æ³•åƒASP



## 2.2webæœåŠ¡å™¨

æœåŠ¡å™¨æ˜¯ä¸€ç§**è¢«åŠ¨**çš„æ“ä½œï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„ä¸€äº›è¯·æ±‚å’Œç»™ç”¨æˆ·ä¸€äº›å“åº”ä¿¡æ¯

**IIS**

å¾®è½¯çš„   windowsä¸­è‡ªå¸¦çš„

**Tomcat**

Tomcatæ˜¯Apache è½¯ä»¶åŸºé‡‘ä¼šï¼ˆApache Software Foundationï¼‰çš„Jakarta é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼Œæœ€æ–°çš„Servlet å’ŒJSP è§„èŒƒæ€»æ˜¯èƒ½åœ¨Tomcat ä¸­å¾—åˆ°ä½“ç°ã€‚å› ä¸ºTomcat æŠ€æœ¯å…ˆè¿›ã€æ€§èƒ½ç¨³å®šï¼Œè€Œä¸”å…è´¹ï¼Œå› è€Œæ·±å—Java çˆ±å¥½è€…çš„å–œçˆ±å¹¶å¾—åˆ°äº†éƒ¨åˆ†è½¯ä»¶å¼€å‘å•†çš„è®¤å¯ï¼Œæˆä¸ºç›®å‰æ¯”è¾ƒæµè¡Œçš„Web åº”ç”¨æœåŠ¡å™¨ã€‚

Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨ä¸­å°å‹ç³»ç»Ÿå’Œå¹¶å‘è®¿é—®ç”¨æˆ·ä¸æ˜¯å¾ˆå¤šçš„åœºåˆä¸‹è¢«æ™®éä½¿ç”¨ï¼Œæ˜¯å¼€å‘å’Œè°ƒè¯•JSP ç¨‹åºçš„é¦–é€‰ã€‚å¯¹äºä¸€ä¸ªjavaåˆå­¦webçš„äººæ¥è¯´ï¼Œå®ƒæ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚

è¯€çªæ˜¯ï¼Œå½“é…ç½®æ­£ç¡®æ—¶ï¼ŒApache ä¸ºHTMLé¡µé¢æœåŠ¡ï¼Œè€ŒTomcat å®é™…ä¸Šè¿è¡ŒJSP é¡µé¢å’ŒServletã€‚



**å·¥ä½œ3-5å¹´ä¹‹åï¼Œå¯ä»¥å°è¯•æ‰‹å†™tomcatæœåŠ¡å™¨ã€‚**



ä¸‹è½½tomcat:

1. å®‰è£… or è§£å‹
2. äº†è§£é…ç½®æ–‡ä»¶åŠç›®å½•ç»“æ„
3. è¿™ä¸ªä¸œè¥¿çš„ä½œç”¨



# 3.tomcatè¯¦è§£

## 3.1å®‰è£…tomcat

å®˜ç½‘ï¼šhttps://tomcat.apache.org/

![image-20210817215536281](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210817215536281.png)

è§£å‹

![image-20210817215611861](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210817215611861.png)

## 3.2tomcatå¯åŠ¨å’Œé…ç½®

![image-20210817220006987](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210817220006987.png)

**å¯åŠ¨ï¼Œå…³é—­tomcat**

![image-20210817220257077](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210817220257077.png)

è®¿é—®æµ‹è¯•ï¼šhttp://localhost:8080/

å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š

1. javaç¯å¢ƒå˜é‡æ²¡æœ‰é…ç½®
2. é—ªé€€é—®é¢˜ï¼šéœ€è¦é…ç½®å…¼å®¹æ€§
3. ä¹±ç é—®é¢˜ï¼šé…ç½®æ–‡ä»¶ä¸­è®¾ç½®

## 3.3é…ç½®

![image-20210817220627007](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210817220627007.png)

å¯ä»¥é…ç½®å¯åŠ¨çš„ç«¯å£å·

- tomcatçš„é»˜è®¤ç«¯å£ä¸ºï¼š8080

- mysqlé»˜è®¤ç«¯å£ï¼š3306

- httpé»˜è®¤ç«¯å£ï¼š80

- httpsé»˜è®¤ç«¯å£ï¼š443

  ```xml
      <Connector port="8080" protocol="HTTP/1.1"
                 connectionTimeout="20000"
                 redirectPort="8443" />
  ```

  

å¯ä»¥é…ç½®ä¸»æœºçš„åç§°

- é»˜è®¤çš„ä¸»æœºåä¸ºï¼šlocalhost --- 127.0.0.1
- é»˜è®¤ç½‘ç«™åº”ç”¨å­˜æ”¾çš„ä½ç½®ä¸ºwebapps

```xml
      <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
```

**é«˜éš¾åº¦é¢è¯•é¢˜ï¼š**

è¯·ä½ è°ˆè°ˆç½‘ç«™æ˜¯å¦‚ä½•è¿›è¡Œè®¿é—®çš„?

1. è¾“å…¥ä¸€ä¸ªåŸŸåï¼›å›è½¦
2. æ£€æŸ¥æœ¬æœºçš„é…ç½®æ–‡ä»¶C:\Windows\System32\drivers\etc\hostsä¸‹æœ‰æ²¡æœ‰è¿™ä¸ªåŸŸåçš„æ˜ å°„
   1. æœ‰ï¼šç›´æ¥è¿”å›å¯¹åº”çš„ipåœ°å€,è¿™ä¸ªåœ°å€ä¸­ï¼Œæœ‰æˆ‘ä»¬éœ€è¦æ”¾çš„webç¨‹åºï¼Œå¯ä»¥ç›´æ¥è®¿é—®
   2. æ²¡æœ‰ï¼šå»DNSæœåŠ¡å™¨æ‰¾ï¼Œæ‰¾åˆ°çš„è¯å°±è¿”å›ï¼Œæ‰¾ä¸åˆ°å°±è¿”å›æ‰¾ä¸åˆ°



4.å¯ä»¥é…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰é¡¹ï¼‰

## 3.4å‘å¸ƒä¸€ä¸ªwebç½‘ç«™

ä¸ä¼šå°±å…ˆæ¨¡ä»¿

- å°†è‡ªå·±å†™çš„ç½‘ç«™ï¼Œæ”¾åˆ°æœåŠ¡å™¨ï¼ˆtomcatï¼‰ä¸­æŒ‡å®šçš„webåº”ç”¨çš„æ–‡ä»¶å¤¹ï¼ˆwebappsï¼‰ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®äº†

ç½‘ç«™åº”è¯¥æœ‰çš„ç»“æ„

- webapps : tomcatæœåŠ¡å™¨çš„webç›®å½•
  - ROOT
  - kuangstudy : ç½‘ç«™çš„ç›®å½•å
    - WEB-INF
      - classes : javaç¨‹åº
      - lib ï¼š webåº”ç”¨æ‰€ä¾èµ–çš„jaråŒ…
      - web.xml ï¼š ç½‘ç«™é…ç½®æ–‡ä»¶
    - index.html ï¼š é»˜è®¤çš„é¦–é¡µ
    - static
      - css
        - style.css
      - js
      - img
    - ...

# 4.httpè¯¦è§£

## 4.1ä»€ä¹ˆæ˜¯HTPP

è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyper Text Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚

- æ–‡æœ¬ï¼šhtml,å­—ç¬¦ä¸²...
- è¶…æ–‡æœ¬ï¼šå›¾ç‰‡ï¼ŒéŸ³ä¹ï¼Œè§†é¢‘ï¼Œå®šä½ï¼Œåœ°å›¾....
- 80



HTTPSï¼šå®‰å…¨çš„

- 443



## 4.2ä¸¤ä¸ªæ—¶ä»£

- http1.0
  - HTTP/1.0 : å®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œåªèƒ½è·å¾—ä¸€ä¸ªwebèµ„æºï¼Œæ–­å¼€è¿æ¥
- http2.0
  - HTTP/1.1ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œå¯ä»¥è·å¾—å¤šä¸ªwebèµ„æºã€‚

## 4.3Httpè¯·æ±‚

- å®¢æˆ·ç«¯---å‘é€è¯·æ±‚ï¼ˆRequestï¼‰--æœåŠ¡å™¨

ç™¾åº¦ï¼š

```java
Request URL: https://www.baidu.com/    è¯·æ±‚åœ°å€
Request Method: GET     getæ–¹æ³•/postæ–¹æ³•
Status Code: 200 OK     çŠ¶æ€ç ï¼š200
Remote Address: 14.215.177.38:443
```

```java
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cache-Control: no-cache
Connection: keep-alive
Cookie: BIDUPSID=E915D8DAC0FCA4159DF81414176EBD43; PSTM=1618281055; BAIDUID=E915D8DAC0FCA415F0B2ABB582D30135:FG=1; __yjs_duid=1_042d578ea86bfb698f35ffbf7e97f5ff1619488718760; BAIDUID_BFESS=E915D8DAC0FCA415F0B2ABB582D30135:FG=1; COOKIE_SESSION=16414_3_8_4_7_1_1_0_7_1_0_0_16416_0_3_0_1625410778_1625394325_1625410775%7C9%2379260_3_1625394323%7C2; BD_LAST_QID=9581266030928333830
Host: www.baidu.com
```

### 1.è¯·æ±‚è¡Œ

- è¯·æ±‚è¡Œä¸­çš„è¯·æ±‚æ–¹å¼ï¼šGET
- è¯·æ±‚æ–¹å¼ï¼š**GET,POST,**HEAD,DELETE,PUT,TRACT...
  - get:è¯·æ±‚èƒ½å¤Ÿæºå¸¦çš„å‚æ•°æ¯”è¾ƒå°‘ï¼Œå¤§å°æœ‰é™åˆ¶ï¼Œä¼šåœ¨æµè§ˆå™¨çš„URLåœ°å€æ‹¦æ˜¾ç¤ºæ•°æ®å†…å®¹ï¼Œä¸å®‰å…¨ï¼Œä½†æ˜¯é«˜æ•ˆ
  - postï¼šè¯·æ±‚èƒ½éƒ½æºå¸¦çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œå¤§å°æ²¡æœ‰é™åˆ¶ï¼Œä¸ä¼šå†åœ¨æµè§ˆå™¨çš„URLåœ°å€æ‹¦æ˜¾ç¤ºæ•°æ®å†…å®¹ï¼Œå®‰å…¨ï¼Œä½†æ˜¯ä¸é«˜æ•ˆã€‚

### 2.æ¶ˆæ¯å¤´

```java
Accept: å‘Šè¯‰æµè§ˆå™¨ï¼Œå®ƒæ‰€æ”¯æŒçš„ç±»å‹
Accept-Encoding: æ”¯æŒå“ªç§ç¼–ç æ ¼å¼  GBK  UTF-8 GB2312  ISo8859-1
Accept-Language: å‘Šè¯‰æµè§ˆå™¨ï¼Œå®ƒçš„è¯­è¨€ç¯å¢ƒ
Cache-Control: ç¼“å­˜æ§åˆ¶
Connection: å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯·æ±‚å®Œæˆæ˜¯æ–­å¼€è¿˜æ˜¯ä¿æŒè¿æ¥
Host:ä¸»æœº
```

## 4.4Httpå“åº”

- æœåŠ¡å™¨---å“åº”---å®¢æˆ·ç«¯

ç™¾åº¦ï¼š

```java
Cache-Control: private                 ç¼“å­˜æ§åˆ¶
Connection: keep-alive                 è¿æ¥ä¿æŒ
Content-Encoding: gzip                 ç¼–ç 
Content-Type: text/html;charset=utf-8  ç±»å‹
```

### 1.å“åº”ä½“

```
Accept: é«˜é€Ÿæµè§ˆå™¨ï¼Œå®ƒæ‰€æ”¯æŒçš„ç±»å‹
Accept-Encoding: æ”¯æŒå“ªç§ç¼–ç æ ¼å¼  GBK  UTF-8 GB2312  ISO8859-1
Accept-Language: å‘Šè¯‰æµè§ˆå™¨ï¼Œå®ƒçš„è¯­è¨€ç¯å¢ƒ
Cache-Control: ç¼“å­˜æ§åˆ¶
Connection: å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯·æ±‚å®Œæˆæ˜¯æ–­å¼€è¿˜æ˜¯ä¿æŒè¿æ¥
Host:ä¸»æœº
Refresh:å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå¤šä¹…åˆ·æ–°ä¸€æ¬¡
Location:è®©ç½‘é¡µé‡æ–°å®šä½
```

### 2.å“åº”çŠ¶æ€ç 

200ï¼šè¯·æ±‚å“åº”æˆåŠŸ

3xxï¼šè¯·æ±‚é‡å®šå‘

- é‡å®šå‘ï¼šä½ é‡æ–°åˆ°æˆ‘ç»™ä½ çš„æ–°ä½ç½®å»

4xxï¼šæ‰¾ä¸åˆ°èµ„æº 404

- èµ„æºä¸å­˜åœ¨

5xxï¼šæœåŠ¡å™¨ä»£ç é”™è¯¯ 500  502ï¼ˆç½‘å…³é”™è¯¯ï¼‰



**å¸¸è§é¢è¯•é¢˜ï¼š**

å½“ä½ çš„æµè§ˆå™¨ä¸­åœ°å€æ‹¦è¾“å…¥åœ°å€å¹¶å›è½¦çš„ä¸€ç¬é—´åˆ°é¡µé¢èƒ½å¤Ÿå±•ç¤ºå›æ¥ï¼Œç»å†äº†ä»€ä¹ˆï¼Ÿ



# 5.mavenç¯å¢ƒæ­å»º

æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ è¿™ä¸ªæŠ€æœ¯ï¼Ÿ

1. åœ¨javawebå¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨å¤§é‡çš„jarï¼Œæˆ‘ä»¬æ‰‹åŠ¨å»å¯¼å…¥

2. å¦‚ä½•èƒ½å¤Ÿè®©ä¸€ä¸ªä¸œè¥¿è‡ªåŠ¨å¸®æˆ‘å¯¼å…¥å’Œé…ç½®è¿™ä¸ªjaråŒ…

   ç”±æ­¤ï¼ŒMavenè¯ç”Ÿäº†ï¼



## 5.1Mavené¡¹ç›®æ¶æ„ç®¡ç†å·¥å…·

æˆ‘ä»¬ç›®å‰å°±æ˜¯æ–¹ä¾¿å¯¼å…¥jaråŒ…çš„

Mavençš„æ ¸å¿ƒæ€æƒ³ï¼š**çº¦å®šå¤§äºé…ç½®**

- æœ‰çº¦æŸï¼Œä¸è¦å»è¿å

Mavenä¼šè§„å®šå¥½ä½ è¯¥å¦‚ä½•å–ç¼–å†™æˆ‘ä»¬çš„javaä»£ç ï¼Œå¿…é¡»è¦æŒ‰ç…§è¿™ä¸ªè§„èŒƒæ¥ã€‚



## 5.2ä¸‹è½½å®‰è£…Maven

å®˜ç½‘ï¼šhttps://maven.apache.org/

![image-20210819203013457](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210819203013457.png)

ä¸‹è½½å®Œæˆåï¼Œè§£å‹å³å¯

å‹æƒ…å»ºè®®ï¼šç”µè„‘ä¸Šçš„æ‰€æœ‰ç¯å¢ƒéƒ½æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–¹ä¾¿ç®¡ç†

## 5.3ç¯å¢ƒå˜é‡é…ç½®

åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­

é…ç½®å¦‚ä¸‹é…ç½®ï¼š

- M2_HOME  mavenç›®å½•ä¸‹çš„binç›®å½•
- MAVEN_HOME   mavençš„ç›®å½•
- åœ¨ç³»ç»Ÿçš„Pathä¸­é…ç½®%MAVEN_HOME%/bin

![image-20210819203930744](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210819203930744.png)

æµ‹è¯•Mavenæ˜¯å¦å®‰è£…æˆåŠŸï¼Œä¿è¯å¿…é¡»é…ç½®å®Œæ¯•ï¼

## 5.4é˜¿é‡Œäº‘é•œåƒ

- é•œåƒï¼šmirrors
  - ä½œç”¨ï¼šåŠ é€Ÿæˆ‘ä»¬çš„ä¸‹è½½
- å›½å†…å»ºè®®ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒ

```xml
    <mirror>
	  <id>nexus-aliyun</id>
	  <mirrorOf>*,!jeecg,!jeecg-snapshots</mirrorOf>
	  <name>Nexus aliyun</name>
      <url>http://maven.aliyun.com/nexus/content/groups/public</url> 
    </mirror>
```

## 5.5æœ¬åœ°ä»“åº“

åœ¨æœ¬åœ°çš„ä»“åº“ï¼Œè¿œç¨‹ä»“åº“ï¼›

**å»ºç«‹ä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼š**localRepository

```xml
<localRepository>D:/mavenRepository</localRepository>
```



# 6.ideaä¸­çš„mavenæ“ä½œ

## 6.1åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®

1. å¯åŠ¨idea

2. åˆ›å»ºä¸€ä¸ªmaven webé¡¹ç›®

   ![image-20210821112933801](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821112933801.png)

   ![image-20210821142829865](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821142829865.png)

   ![image-20210821143047701](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821143047701.png)

   ![image-20210821113859409](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821113859409.png)

3. ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæ¯•

   ![image-20210821114719623](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821114719623.png)

   ![image-20210821143126383](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821143126383.png)

4. è§‚å¯Ÿmavenä»“åº“ä¸­å¤šäº†ä»€ä¹ˆä¸œè¥¿ï¼Ÿ

5. ideaä¸­mavenè®¾ç½®

   ideaé¡¹ç›®åˆ›å»ºæˆåŠŸåï¼Œçœ‹ä¸€çœ¼Mavençš„é…ç½®

   ![image-20210821142139214](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821142139214.png)

   ![image-20210821142313164](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821142313164.png)

6. åˆ°è¿™é‡Œï¼Œmavenåœ¨ideaä¸­çš„é…ç½®å’Œä½¿ç”¨å°±okäº†

## 6.2åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®

![image-20210821143805967](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821143805967.png)

![image-20210821143821541](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821143821541.png)

![image-20210821144032602](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821144032602.png)

è¿™ä¸ªåªæœ‰åœ¨webåº”ç”¨ä¸‹æ‰ä¼šæœ‰

![image-20210821144237704](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821144237704.png)

## 6.3æ ‡è®°æ–‡ä»¶å¤¹åŠŸèƒ½

**æ–¹æ³•ã€1ã€‘**

![image-20210821144843840](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821144843840.png)

**æ–¹æ³•ã€2ã€‘**

![image-20210821145104525](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821145104525.png)

![image-20210821145140271](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821145140271.png)

![image-20210821145356313](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821145356313.png)

## 6.4åœ¨ideaä¸­é…ç½®tomcat

1. ç‚¹å‡»ä¸‹é¢è¿™é‡Œ

   ![image-20210821145754956](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821145754956.png)

2. ç‚¹å‡»åŠ å·ï¼Œã€tomcat serviceã€‘ --ã€‹ã€localã€‘

   ![](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821145919131.png)

3. é…ç½®tomcatæœåŠ¡å™¨

   ![image-20210821150504811](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821150504811.png)

   ![image-20210821150537899](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821150537899.png)

   ![](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821151052796.png)

4. å¯åŠ¨tomcat

   ![image-20210821151243135](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821151243135.png)

   ![image-20210821151618902](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821151618902.png)



## 6.5POMæ–‡ä»¶

pom.xmlæ˜¯mavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶

![image-20210821151913777](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821151913777.png)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!--mavenç‰ˆæœ¬å’Œå¤´æ–‡ä»¶-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <!--è¿™é‡Œå°±æ˜¯æˆ‘ä»¬é…ç½®çš„gav-->
  <groupId>com.zyy</groupId>
  <artifactId>javaweb-maven</artifactId>
  <version>1.0-SNAPSHOT</version>
  <!--packaging  é¡¹ç›®çš„æ–¹æ³•æ–¹å¼
    jar:jaråº”ç”¨
    war:javaWebåº”ç”¨
  -->
  <packaging>war</packaging>

  <name>javaweb-maven Maven Webapp</name>
  <!-- FIXME change it to the project's website -->
  <url>http://www.example.com</url>

  <!--é…ç½®-->
  <properties>
    <!--é¡¹ç›®çš„é»˜è®¤æ„å»ºç¼–ç -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <!--ç¼–ç ç‰ˆæœ¬-->
    <maven.compiler.source>1.8</maven.compiler.source>
    <maven.compiler.target>1.8</maven.compiler.target>
  </properties>

  <!--é¡¹ç›®ä¾èµ–-->
  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <!--é¡¹ç›®æ„å»ºç”¨çš„ä¸œè¥¿-->
  <build>
    <finalName>javaweb-maven</finalName>
    <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
      <plugins>
        <plugin>
          <artifactId>maven-clean-plugin</artifactId>
          <version>3.1.0</version>
        </plugin>
        <!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging -->
        <plugin>
          <artifactId>maven-resources-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.8.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>2.22.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-war-plugin</artifactId>
          <version>3.2.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-install-plugin</artifactId>
          <version>2.5.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>2.8.2</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>

```

**mavençš„é«˜çº§ä¹‹åˆåœ¨äºå®ƒä¼šå¸®ä½ å¯¼å…¥è¿™ä¸ªjaråŒ…æ‰€ä¾èµ–çš„å…¶ä»–jaråŒ…**



mavenç”±äºä»–çš„çº¦å®šå¤§äºé…ç½®ï¼Œæˆ‘ä»¬ä¹‹åå¯èƒ½ä¼šé‡åˆ°æˆ‘ä»¬å†™çš„é…ç½®æ–‡ä»¶ï¼Œæ— æ³•è¢«å¯¼å‡ºæˆ–è€…ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆï¼š

```xml
  <!--åœ¨buildä¸­é…ç½®resources,æ¥é˜²æ­¢æˆ‘ä»¬èµ„æºå¯¼å‡ºå¤±è´¥çš„é—®é¢˜-->  
  <build> 
    <resources>
      <resource>
        <directory>src/main/resources</directory>
        <includes>
          <include>**/*.properties</include>
          <include>**/*.xml</include>
        </includes>
        <filtering>false</filtering>
      </resource>
      <resource>
        <directory>src/main/java</directory>
        <includes>
          <include>**/*.properties</include>
          <include>**/*.xml</include>
        </includes>
        <filtering>false</filtering>
      </resource>
    </resources>
  </build>
```



## 6.6ideaæ“ä½œ

ç›®å½•æ ‘

![image-20210821154123366](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821154123366.png)

mavenä¸­jarçš„è”ç³»å…³è”å›¾

![image-20210821154340605](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210821154340605.png)

# 7.è§£å†³å¤§å®¶é‡åˆ°çš„ä¸€äº›é—®é¢˜

1. maven 3.6.2

   æŠ¥é”™ï¼šunable to import maven project:see logs for details

   è§£å†³æ–¹æ³•ï¼šé™çº§ä¸º3.6.1

2. tomcaté—ªé€€

3. ideaä¸­æ¯æ¬¡éƒ½è¦é‡å¤é…ç½®maven

   åœ¨ideaä¸­çš„å…¨å±€é»˜è®¤é…ç½®ä¸­å»é…ç½®

   ![image-20210822112015614](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822112015614.png)

4. mavené¡¹ç›®ä¸­tomcatæ— æ³•é…ç½®

5. mavené»˜è®¤webé¡¹ç›®ä¸­çš„web.xmlç‰ˆæœ¬é—®é¢˜

   ![image-20210822112520405](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822112520405.png)

   æ›¿æ¢ä¸ºwebapp3.1ç‰ˆæœ¬å’Œtomcatä¸€è‡´(çœ‹tomcatä¸‹çš„webappsé‡Œé¢çš„å®˜æ–¹æ¡ˆä¾‹)

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
            version="3.1"
            metadata-complete="true">
   
     <display-name>Welcome to Tomcat</display-name>
   
   </web-app>
   ```

6. mavenä»“åº“çš„ä½¿ç”¨

   åœ°å€ï¼šhttps://mvnrepository.com/

   ![image-20210822114151023](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822114151023.png)

   

   ![image-20210822114058324](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822114058324.png)

   

   ![image-20210822114215253](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822114215253.png)

# 8.helloServlet

## 8.1servletç®€ä»‹

- servletå°±æ˜¯sunå…¬å¸å¼€å‘åŠ¨æ€webçš„ä¸€é—¨æŠ€æœ¯
- sunåœ¨è¿™äº›apiä¸­æä¾›ä¸€ä¸ªæ¥å£å«åšï¼šservletï¼Œå¦‚æœä½ æƒ³å¼€å‘ä¸€ä¸ªservletç¨‹åºï¼Œåªéœ€è¦å®Œæˆä¸¤ä¸ªå°æ­¥éª¤ï¼š
  - ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°servletæ¥å£
  - æŠŠå¼€å‘å¥½çš„javaç±»éƒ¨ç½²åˆ°webæœåŠ¡å™¨ä¸­

**æŠŠå®ç°äº†servletæ¥å£çš„javaç¨‹åºå«åšï¼Œservlet**



## 8.2HelloServlet

**servletæ¥å£sunå…¬å¸æœ‰ä¸¤ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šHttpServletã€GenericServlet**



1. å»ºç«‹ä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®ï¼Œåˆ é™¤srcç›®å½•

![image-20210822151123982](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822151123982.png)

2. ç„¶ååœ¨æ­¤é¡¹ç›®ä¸­ï¼Œæ–°å»ºä¸€ä¸ªmodule(javaweb mavené¡¹ç›®)

   å…³äºmavençˆ¶å­å·¥ç¨‹çš„ç†è§£ï¼š

   çˆ¶é¡¹ç›®ä¸­ä¼šæœ‰

   ```xml
       <modules>
           <module>servlet-01</module>
       </modules>
   ```

   å­é¡¹ç›®ä¸­ä¼šæœ‰

   ```xml
       <parent>
           <artifactId>javaWeb-03-maven</artifactId>
           <groupId>com.zyy</groupId>
           <version>1.0-SNAPSHOT</version>
       </parent>
   ```

   çˆ¶é¡¹ç›®ä¸­çš„jaråŒ…å­é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨

   ```java
   son extends father
   ```

   ![image-20210822152912534](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822152912534.png)

   å¯¼servletåŒ…ï¼ˆçˆ¶é¡¹ç›®POMæ–‡ä»¶ä¸­ï¼‰

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <project xmlns="http://maven.apache.org/POM/4.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
       <modelVersion>4.0.0</modelVersion>
   
       <groupId>com.zyy</groupId>
       <artifactId>javaWeb-03-maven</artifactId>
       <packaging>pom</packaging>
       <version>1.0-SNAPSHOT</version>
       <modules>
           <module>servlet-01</module>
       </modules>
       <dependencies>
           <dependency>
               <groupId>javax.servlet</groupId>
               <artifactId>javax.servlet-api</artifactId>
               <version>4.0.1</version>
               <scope>provided</scope>
           </dependency>
       </dependencies>
   
   </project>
   ```
   
   
   
   3. mavenç¯å¢ƒä¼˜åŒ–
   
      1. ä¿®æ”¹web.xmlä¸ºæœ€æ–°çš„
   
         ```xml
         <?xml version="1.0" encoding="UTF-8"?>
         <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                               http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
                  version="3.1"
                  metadata-complete="true">
         
         </web-app>
         ```
   
      2. å°†mavençš„ç»“æ„æ­å»ºå®Œæ•´
   
         ![image-20210822153435351](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822153435351.png)
   
   4. ç¼–å†™ä¸€ä¸ªservletç¨‹åº
   
      ç¼–å†™ä¸€ä¸ªæ™®é€šç±»ï¼Œå®ç°servletæ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ç»§æ‰¿HttpServlet
   
      ![image-20210822154732934](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822154732934.png)
   
      ```java
      import javax.servlet.ServletException;
      import javax.servlet.http.HttpServlet;
      import javax.servlet.http.HttpServletRequest;
      import javax.servlet.http.HttpServletResponse;
      import java.io.IOException;
      import java.io.PrintWriter;
      
      /**
       * @ClassName: HelloServlet
       * @Description: TODO ç±»æè¿°
       * @Author: zyy
       * @Date: 2021/08/22 15:35
       * @Version: 1.0
       */
      public class HelloServlet extends HttpServlet {
      
      
          @Override
          protected void doGet(HttpServletRequest req, HttpServletResponse response) throws ServletException, IOException {
              response.setContentType("text/html");
              response.setCharacterEncoding("utf-8");
              PrintWriter out = response.getWriter();
              out.println("<html>");
              out.println("<head>");
              out.println("<title>Hello World!</title>");
              out.println("</head>");
              out.println("<body>");
              out.println("<h1>ä½ å¥½ï¼</h1>");
              out.println("</body>");
              out.println("</html>");
          }
      
          @Override
          protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
              doGet(req, resp);
          }
      }
      ```
   
   5. ç¼–å†™ä¸€ä¸ªservletçš„æ˜ å°„
   
      **ä¸ºä»€ä¹ˆéœ€è¦æ˜ å°„ï¼šæˆ‘ä»¬å†™çš„æ˜¯javaç¨‹åºï¼Œä½†æ˜¯è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè€Œæµè§ˆå™¨éœ€è¦è¿æ¥webæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨webæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬å†™çš„servletï¼Œè¿˜éœ€è¦ç»™ä»–ä¸€ä¸ªæµè§ˆå™¨èƒ½å¤Ÿè®¿é—®çš„è·¯å¾„ã€‚**
   
      ```xml
      <?xml version="1.0" encoding="UTF-8"?>
      <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                            http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
               version="3.1"
               metadata-complete="true">
      
          <display-name>Welcome to Tomcat</display-name>
          <!--  web.xmlæ˜¯é…ç½®æˆ‘ä»¬webçš„æ ¸å¿ƒåº”ç”¨-->
          <!--  æ³¨å†Œservlet-->
          <servlet>
              <servlet-name>helloServlet</servlet-name>
              <servlet-class>com.zyy.servlet.HelloServlet</servlet-class>
          </servlet>
          <!--  ä¸€ä¸ªservletå¯¹åº”ä¸€ä¸ªMapping:æ˜ å°„-->
          <servlet-mapping>
              <servlet-name>helloServlet</servlet-name>
              <!--    è¯·æ±‚è·¯å¾„-->
              <url-pattern>/hello</url-pattern>
          </servlet-mapping>
      
      </web-app>
      ```
   
   6. é…ç½®tomcat
   
      æ³¨æ„ï¼šé…ç½®é¡¹ç›®å‘å¸ƒçš„è·¯å¾„
   
      ![image-20210822160116977](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822160116977.png)
   
   7. æµ‹è¯•
   
      ![image-20210822163233073](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210822163233073.png)
   

ğŸ“•**Tomcat10**ä»¥åservletçš„jaråŒ…ä¸å†æ˜¯servlet4ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](D:\ç®—æ³•Typora\picture\watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6a2U5LuZ5qOS5qOS5LmL5Li7,size_20,color_FFFFFF,t_70,g_se,x_16.png)

å¯¹åº”çš„pom.xmlåº”è¯¥ä¸ºï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.wuxianzii</groupId>
    <artifactId>javaweb-02-servlet</artifactId>
    <packaging>pom</packaging>
    <version>1.0-SNAPSHOT</version>
    <modules>
        <module>servlet-01</module>
    </modules>

    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
    </properties>
    <dependencies>

        <!--jaråŒ…çš„ä¾èµ–-->
        <dependency>
            <groupId>jakarta.servlet</groupId>
            <artifactId>jakarta.servlet-api</artifactId>
            <version>6.0.0</version>
            <scope>provided</scope>
        </dependency>
        <!--jspçš„ä¾èµ–-->
        <dependency>
            <groupId>jakarta.servlet.jsp</groupId>
            <artifactId>jakarta.servlet.jsp-api</artifactId>
            <version>3.0.0</version>
            <scope>provided</scope>
        </dependency>

    </dependencies>

</project>
```

æ­¤æ—¶ï¼Œ**HelloServlet**ç»§æ‰¿çš„æ˜¯`jakarta.servlet.http.HttpServlet;`

```java
package com.wuxianzii.servlet;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.io.PrintWriter;

//servletæ¥å£sunå…¬å¸æœ‰ä¸¤ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šHttpServletã€GenericServlet
public class HelloServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //super.doGet(req, resp);
        System.out.println("è¿›å…¥doget");
        PrintWriter writer = resp.getWriter();//å“åº”æµ

        writer.println("hello-servlet");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

 ![Servletæµç¨‹](D:\ç®—æ³•Typora\picture\Servletæµç¨‹.jpg)

# 9.servletåŸç†

servletæ˜¯ç”±webæœåŠ¡å™¨è°ƒç”¨

## 9.1Mappingé—®é¢˜

1. ä¸€ä¸ªservletå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„è·¯å¾„

   ```xml
     <!--  ä¸€ä¸ªservletå¯¹åº”ä¸€ä¸ªMapping:æ˜ å°„-->
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <!--    è¯·æ±‚è·¯å¾„-->
       <url-pattern>/hello</url-pattern>
     </servlet-mapping>
   ```

2. ä¸€ä¸ªservletå¯ä»¥æŒ‡å®šå¤šä¸ªæ˜ å°„è·¯å¾„

   ```xml
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>/hello</url-pattern>
     </servlet-mapping>
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>/hello2</url-pattern>
     </servlet-mapping>
   ```

3. ä¸€ä¸ªservletå¯ä»¥æŒ‡å®šé€šç”¨æ˜ å°„è·¯å¾„

   ```xml
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>/hello/*</url-pattern>
     </servlet-mapping>
   ```

   ![image-20210823222516732](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210823222516732.png)

   æ³¨æ„ä¸‹é¢è¿™æ ·é‡å¯æœåŠ¡å°±ä¸ä¼šé»˜è®¤è¿›å…¥åˆ°index.jspé¡µé¢äº†(ä¸æ¨èä½¿ç”¨)

   ```xml
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>/*</url-pattern>
     </servlet-mapping>
   ```

   ![image-20210823222649069](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210823222649069.png)

4. æŒ‡å®šä¸€äº›åç¼€æˆ–è€…å‰ç¼€ç­‰ç­‰

   ```xml
     <!--  å¯ä»¥è‡ªå®šä¹‰åç¼€å®ç°è¯·æ±‚æ˜ å°„
     æ³¨æ„ç‚¹ï¼š*å‰æ°‘ä¸èƒ½åŠ é¡¹ç›®æ˜ å°„çš„è·¯å¾„    /hello/*.do   æ˜¯ä¸å¯ä»¥çš„
     ä½†æ˜¯/hello/hi.doæ˜¯å¯ä»¥çš„
     -->  
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>*.do</url-pattern>
     </servlet-mapping>
   ```

   ![image-20210823223110545](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210823223110545.png)

5. ä¼˜å…ˆçº§é—®é¢˜

   **åˆ¶å®šäº†å›ºæœ‰çš„æ˜ å°„è·¯å¾„ä¼˜å…ˆçº§æœ€é«˜**ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šèµ°é»˜è®¤çš„å¤„ç†è¯·æ±‚

   ```xml
     <servlet>
       <servlet-name>helloServlet</servlet-name>
       <servlet-class>com.zyy.servlet.HelloServlet</servlet-class>
     </servlet>
     <servlet-mapping>
       <servlet-name>helloServlet</servlet-name>
       <url-pattern>/hello/hi.do</url-pattern>
     </servlet-mapping>
     <!--  404-->
     <servlet>
       <servlet-name>errorServlet</servlet-name>
       <servlet-class>com.zyy.servlet.ErrorServlet</servlet-class>
     </servlet>
     <servlet-mapping>
       <servlet-name>errorServlet</servlet-name>
       <url-pattern>/*</url-pattern>
     </servlet-mapping>
   ```

   ```java
   import javax.servlet.ServletException;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;
   import java.io.PrintWriter;
   
   /**
    * @ClassName: HelloServlet
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2021/08/22 15:35
    * @Version: 1.0
    */
   public class HelloServlet extends HttpServlet {
   
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse response) throws ServletException, IOException {
           response.setContentType("text/html");
           response.setCharacterEncoding("utf-8");
           PrintWriter out = response.getWriter();
           out.println("<html>");
           out.println("<head>");
           out.println("<title>Hello World!</title>");
           out.println("</head>");
           out.println("<body>");
           out.println("<h1>ä½ å¥½ï¼</h1>");
           out.println("</body>");
           out.println("</html>");
       }
   
       @Override
       protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           doGet(req, resp);
       }
   }
   ```

   ![image-20210823224313150](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210823224313150.png)

   ![image-20210823224325887](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210823224325887.png)

   

# 10.servletContextå¯¹è±¡

webå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªwebç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„servletContextå¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†å½“å‰çš„webåº”ç”¨ã€‚

## 1.å…±äº«æ•°æ®

æˆ‘åœ¨è¿™ä¸ªservletä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¯ä»¥å†å¦å¤–ä¸€ä¸ªservletä¸­æ‹¿åˆ°

1. æ–°å»ºä¸€ä¸ªmodule

![image-20210825224031400](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210825224031400.png)

2. HelloServlet.java

   ```java
   import javax.servlet.ServletContext;
   import javax.servlet.ServletException;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;
   
   /**
    * @ClassName: HelloServlet
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2021/08/25 22:14
    * @Version: 1.0
    */
   public class HelloServlet extends HttpServlet {
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           //this.getInitParameter()
           //this.getServletConfig()
           //servlet ä¸Šä¸‹æ–‡
           ServletContext servletContext = this.getServletContext();
           String name = "zyy";
           //å°†ä¸€ä¸ªæ•°æ®ä¿å­˜åœ¨äº†ServletContextä¸­
           servletContext.setAttribute("name", name);
           System.out.println("hello " + name);
       }
   }
   ```

3. GetServlet.java

   ```java
   import javax.servlet.ServletContext;
   import javax.servlet.ServletException;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;
   
   /**
    * @ClassName: GetServlet
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2021/08/25 22:31
    * @Version: 1.0
    */
   public class GetServlet extends HttpServlet {
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           ServletContext servletContext = this.getServletContext();
           String name = (String) servletContext.getAttribute("name");
   
           resp.setCharacterEncoding("utf-8");
           resp.setContentType("text/html");
           resp.getWriter().print("get name is " + name);
       }
   }
   ```

4. web.xml

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
            version="3.1"
            metadata-complete="true">
   
       <servlet-mapping>
           <servlet-name>hello</servlet-name>
           <url-pattern>/hello</url-pattern>
       </servlet-mapping>
   
       <servlet>
           <servlet-name>hello</servlet-name>
           <servlet-class>com.zyy.servlet.HelloServlet</servlet-class>
       </servlet>
   
   
       <servlet-mapping>
           <servlet-name>getName</servlet-name>
           <url-pattern>/getName</url-pattern>
       </servlet-mapping>
   
       <servlet>
           <servlet-name>getName</servlet-name>
           <servlet-class>com.zyy.servlet.GetServlet</servlet-class>
       </servlet>
   
   </web-app>
   ```

5. æµ‹è¯•

   å…ˆè°ƒç”¨/hello

   ![image-20210825224259579](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210825224259579.png)

   å†è°ƒç”¨/getName

   ![image-20210825224324401](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210825224324401.png)

   é‡å¯ï¼Œä¸€å¼€å§‹å°±è°ƒç”¨/getName

   ![image-20210825224503928](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210825224503928.png)



# 11.servletContextåº”ç”¨

## 1.è·å–åˆå§‹åŒ–å‚æ•°

```xml
    <context-param>
        <param-name>url</param-name>
        <param-value>jdbc:mysql://localhost:3306/mybatis</param-value>
    </context-param>

    <servlet-mapping>
        <servlet-name>getUrl</servlet-name>
        <url-pattern>/getUrl</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>getUrl</servlet-name>
        <servlet-class>com.zyy.servlet.ServletDemo03</servlet-class>
    </servlet>
```



```java
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: ServletDemo03
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/08/26 22:43
 * @Version: 1.0
 */
public class ServletDemo03 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext servletContext = req.getServletContext();
        String url = servletContext.getInitParameter("url");
        resp.getWriter().print(url);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

![image-20210826225315359](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210826225315359.png)

## 2.è¯·æ±‚è½¬å‘

```xml
    <servlet-mapping>
        <servlet-name>dis</servlet-name>
        <url-pattern>/dis</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>dis</servlet-name>
        <servlet-class>com.zyy.servlet.ServletDemo04</servlet-class>
    </servlet>
```

```java
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: ServletDemo03
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/08/26 22:43
 * @Version: 1.0
 */
public class ServletDemo04 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext servletContext = req.getServletContext();
//        RequestDispatcher requestDispatcher = servletContext.getRequestDispatcher("/getUrl");
//        requestDispatcher.forward(req, resp);
        servletContext.getRequestDispatcher("/getUrl").forward(req, resp);

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

![image-20210826225845151](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210826225845151.png)

## 3.è¯»å–èµ„æºæ–‡ä»¶

Properties

- åœ¨javaç›®å½•ä¸‹æ–°å»ºproperties
- åœ¨resourceç›®å½•ä¸‹æ–°å»ºproperties

å‘ç°ï¼šéƒ½è¢«æ‰“åŒ…åˆ°åŒä¸€ä¸ªè·¯å¾„ä¸‹ï¼šclasses  æˆ‘ä»¬ä¿—ç§°è¿™ä¸ªè·¯å¾„ä¸ºclasspath

æ€è·¯ï¼šéœ€è¦ä¸€ä¸ªæ–‡ä»¶æµ

db.properties

```properties
username=root
password=123456
```

![image-20210826231912370](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210826231912370.png)

```xml
    <servlet-mapping>
        <servlet-name>05</servlet-name>
        <url-pattern>/05</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>05</servlet-name>
        <servlet-class>com.zyy.servlet.ServletDemo05</servlet-class>
    </servlet>
```



```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

/**
 * @ClassName: ServletDemo03
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/08/26 22:43
 * @Version: 1.0
 */
public class ServletDemo05 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        InputStream in = req.getServletContext().getResourceAsStream("/WEB-INF/classes/db.properties");

        Properties pro = new Properties();
        pro.load(in);

        String name = pro.getProperty("username");
        String pwd = pro.getProperty("password");

        resp.getWriter().print(name + ":" + pwd);

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

![image-20210826231820482](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210826231820482.png)

# 12.responseä¸‹è½½æ–‡ä»¶

## 1.HttpServletResponse

webæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„httpè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯·æ±‚çš„HttpServletRequestå¯¹è±¡ï¼Œä¸€ä¸ªä»£è¡¨å“åº”çš„HttpServletResponse

- å¦‚æœè¦è·å–å®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥çš„å‚æ•°ï¼šæ‰¾HttpServletRequest
- å¦‚æœè¦ç»™å®¢æˆ·ç«¯å“åº”ä¸€äº›ä¿¡æ¯ï¼šæ‰¾HttpServletResponse



**ç®€å•åˆ†ç±»**

1. è´Ÿè´£å‘æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•

   ```java
       public ServletOutputStream getOutputStream() throws IOException;
   
       public PrintWriter getWriter() throws IOException;
   ```

2. è´Ÿè´£å‘æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•

   ```java
       public void setCharacterEncoding(String charset);
   
       public void setContentLength(int len);
   
       public void setContentLengthLong(long len);
   
       public void setContentType(String type);
   
       public void setDateHeader(String name, long date);
   
       public void addDateHeader(String name, long date);
   
       public void setHeader(String name, String value);
   
       public void addHeader(String name, String value);
   
       public void setIntHeader(String name, int value);
   
       public void addIntHeader(String name, int value);
   ```

3. å“åº”çš„çŠ¶æ€ç (å¸¸è§)

   ```java
   
       /**
        * Status code (200) indicating the request succeeded normally.
        */
       public static final int SC_OK = 200;
       /**
        * Status code (302) indicating that the resource has temporarily
        * moved to another location, but that future references should
        * still use the original URI to access the resource.
        *
        * This definition is being retained for backwards compatibility.
        * SC_FOUND is now the preferred definition.
        */
       public static final int SC_MOVED_TEMPORARILY = 302;
       /**
        * Status code (404) indicating that the requested resource is not
        * available.
        */
       public static final int SC_NOT_FOUND = 404;
       /**
        * Status code (500) indicating an error inside the HTTP server
        * which prevented it from fulfilling the request.
        */
       public static final int SC_INTERNAL_SERVER_ERROR = 500;
       /**
        * Status code (502) indicating that the HTTP server received an
        * invalid response from a server it consulted when acting as a
        * proxy or gateway.
        */
       public static final int SC_BAD_GATEWAY = 502;
   
   //...
   ```




**å¸¸è§åº”ç”¨**

1. å‘æµè§ˆå™¨è¾“å‡ºæ¶ˆæ¯

2. ä¸‹è½½æ–‡ä»¶

   1. è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
   2. ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ
   3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½éƒ½æ”¯æŒæˆ‘ä»¬ä¸‹è½½çš„ä¸œè¥¿ æ–‡ä»¶åæ˜¯ä¸­æ–‡çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®URLEncoder.encode(fileName, "UTF-8")ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¹±ç 
   4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
   5. åˆ›å»ºç¼“å†²åŒº
   6. è·å–OutputStremå¯¹è±¡
   7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒºï¼Œä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯

   ```java
   import javax.servlet.ServletException;
   import javax.servlet.ServletOutputStream;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.FileInputStream;
   import java.io.IOException;
   import java.net.URLEncoder;
   
   /**
    * @ClassName: FileServlet
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2021/09/02 22:14
    * @Version: 1.0
    */
   public class FileServlet extends HttpServlet {
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
   
           //1. è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
           String realPath = "D:\\IdeaProjects\\javaweb-project-maven\\servlet-response\\src\\main\\resources\\å“ˆå“ˆ.jpg";
           //2. ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ
           String fileName = realPath.substring(realPath.lastIndexOf("\\") + 1);
           //3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½éƒ½æ”¯æŒæˆ‘ä»¬ä¸‹è½½çš„ä¸œè¥¿ æ–‡ä»¶åæ˜¯ä¸­æ–‡çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®URLEncoder.encode(fileName, "UTF-8")ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¹±ç 
           resp.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(fileName, "UTF-8"));
           //4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
           FileInputStream in = new FileInputStream(realPath);
   
           //5. åˆ›å»ºç¼“å†²åŒº
           int len = 0;
           byte[] buffer = new byte[1024];
           //6. è·å–OutputStremå¯¹è±¡
           ServletOutputStream out = resp.getOutputStream();
           //7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒºï¼Œä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯
           while ((len = in.read(buffer)) > 0) {
               out.write(buffer, 0, len);
           }
           out.flush();
           out.close();
           in.close();
       }
   
       @Override
       protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           doGet(req, resp);
       }
   }
   ```

   ```xml
       <servlet-mapping>
           <servlet-name>getFile</servlet-name>
           <url-pattern>/getFile</url-pattern>
       </servlet-mapping>
   
       <servlet>
           <servlet-name>getFile</servlet-name>
           <servlet-class>com.zyy.res.FileServlet</servlet-class>
       </servlet>
   ```

   

# 13.responseéªŒè¯ç å®ç°

éªŒè¯ç æ€ä¹ˆæ¥çš„ï¼Ÿ

- å‰ç«¯å®ç°
- åç«¯å®ç°ï¼Œéœ€è¦ç”¨åˆ°javaå›¾ç‰‡ç±»ï¼Œç”Ÿæˆä¸€ä¸ªå›¾ç‰‡



```java
package com.wuxianzii.servlet;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.util.Random;

public class ImageServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å¦‚ä½•è®©æµè§ˆå™¨5ç§’åˆ·æ–°ä¸€æ¬¡
        resp.setHeader("refresh","3");

        //åœ¨å†…å­˜ä¸­åˆ›å»ºå›¾ç‰‡
        BufferedImage image = new BufferedImage(80, 20,BufferedImage.TYPE_INT_RGB);
        //å¾—åˆ°å›¾ç‰‡
        Graphics2D graphics = (Graphics2D) image.getGraphics();//ç¬”
        //è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²
        graphics.setBackground(Color.white);
        graphics.fillRect(0,0,80,20);

        //ç»™å›¾ç‰‡å†™æ•°æ®
        graphics.setColor(Color.blue);
        graphics.setFont(new Font(null,Font.BOLD,20));
        graphics.drawString(makeNum(),0,20);

        //å‘Šè¯‰æµè§ˆå™¨ è¿™ä¸ªè¯·æ±‚ç”¨å›¾ç‰‡çš„æ–¹å¼æ‰“å¼€
        resp.setContentType("image/jpeg");
        //ç½‘ç«™å­˜åœ¨ç¼“å­˜ï¼Œä¸è®©æµè§ˆå™¨ç¼“å­˜
        resp.setDateHeader("expires",-1);
        resp.setHeader("Cache-Control","no-cache");
        resp.setHeader("Pragma","no-cache");

        //æŠŠå›¾ç‰‡å†™ç»™æµè§ˆå™¨
        ImageIO.write(image,"jpg",resp.getOutputStream());


    }
    private String makeNum(){
        Random random = new Random();
        String num = random.nextInt(9999)+ "";
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i < 4 - num.length(); i++) {//å½“ç”Ÿæˆçš„éšæœºæ•°å°äº4ä½æ—¶ï¼Œç”¨0å¡«å……
            sb.append("0");
        }
        num = sb.toString() + num;
        return num;

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}

```



```xml

    <servlet-mapping>
        <servlet-name>image</servlet-name>
        <url-pattern>/image</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>image</servlet-name>
        <servlet-class>com.zyy.res.ImageServlet</servlet-class>
    </servlet>
```

![image-20210909145927059](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210909145927059.png)

# 14.responseé‡å®šå‘

ä¸€ä¸ªwebä¹‹æºæ”¶åˆ°å®¢æˆ·ç«¯Aè¯·æ±‚åï¼ŒBä¼šé€šçŸ¥Aå®¢æˆ·ç«¯å»è®¿é—®å¦å¤–ä¸€ä¸ªwebèµ„æºCï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšé‡å®šå‘ã€‚

å¸¸è§åœºæ™¯ï¼š

- ç”¨æˆ·ç™»å½•

```java

    public void sendRedirect(String location) throws IOException;
```

```java
package com.zyy.res;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: RedirectServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/09 16:34
 * @Version: 1.0
 */
public class RedirectServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //é‡å®šå‘
        resp.sendRedirect("/res/image");

        //ç›¸å½“äº
//        resp.setHeader("Location", "/res/image");
//        resp.setStatus(302);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}

```

```xml

    <servlet-mapping>
        <servlet-name>redirect</servlet-name>
        <url-pattern>/redirect</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>redirect</servlet-name>
        <servlet-class>com.zyy.res.RedirectServlet</servlet-class>
    </servlet>
```

**é¢è¯•é¢˜ï¼šè¯·ä½ èŠèŠé‡å®šå‘å’Œè½¬å‘çš„åŒºåˆ«ï¼Ÿ**

- ç›¸åŒç‚¹

  - é¡µé¢éƒ½ä¼šå®ç°è·³è½¬
- ç›¸åŒç‚¹
  - è¯·æ±‚è½¬å‘ï¼ŒURLåœ°å€æ‹¦ä¸ä¼šå˜ï¼› 307
  - é‡å®šå‘ï¼ŒURLåœ°å€æ‹¦ä¼šå‘ç”Ÿå˜åŒ–ã€‚ 302



**æ¨¡æ‹Ÿç™»å½•**

index.jsp

```jsp
<html>
<body>
<h2>Hello World!</h2>

<%--è¿™é‡Œæäº¤çš„è·¯å¾„ï¼Œéœ€è¦å¯»æ‰¾é¡¹ç›®çš„è·¯å¾„--%>
<%--${pageContext.request.contextPath}ä»£è¡¨å½“å‰çš„é¡¹ç›®--%>
<form action="${pageContext.request.contextPath}/login" method="get">
    ç”¨æˆ·åï¼š<input type="text" name="username"/><br/>
    å¯†ç ï¼š<input type="password" name="pwd"/><br/>
    <input type="submit"/>
</form>
</body>
</html>
```

```xml
    <servlet-mapping>
        <servlet-name>req</servlet-name>
        <url-pattern>/login</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>req</servlet-name>
        <servlet-class>com.zyy.res.RequestTest</servlet-class>
    </servlet>
```



```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: RequestTest
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/09 17:44
 * @Version: 1.0
 */
public class RequestTest extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String username = req.getParameter("username");
        String pwd = req.getParameter("pwd");
        System.out.println(username + ":" + pwd);

        //é‡å®šå‘çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„è·¯å¾„é—®é¢˜ï¼Œå¦åˆ™å¯èƒ½ä¼š404
        resp.sendRedirect("/res/success.jsp");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

success.jsp

```jsp
<html>
<body>
<h2>æˆåŠŸ</h2>
</body>
</html>
```

![image-20210909181339760](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210909181339760.png)

# 15.requeståº”ç”¨

HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡httpåè®®è®¿é—®æœåŠ¡å™¨ï¼ŒHTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestä¸­ï¼Œé€šè¿‡HttpServletRequestè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯

![image-20210910112503485](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210910112503485.png)



![image-20210910112526687](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210910112526687.png)

## 1.è·å–å‚æ•°ã€è¯·æ±‚è½¬å‘

![image-20210910113053811](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210910113053811.png)

![image-20210910135727180](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210910135727180.png)

index.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>ç™»å½•</title>
</head>
<body>
<h1>ç™»å½•</h1>
<div style="text-align: center">
    <form action="${pageContext.request.contextPath}/login" method="post">
        ç”¨æˆ·åï¼š<input type="text" name="username"/><br/>
        å¯†ç ï¼š<input type="password" name="pwd"/><br/>
        çˆ±å¥½ï¼š
        <input type="checkbox" name="hobbies" value="çœ‹ç”µå½±"/>çœ‹ç”µå½±
        <input type="checkbox" name="hobbies" value="é˜…è¯»"/>é˜…è¯»
        <input type="checkbox" name="hobbies" value="çˆ¬å±±"/>çˆ¬å±±
        <input type="checkbox" name="hobbies" value="æ‘„å½±"/>æ‘„å½±
        <br/>
        <input type="submit"/>
    </form>
</div>

</body>
</html>

```

success.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>success</title>
</head>
<body>
<h1>ç™»å½•æˆåŠŸ</h1>

</body>
</html>
```

```xml
    <servlet-mapping>
        <servlet-name>login</servlet-name>
        <url-pattern>/login</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>login</servlet-name>
        <servlet-class>com.zyy.req.LoginServlet</servlet-class>
    </servlet>
```

```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Arrays;

/**
 * @ClassName: LoginServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/10 11:39
 * @Version: 1.0
 */
public class LoginServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        String username = req.getParameter("username");
        String pwd = req.getParameter("pwd");
        String[] hobbies = req.getParameterValues("hobbies");

        System.out.println("======================");
        System.out.println(username);
        System.out.println(pwd);
        //åå°æ¥æ”¶ä¸­æ–‡ä¹±ç é—®é¢˜
        System.out.println(Arrays.toString(hobbies));
        System.out.println("======================");
        //é€šè¿‡è¯·æ±‚è½¬å‘
        // è¿™é‡Œçš„/ä»£è¡¨å½“å¤©çš„webåº”ç”¨
        req.getRequestDispatcher("/success.jsp").forward(req, resp);

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}

```

æµ‹è¯•

![image-20210910135932925](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210910135932925.png)

# 16.cookieè®²è§£

## 1.ä¼šè¯

**ä¼šè¯ï¼š**ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»äº†å¾ˆå¤šè¶…é“¾æ¥ï¼Œè®¿é—®äº†å¤šä¸ªwebèµ„æºï¼Œå…³é—­æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç§°ä¹‹ä¸ºä¼šè¯ã€‚



**æœ‰çŠ¶æ€ä¼šè¯ï¼š**ä¸€ä¸ªåŒå­¦æ›¾ç»æ¥è¿‡æ•™å®¤ï¼Œä¸‹æ¬¡å†æ¥çš„æ•™å®¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“è¿™ä¸ªåŒå­¦ï¼Œæ›¾ç»æ¥è¿‡ï¼Œç§°ä¹‹ä¸ºæœ‰çŠ¶æ€ä¼šè¯ã€‚

**ä½ æ€ä¹ˆè¯æ˜ä½ æ˜¯è¥¿å¼€çš„å­¦ç”Ÿï¼Ÿ**

ä½     è¥¿å¼€

1. å‘ç¥¨            è¥¿å¼€ç»™ä½ å¼€å‘ç¥¨
2. å­¦æ ¡ç™»è®°    è¥¿å¼€æ ‡è®°ä½ è¿‡æ¥äº†



ä¸€ä¸ªç½‘ç«™ï¼Œæ€ä¹ˆè¯æ˜ä½ æ¥è¿‡ï¼Ÿ

å®¢æˆ·ç«¯     æœåŠ¡å™¨

1. æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯ä¸€ä¸ª  ä¿¡ä»¶ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è®¿é—®æœåŠ¡ç«¯å¸¦ä¸Šä¿¡ä»¶å°±å¯ä»¥ï¼›cookie
2. æœåŠ¡å™¨ç™»è®°ä½ è¿‡æ¥äº†ï¼Œä¸‹æ¬¡ä½ æ¥çš„æ—¶å€™æˆ‘æ¥åŒ¹é…ä½ ã€‚session



**æ‹“å±•ï¼š**

httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®

ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼šå°±æ˜¯è¯´è¿™æ¬¡è¯·æ±‚å’Œä¸Šä¸€æ¬¡è¯·æ±‚æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œäº’ä¸è®¤è¯†ã€‚è¿™ç§æ— çŠ¶æ€çš„å¥½å¤„æ˜¯å¿«é€Ÿã€‚åå¤„æ˜¯å‡å¦‚æˆ‘ä»¬æƒ³è¦æŠŠ`www.zhihu.com/login.html`å’Œ`www.zhihu.com/index.html`å…³è”èµ·æ¥ï¼Œå¿…é¡»ä½¿ç”¨æŸäº›æ‰‹æ®µå’Œå·¥å…·

## 2.ä¼šè¯ä¿æŒçš„ä¸¤ç§æŠ€æœ¯

**cookie**

- å®¢æˆ·ç«¯æŠ€æœ¯ï¼ˆå“åº”ï¼Œè¯·æ±‚ï¼‰

**session**

- æœåŠ¡ç«¯æŠ€æœ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¿¡æ¯æˆ–è€…æ•°æ®æ”¾åœ¨sessionä¸­ã€‚



å¸¸è§åœºæ™¯ï¼š

- ç½‘ç«™ç™»å½•ä¹‹åï¼Œä½ ä¸‹æ¬¡ä¸ç”¨å†ç™»å½•äº†ï¼Œç¬¬äºŒæ¬¡è®¿é—®ç›´æ¥å°±ä¸Šå»äº†ã€‚



## 3.Cookie

1. ä»è¯·æ±‚ä¸­æ‹¿åˆ°cookieä¿¡æ¯

2. æœåŠ¡å™¨å“åº”ç»™å®¢æˆ·ç«¯cookie

   ```java
   Cookie[] cookies = req.getCookies();//è·å–cookie
   cookie.getName();//è·å–cookieä¸­çš„key
   cookie.getValue();//è·å–cookieä¸­çš„value
   Cookie cookie = new Cookie("lastLoginTime", "" + System.currentTimeMillis());//æ–°å»ºä¸€ä¸ªcookie
   cookie.setMaxAge(24*60*60);//è®¾ç½®cookieçš„æœ‰æ•ˆæœŸ
   resp.addCookie(cookie);//å“åº”ç»™å®¢æˆ·ç«¯ä¸€ä¸ªcookie
   ```

   **cookieï¼šä¸€èˆ¬ä¼šä¿å­˜åœ¨æœ¬åœ°çš„ç”¨æˆ·ç›®å½•ä¸‹/AppDataä¸‹**

   

**ä¸€ä¸ªç½‘ç«™cookieæ˜¯å¦å­˜åœ¨ä¸Šé™ï¼Ÿ**

- ä¸€ä¸ªcookieåªèƒ½ä¿å­˜ä¸€ä¸ªä¿¡æ¯
- ä¸€ä¸ªwebç«™ç‚¹å¯ä»¥ç»™æµè§ˆå™¨å‘é€å¤šä¸ªcookieï¼Œæ¯ä¸ªwebç«™ç‚¹æœ€å¤šå­˜æ”¾20ä¸ªcookieï¼ˆ ä¸åŒçš„æµè§ˆå™¨ä¼šæœ‰æ‰€ä¸åŒï¼‰
- cookieå¤§å°æœ‰é™åˆ¶4kb
- æµè§ˆå™¨ä¸Šé™æ˜¯300ä¸ªcookie



åˆ é™¤cookie

- ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå…³é—­æµè§ˆå™¨ï¼Œè‡ªåŠ¨å¤±æ•ˆ
- è®¾ç½®æœ‰æ•ˆæœŸæ—¶é—´ä¸º0



æ–°å»ºä¸€ä¸ªé¡¹ç›®

![image-20210914163641937](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210914163641937.png)

pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.zyy</groupId>
  <artifactId>javaweb-session-cookie</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>war</packaging>

  <dependencies>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>servlet-api</artifactId>
      <version>2.5</version>
    </dependency>

    <dependency>
      <groupId>javax.servlet.jsp</groupId>
      <artifactId>jsp-api</artifactId>
      <version>2.2</version>
    </dependency>

  </dependencies>
</project>
```

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1"
         metadata-complete="true">

    <servlet-mapping>
        <servlet-name>c1</servlet-name>
        <url-pattern>/c1</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>c1</servlet-name>
        <servlet-class>com.zyy.servlet.CookieDemo01</servlet-class>
    </servlet>


    <servlet-mapping>
        <servlet-name>c2</servlet-name>
        <url-pattern>/c2</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>c2</servlet-name>
        <servlet-class>com.zyy.servlet.CookieDemo02</servlet-class>
    </servlet>


    <servlet-mapping>
        <servlet-name>c3</servlet-name>
        <url-pattern>/c3</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>c3</servlet-name>
        <servlet-class>com.zyy.servlet.CookieDemo03</servlet-class>
    </servlet>

</web-app>
```

CookieDemo01.java

```java
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * @ClassName: CookieDemo01
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * ä¿å­˜ç”¨æˆ·ä¸Šä¸€æ¬¡çš„è®¿é—®æ—¶é—´
 * @Date: 2021/09/14 14:13
 * @Version: 1.0
 */
public class CookieDemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¸­æ–‡ä¹±ç 
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");

        PrintWriter writer = resp.getWriter();

        //cookieï¼ŒæœåŠ¡å™¨ä»å®¢æˆ·ç«¯ä¸­è·å–
        Cookie[] cookies = req.getCookies();//è¿™é‡Œè¿”å›çš„æ˜¯æ•°ç»„ï¼Œè¯´æ˜Cookieå¯èƒ½å­˜åœ¨å¤šä¸ª
        if (cookies == null) {
            writer.print("è¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡è®¿é—®æœ¬ç«™ï¼");
        } else {
            writer.print("æ‚¨ä¸Šä¸€æ¬¡è®¿é—®æœ¬ç«™çš„æ—¶é—´æ˜¯ï¼š" );
            for (int i = 0; i < cookies.length; i++) {
                Cookie cookie = cookies[i];
                if ("lastLoginTime".equals(cookie.getName())) {
                    long lastLoginTime = Long.parseLong(cookie.getValue());
                    Date date = new Date(lastLoginTime);
                    SimpleDateFormat sd = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                    writer.print(sd.format(date));
                }
            }
        }
        //æ·»åŠ  or æ›´æ–°
        Cookie cookie = new Cookie("lastLoginTime", "" + System.currentTimeMillis());
        //è®¾ç½®cookieä¸º1å¤©
        cookie.setMaxAge(24*60*60);
        resp.addCookie(cookie);
        writer.flush();
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

CookieDemo02.java

```java
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * @ClassName: CookieDemo02
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 14:13
 * @Version: 1.0
 */
public class CookieDemo02 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è§£å†³ä¸­æ–‡ä¹±ç 
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        //æ·»åŠ  or æ›´æ–°
        Cookie cookie = new Cookie("lastLoginTime", "" + System.currentTimeMillis());
        //è®¾ç½®æœ‰æ•ˆæœŸä¸º0
        cookie.setMaxAge(0);
        resp.addCookie(cookie);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

CookieDemo03.java

```java
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;
import java.net.URLDecoder;
import java.net.URLEncoder;

/**
 * @ClassName: CookieDemo03
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 14:13
 * @Version: 1.0
 */
public class CookieDemo03 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¸­æ–‡ä¹±ç 
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");

        PrintWriter writer = resp.getWriter();

        //cookieï¼ŒæœåŠ¡å™¨ä»å®¢æˆ·ç«¯ä¸­è·å–
        Cookie[] cookies = req.getCookies();
        if (cookies == null) {
            writer.print("è¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡è®¿é—®æœ¬ç«™ï¼");
        } else {
            for (int i = 0; i < cookies.length; i++) {
                Cookie cookie = cookies[i];
                if ("name".equals(cookie.getName())) {
                    //é˜²æ­¢ç½‘ç»œä¼ è¾“ä¸­æ–‡ä¹±ç é—®é¢˜
                    writer.print(URLDecoder.decode(cookie.getValue(), "UTF-8"));
                }
            }
        }
        //æ·»åŠ  or æ›´æ–°
        Cookie cookie = new Cookie("name", URLEncoder.encode("ç‹‚ç¥", "UTF-8"));
        resp.addCookie(cookie);
        writer.flush();
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

# 17.sessionè¯¦è§£

## 1.session(é‡ç‚¹)

ä»€ä¹ˆæ˜¯sessionï¼Ÿ

- æœåŠ¡å™¨ä¼šç»™æ¯ä¸€ä¸ªç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰åˆ›å»ºä¸€ä¸ªsessionå¯¹è±¡ï¼›
- ä¸€ä¸ªsessionç‹¬å ä¸€ä¸ªæµè§ˆå™¨ï¼Œåªè¦æµè§ˆå™¨æ²¡æœ‰å…³é—­ï¼Œsessionå°±å­˜åœ¨ï¼›
- ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ•´ä¸ªç½‘ç«™å®ƒéƒ½å¯ä»¥è®¿é—®ã€‚--ã€‹ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼›ä¿å­˜è´­ç‰©è½¦çš„ä¿¡æ¯

![image-20210914175131558](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210914175131558.png)

```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @ClassName: SessionDemo01
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 17:48
 * @Version: 1.0
 */
public class SessionDemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=utf-8");
        //è·å–session
        HttpSession session = req.getSession();
        //ç»™sessionå­˜å€¼
        session.setAttribute("name", "ç‹‚ç¥");
        //è·å–sessionçš„id
        String id = session.getId();
        if (session.isNew()) {
            resp.getWriter().write("sessionåˆ›å»ºæˆåŠŸï¼Œid:" + id);
        } else {
            resp.getWriter().write("sessionå·²ç»åœ¨æœåŠ¡å™¨ä¸­å­˜åœ¨äº†ï¼Œid:" + id);
        }
        resp.getWriter().flush();
        //sessionåˆ›å»ºçš„æ—¶å€™åšäº†ä»€ä¹ˆ
//        Cookie cookie = new Cookie("JSESSIONID", id);
//        resp.addCookie(cookie);

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```



```xml
    <servlet-mapping>
        <servlet-name>s1</servlet-name>
        <url-pattern>/s1</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>s1</servlet-name>
        <servlet-class>com.zyy.servlet.SessionDemo01</servlet-class>
    </servlet>
```



ä¹Ÿå¯ä»¥å­˜å¯¹è±¡

Person.java

```java
/**
 * @ClassName: Person
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/16 10:45
 * @Version: 1.0
 */
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                '}';
    }
}
```

```java
import com.zyy.pojo.Person;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @ClassName: SessionDemo01
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 17:48
 * @Version: 1.0
 */
public class SessionDemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=utf-8");
        //è·å–session
        HttpSession session = req.getSession();
        //ç»™sessionå­˜å€¼
        session.setAttribute("person", new Person("zyy", 18));
        //è·å–sessionçš„id
        String id = session.getId();
        if (session.isNew()) {
            resp.getWriter().write("sessionåˆ›å»ºæˆåŠŸï¼Œid:" + id);
        } else {
            resp.getWriter().write("sessionå·²ç»åœ¨æœåŠ¡å™¨ä¸­å­˜åœ¨äº†ï¼Œid:" + id);
        }
        resp.getWriter().flush();
        //sessionåˆ›å»ºçš„æ—¶å€™åšäº†ä»€ä¹ˆ
//        Cookie cookie = new Cookie("JSESSIONID", id);
//        resp.addCookie(cookie);

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

```java
import com.zyy.pojo.Person;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @ClassName: SessionDemo01
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 17:48
 * @Version: 1.0
 */
public class SessionDemo02 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=utf-8");
        //è·å–session
        HttpSession session = req.getSession();
        //ç»™sessionå­˜å€¼
        Person person = (Person) session.getAttribute("person");
        System.out.println(person.getName());

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```



æ¸…ç©ºsession

```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @ClassName: SessionDemo01
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/09/14 17:48
 * @Version: 1.0
 */
public class SessionDemo03 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("UTF-8");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=utf-8");
        //è·å–session
        HttpSession session = req.getSession();
        //æ‰‹åŠ¨æ³¨é”€session
        session.invalidate();
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

```xml
    <servlet-mapping>
        <servlet-name>s2</servlet-name>
        <url-pattern>/s2</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>s2</servlet-name>
        <servlet-class>com.zyy.servlet.SessionDemo02</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>s3</servlet-name>
        <url-pattern>/s3</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>s3</servlet-name>
        <servlet-class>com.zyy.servlet.SessionDemo03</servlet-class>
    </servlet>
```



æµ‹è¯•ï¼šå…ˆè°ƒç”¨/s3æ¸…ç©ºï¼Œåœ¨è°ƒç”¨/s2è·å–sessionä¿¡æ¯ï¼Œå°±ä¼šæŠ¥é”™

![image-20210916110204787](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916110204787.png)



web.xmlå¯ä»¥è®¾ç½®sessionè‡ªåŠ¨å¤±æ•ˆæ—¶é—´

```xml
    <session-config>
        <!--        è®¾ç½®sessionè‡ªåŠ¨å¤±æ•ˆæ—¶é—´ï¼Œå•ä½åˆ†é’Ÿ-->
        <session-timeout>1</session-timeout>
    </session-config>
```



sessionå’Œcookieçš„åŒºåˆ«

- cookieæ˜¯æŠŠç”¨æˆ·çš„æ•°æ®å†™ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¿å­˜ï¼ˆå¯ä»¥ä¿å­˜å¤šä¸ªï¼‰ï¼›
- sessionæ˜¯æŠŠç”¨æˆ·çš„æ•°æ®å†™åˆ°ç”¨æˆ·ç‹¬å çš„sessionä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ï¼ˆä¿å­˜é‡è¦çš„ä¿¡æ¯ï¼Œé¿å…æœåŠ¡å™¨çš„èµ„æºæµªè´¹ï¼‰ï¼›
- sessionç”±æœåŠ¡å™¨åˆ›å»º

![image-20210916151638102](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916151638102.png)

![image-20210916151719750](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916151719750.png)

ä½¿ç”¨åœºæ™¯ï¼š

- ä¿å­˜ä¸€ä¸ªç™»å½•ç”¨æˆ·çš„ä¿¡æ¯
- è´­ç‰©è½¦ä¿¡æ¯
- åœ¨æ•´ä¸ªç½‘ç«™ä¸­ç»å¸¸ä¼šä½¿ç”¨çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šå°†å®ƒä¿å­˜åœ¨sessionä¸­

# 18.jspåŸç†å‰–æ

## 1.ä»€ä¹ˆæ˜¯jsp

java server pagesï¼šjavaæœåŠ¡å™¨ç«¯é¡µé¢ï¼Œä¹Ÿæ˜¯servletä¸€æ ·ï¼Œç”¨äºåŠ¨æ€webæŠ€æœ¯ï¼

æœ€å¤§çš„ç‰¹åˆ«ï¼š

- å†™jspå°±åƒåœ¨å†™html
- åŒºåˆ«ï¼š
  - htmlåªç»™ç”¨æˆ·æä¾›é™æ€æ•°æ®
  - jspé¡µé¢ä¸­å¯ä»¥åµŒå…¥javaä»£ç ï¼Œä¸ºç”¨æˆ·æä¾›åŠ¨æ€æ•°æ®

## 2.jspåŸç†

æ€è·¯ï¼šjspåˆ°åº•æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿ

- ä»£ç å±‚é¢çœ‹ä¸å‡ºå•¥ï¼ˆjspï¼‰

- æœåŠ¡å™¨å†…éƒ¨å·¥ä½œ

  tomcatä¸­æœ‰ä¸€ä¸ªworkç›®å½•

  ideaä½¿ç”¨tomcatçš„ä¼šåœ¨ideaçš„tomcatä¸­ç”Ÿäº§ä¸€ä¸ªworkç›®å½•

  ![image-20210916171409301](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916171409301.png)

  æˆ‘ç”µè„‘çš„åœ°å€

  ```
  C:\Users\ZHAYUYAO\.IntelliJIdea2019.3\system\tomcat\Unnamed_javaweb-session-cookie_2\work\Catalina\localhost\ROOT\org\apache\jsp
  ```

  å‘ç°é¡µé¢è½¬å˜äº†javaç¨‹åºï¼

  ![image-20210916171635409](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916171635409.png)

  **æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®ä»€ä¹ˆèµ„æºï¼Œå…¶å®éƒ½æ˜¯åœ¨è®¿é—®servlet**

  jspæœ€ç»ˆä¹Ÿä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªjavaç±»

  jspæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªservlet

  ```java
  public final class index_jsp extends org.apache.jasper.runtime.HttpJspBase
      implements org.apache.jasper.runtime.JspSourceDependent,
                   org.apache.jasper.runtime.JspSourceImports {
                       
                   }
  ```

  ```java
  public abstract class HttpJspBase extends HttpServlet implements HttpJspPage {}
  ```

  ![image-20210916174826173](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210916174826173.png)

  æºç åˆ†æ

  ```java
  public final class index_jsp extends org.apache.jasper.runtime.HttpJspBase
      implements org.apache.jasper.runtime.JspSourceDependent,
                   org.apache.jasper.runtime.JspSourceImports {
    //åˆå§‹åŒ–      
    public void _jspInit() {
    }
    //é”€æ¯
    public void _jspDestroy() {
    }
    //jsp service
    public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {
        //1.è¯·æ±‚æ–¹å¼åˆ¤æ–­  
        //...
        //2.å†…ç½®ä¸€äº›å¯¹è±¡
      final javax.servlet.jsp.PageContext pageContext;//é¡µé¢ä¸Šä¸‹æœ¬
      javax.servlet.http.HttpSession session = null;//session
      final javax.servlet.ServletContext application;//applicationContext
      final javax.servlet.ServletConfig config;//config
      javax.servlet.jsp.JspWriter out = null;//out
      final java.lang.Object page = this;//page:å½“å‰
        //...
        //3.è¾“å‡ºé¡µé¢å‰å¢åŠ çš„ä»£ç 
        response.setContentType("text/html");//è®¾ç½®å“åº”é¡µé¢ç±»å‹
        pageContext = _jspxFactory.getPageContext(this, request, response,
        			null, true, 8192, true);
        _jspx_page_context = pageContext;
        application = pageContext.getServletContext();
        config = pageContext.getServletConfig();
        session = pageContext.getSession();
        out = pageContext.getOut();
        _jspx_out = out;
        //4.ä»¥ä¸Šçš„è¿™äº›ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥åœ¨jspä¸­ç›´æ¥ä½¿ç”¨ã€‚
    }
  }
  ```

  ![image-20210917114741104](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917114741104.png)
  
  åœ¨jspé¡µé¢ä¸­
  
  åªè¦æ˜¯javaä»£ç å°±ä¼šåŸå°ä¸åŠ¨çš„è¾“å‡º
  
  å¦‚æœæ˜¯htmlä»£ç ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸º
  
  ```java
        out.write("    <title>Title</title>\r\n");
  ```
  
  è¿™æ ·çš„æ ¼å¼è¾“å‡ºåˆ°å‰ç«¯
  
  ![image-20210917140311036](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917140311036.png)

# 19.jspåŸºç¡€è¯­æ³•å’ŒæŒ‡ä»¤

ä»»ä½•è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è¯­æ³•ï¼Œjavaæœ‰ï¼Œjspä½œä¸ºjavaæŠ€æœ¯çš„ä¸€ç§åº”ç”¨ï¼Œå®ƒæ‹¥æœ‰ä¸€äº›è‡ªå·±æ‰©å……çš„è¯­æ³•ï¼ˆäº†è§£ï¼ŒçŸ¥é“å³å¯ï¼‰ï¼Œjavaæ‰€æœ‰è¯­æ³•éƒ½æ”¯æŒã€‚

æ–°å»ºä¸€ä¸ªé¡¹ç›®

![image-20210917160225800](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917160225800.png)

å¯¼åŒ…pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.zyy</groupId>
    <artifactId>javaweb-jsp</artifactId>
    <version>1.0-SNAPSHOT</version>

    <dependencies>
        <!--        servletä¾èµ–-->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.5</version>
        </dependency>
        <!--        jspä¾èµ–-->
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>javax.servlet.jsp-api</artifactId>
            <version>2.3.3</version>
        </dependency>
        <!--        jstlä¾èµ–-->
        <dependency>
            <groupId>javax.servlet.jsp.jstl</groupId>
            <artifactId>jstl-api</artifactId>
            <version>1.2</version>
        </dependency>
        <!--      standardæ ‡ç­¾åº“  -->
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <version>1.1.2</version>
        </dependency>
    </dependencies>


</project>
```



## 1.jspè¡¨è¾¾å¼

```jsp
<%@ page import="java.util.Date" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>$Title$</title>
  </head>
  <body>
  <%--jspè¡¨è¾¾å¼
  ä½œç”¨ï¼šç”¨æ¥å°†ç¨‹åºçš„è¾“å‡ºåˆ°å®¢æˆ·ç«¯
  <%= å˜é‡æˆ–è€…è¡¨è¾¾å¼%>
  --%>
  <%=new Date()%>
  </body>
</html>
```

## 2.jspè„šæœ¬ç‰‡æ®µ

```jsp
<%--jspè„šæœ¬ç‰‡æ®µ--%>
<%
  int sum = 0;
  for (int i = 1; i <= 100; i++) {
    sum += i;
  }
  out.print("<h1>sum=" + sum + "</h1>");
%>
```

![image-20210917161007608](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917161007608.png)

## 3.è„šæœ¬ç‰‡æ®µçš„å†å®ç°

```jsp
<br/>
<%
  int i = 5;
  out.print("i=" + i);
%>
<br/>
<%
  i += 5;
  out.print("i=" + i);
%>

<%--åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ --%>
<%
  for (int j = 0; j < 5; j++) {
%>
<h2>hello<%=j%></h2>
<%
  }
%>
```

![image-20210917164140678](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917164140678.png)

![image-20210917164618245](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917164618245.png)

## 4.jspç”³æ˜

```jsp
<%!
  static {
    System.out.println("servlet load...");
  }

  private String globalVar = "zyy";

  public void zyy() {
    System.out.println("è¿›å…¥äº†zyyæ–¹æ³•ï¼");
  }
%>

<%zyy();%>
```

![image-20210917165242704](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917165242704.png)

![image-20210917165318862](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917165318862.png)



jspå£°æ˜ï¼Œä¼šè¢«ç¼–è¯‘åˆ°jspç”Ÿæˆjavaä»£ç çš„ç±»ä¸­ï¼å…¶ä»–çš„ï¼Œå°±ä¼šè¢«ç”Ÿæˆåˆ°_jspServiceæ–¹æ³•ä¸­ï¼

åœ¨jspï¼ŒåµŒå…¥javaä»£ç å³å¯

```jsp
<%%> ç‰‡æ®µ
<%=%> è¡¨è¾¾å¼è¾“å‡ºå€¼
<%!%> å£°æ˜

<%--æ³¨é‡Š--%>
```



![image-20210917173452859](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917173452859.png)

æŸ¥çœ‹é¡µé¢æºä»£ç 

![image-20210917173514533](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917173514533.png)

å‘ç°ï¼šjspçš„æ³¨é‡Šï¼Œä¸ä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºï¼Œhtmlä¼šï¼

## 5.jspæŒ‡ä»¤

```jsp
<%@ page args... %>

<%@include file=""%>
```



```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%
  int i = 1/0;
%>

</body>
</html>
```

![image-20210917180800096](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917180800096.png)

å®šåˆ¶é”™è¯¯é¡µé¢

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%--å®šåˆ¶é”™è¯¯é¡µé¢--%>
<%@ page errorPage="error/500.jsp" %>
<%
  int i = 1/0;
%>

</body>
</html>
```

500.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>error</title>
</head>
<body>
<img src="../img/error_500.jpg">
</body>
</html>
```

![image-20210917180940414](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917180940414.png)

éªŒè¯

![image-20210917180853653](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917180853653.png)

æˆ–è€…web.xmlä¸­é…ç½®é”™è¯¯é¡µé¢

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%
  int i = 1/0;
%>
</body>
</html>
```

**web.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <error-page>
        <error-code>500</error-code>
        <location>/error/500.jsp</location>
    </error-page>
    <error-page>
        <error-code>404</error-code>
        <location>/error/404.jsp</location>
    </error-page>

</web-app>
```

404.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>error</title>
</head>
<body>
<img src="../img/error_404.jpg">
</body>
</html>
```

![image-20210917181540567](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917181540567.png)

æµ‹è¯•ï¼š

![image-20210917181636053](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917181636053.png)

`<%@include "%>`

footer.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<h1>æˆ‘æ˜¯Footer</h1>
```

header.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<h1>æˆ‘æ˜¯Header</h1>
```

jsp2.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%@include file="common/header.jsp"%>
<h1>ç½‘é¡µä¸»ä½“</h1>
<%@include file="common/footer.jsp"%>

</body>
</html>
```

æµ‹è¯•ï¼š

![image-20210917182718104](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917182718104.png)

jspæ ‡ç­¾

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%--
%@includeä¼šå°†ä¸¤ä¸ªé¡µé¢åˆäºŒä¸ºä¸€ æ³¨æ„é¡µé¢åˆå¹¶åçš„å†²çªï¼ˆæ¯”å¦‚ä¸¤ä¸ªé¡µé¢éƒ½å®šä¹‰äº†int i = 10  è¿™ç§ä¼šæŠ¥é”™ï¼‰
--%>
<%@include file="common/header.jsp"%>
<h1>ç½‘é¡µä¸»ä½“</h1>
<%@include file="common/footer.jsp"%>

<hr/>

<%--jspæ ‡ç­¾
jsp:include æ‹¼æ¥é¡µé¢ æœ¬è´¨è¿˜æ˜¯ä¸‰ä¸ª   æ¨èä½¿ç”¨è¿™ç§ï¼Œè¿™ç§ä¸ä¼šå‡ºç°ä¸Šé¢çš„int i=10å†²çªçš„æƒ…å†µï¼Œå› ä¸ºæœ¬è´¨è¿˜æ˜¯ä¸‰ä¸ªé¡µé¢
--%>
<jsp:include page="common/header.jsp"/>
<h1>ç½‘é¡µä¸»ä½“</h1>
<jsp:include page="common/footer.jsp"/>

</body>
</html>
```

![image-20210917183430249](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917183430249.png)

åˆ†æä¸€ä¸‹æºç 

![image-20210917183509464](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917183509464.png)

![image-20210917183532234](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210917183532234.png)



# 20.jspå†…ç½®å¯¹è±¡åŠä½œç”¨åŸŸ

## 1.ä¹å¤§å†…ç½®å¯¹è±¡

1. PageContextã€å­˜ä¸œè¥¿ã€‘
2. Request ã€å­˜ä¸œè¥¿ã€‘
3. Response
4. Sessionã€å­˜ä¸œè¥¿ã€‘
5. Applicationï¼ˆServletContextï¼‰ã€å­˜ä¸œè¥¿ã€‘
6. configï¼ˆServletConfigï¼‰
7. out
8. page ã€åŸºæœ¬ç”¨ä¸åˆ°ã€‘
9. exception



æ–°å»ºpageContextDemo1.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%--å†…ç½®å¯¹è±¡--%>
<%
    pageContext.setAttribute("name1","zyy01");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€ä¸ªé¡µé¢ä¸­æœ‰æ•ˆ
    request.setAttribute("name2","zyy02");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œè¯·æ±‚è½¬å‘ä¼šæºå¸¦è¿™ä¸ªæ•°æ®
    session.setAttribute("name3","zyy03");//ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æµè§ˆå™¨åˆ°å…³é—­æµè§ˆå™¨
    application.setAttribute("name4","zyy04");//ä¿å­˜çš„æ•°æ®åªåœ¨æœåŠ¡å™¨ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æœåŠ¡å™¨åˆ°å…³é—­æœåŠ¡å™¨
%>

<%--è„šæœ¬ç‰‡æ®µä¸­çš„ä»£ç ï¼Œä¼šåŸå°ä¸åŠ¨ç”Ÿæˆxxx.jsp.java
è¦æ±‚ï¼šè¿™é‡Œé¢çš„ä»£ç ï¼Œå¿…é¡»ä¿è¯javaè¯­æ³•çš„æ­£ç¡®æ€§
--%>
<%
    //ä»pageContextå–å‡ºï¼Œæˆ‘ä»¬é€šè¿‡å¯»æ‰¾çš„æ–¹å¼æ¥
    String name1 = (String) pageContext.findAttribute("name1");
    String name2 = (String) pageContext.findAttribute("name2");
    String name3 = (String) pageContext.findAttribute("name3");
    String name4 = (String) pageContext.findAttribute("name4");
    String name5 = (String) pageContext.findAttribute("name5");//ä¸å­˜åœ¨
%>
<%--ä½¿ç”¨elè¡¨è¾¾å¼è¾“å‡º  ${} --%>
<h1>å–å‡ºçš„å€¼ä¸º</h1>
<h3>${name1}</h3>
<h3>${name2}</h3>
<h3>${name3}</h3>
<h3>${name4}</h3>
<h3>${name5}ä¸å­˜åœ¨</h3>
<h3><%=name5%>ä¸å­˜åœ¨</h3>
</body>
</html>
```

![image-20210923175422947](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20210923175422947.png)

æ–°å»ºpageContextDemo2.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%
    //ä»pageContextå–å‡ºï¼Œæˆ‘ä»¬é€šè¿‡å¯»æ‰¾çš„æ–¹å¼æ¥
    String name1 = (String) pageContext.findAttribute("name1");
    String name2 = (String) pageContext.findAttribute("name2");
    String name3 = (String) pageContext.findAttribute("name3");
    String name4 = (String) pageContext.findAttribute("name4");
    String name5 = (String) pageContext.findAttribute("name5");//ä¸å­˜åœ¨
%>
<%--ä½¿ç”¨elè¡¨è¾¾å¼è¾“å‡º  ${} --%>
<h1>å–å‡ºçš„å€¼ä¸º</h1>
<h3>${name1}</h3>
<h3>${name2}</h3>
<h3>${name3}</h3>
<h3>${name4}</h3>
<h3>${name5}ä¸å­˜åœ¨</h3>
<h3><%=name5%>ä¸å­˜åœ¨</h3>
</body>
</html>
```

ç»“æœï¼ˆéœ€è¦å…ˆè¯·æ±‚ä¸€ä¸‹pageContextDemo1.jspç„¶åå†è¯·æ±‚pageContextDemo2.jspï¼Œä¸ç„¶éƒ½å–ä¸åˆ°å€¼ï¼‰

![image-20211008221622575](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211008221622575.png)

æ–°å»ºpageContextDemo3.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>


<%--
  public void setAttribute (String name,
			    Object attribute,
			    int scope)
  {
    switch (scope) {
    case PAGE_SCOPE:
      mPage.put (name, attribute);
      break;
    case REQUEST_SCOPE:
      mRequest.put (name, attribute);
      break;
    case SESSION_SCOPE:
      mSession.put (name, attribute);
      break;
    case APPLICATION_SCOPE:
      mApp.put (name, attribute);
      break;
    default:
      throw new IllegalArgumentException  ("Bad scope " + scope);
    }
  }
--%>

<%--å†…ç½®å¯¹è±¡--%>
<%
    pageContext.setAttribute("name1","zyy01", PageContext.REQUEST_SCOPE);
    //ç­‰ä»·äº request.setAttribute("name1","zyy01");
%>
</body>
</html>
```

æ–°å»ºpageContextDemo4.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<%
    pageContext.forward("/index.jsp");
    //request.getRequestDispatcher("/index.jsp").forward(request, response);
%>
</body>
</html>
```

![image-20211008223212809](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211008223212809.png)

request:å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·çœ‹å®Œå°±æ²¡ç”¨äº†ï¼Œæ¯”å¦‚ï¼šæ–°é—»

session:å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·ç”¨å®Œä¸€ä¼šè¿˜æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼šè´­ç‰©è½¦

application:å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œä¸€ä¸ªç”¨æˆ·ç”¨å®Œäº†ï¼Œå…¶ä»–ç”¨æˆ·è¿˜å¯èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šèŠå¤©æ•°æ®

# 21.jspã€jstlæ ‡ç­¾ã€ELè¡¨è¾¾å¼

å¯¼åŒ…

```xml

        </dependency>
        <!--        jstlä¾èµ–-->
        <dependency>
            <groupId>javax.servlet.jsp.jstl</groupId>
            <artifactId>jstl-api</artifactId>
            <version>1.2</version>
        </dependency>
        <!--      standardæ ‡ç­¾åº“  -->
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <version>1.1.2</version>
        </dependency>
```

ELè¡¨è¾¾å¼ï¼š ${ }

- **è·å–æ•°æ®**
- **æ‰§è¡Œè¿ç®—**
- **è·å–webå¼€å‘çš„å¸¸ç”¨å¯¹è±¡**
- è°ƒç”¨javaæ–¹æ³•



**jspæ ‡ç­¾**

jsptag.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<h1>tag1</h1>
<%--<jsp:include>--%>

<%-- http://localhost:8080/jsptag.jsp?name=zyy&age=18 --%>
<jsp:forward page="/jsptag2.jsp">
    <jsp:param name="name" value="zyy"/>
    <jsp:param name="age" value="18"/>
</jsp:forward>

</body>
</html>

```

jsptag2.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<h1>tag2</h1>
å§“åï¼š<%=request.getParameter("name")%>
å¹´é¾„ï¼š<%=request.getParameter("age")%>
</body>
</html>
```

![image-20211009140744482](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211009140744482.png)

**JSTLæ ‡ç­¾**

jstlæ ‡ç­¾åº“çš„ä½¿ç”¨å°±æ˜¯ä¸ºäº†å¼¥è¡¥htmlæ ‡ç­¾çš„ä¸è¶³ï¼›å®ƒè‡ªå®šä¹‰äº†è®¸å¤šæ ‡ç­¾ï¼Œå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæ ‡ç­¾çš„åŠŸèƒ½å’Œjavaä»£ç ä¸€æ ·ï¼

- æ ¸å¿ƒæ ‡ç­¾ï¼ˆæŒæ¡ï¼‰

- æ ¼å¼åŒ–æ ‡ç­¾

- sqlæ ‡ç­¾

- xmlæ ‡ç­¾



æ ¸å¿ƒæ ‡ç­¾å¦‚ä¸‹ï¼š

![image-20211104162847227](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211104162847227.png)



JSTLæ ‡ç­¾åº“ä½¿ç”¨æ­¥éª¤ï¼š

- å¼•ç”¨å¯¹åº”çš„taglib

- ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•

- åœ¨tomcatä¹Ÿéœ€è¦å¼•å…¥jstlçš„åŒ…ï¼Œå¦åˆ™ä¼šæŠ¥é”™

  ```
      org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:55)
  
  ```

coreIf.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%--å¼•å…¥jstlæ ¸å¿ƒæ ‡ç­¾åº“ï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨jstlæ ‡ç­¾ core--%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<h4>ifæµ‹è¯•</h4>
<form action="coreIf.jsp" method="get">
    <%--
    elè¡¨è¾¾å¼è·å–è¡¨å•ä¸­çš„æ•°æ®
    ${param.å‚æ•°å}
    --%>
    <input type="text" name="username" value="${param.username}">
    <input type="submit" value="ç™»å½•">
</form>

<%--åˆ¤æ–­å¦‚æœæäº¤çš„ç”¨æˆ·åæ˜¯ç®¡ç†å‘˜ï¼Œåˆ™ç™»å½•æˆåŠŸ--%>
<c:if test="${param.username=='admin'}" var="isAdmin">
    <c:out value="ç®¡ç†å‘˜ï¼"></c:out>
</c:if>

<c:out value="${isAdmin}"></c:out>

</body>
</html>

```

coreWhen.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<c:set var="score" value="100"/>
<c:choose>
    <c:when test="${score>90}">ä¼˜ç§€</c:when>
    <c:when test="${score>80}">è‰¯å¥½</c:when>
    <c:when test="${score>60}">ä¸€èˆ¬</c:when>
    <c:otherwise>ä¸åŠæ ¼</c:otherwise>
</c:choose>
</body>
</html>

```

coreForeach.jsp

```jsp
<%@ page import="java.util.ArrayList" %>
<%@ page import="java.util.List" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<%
    List<String> personList = new ArrayList<>();
    personList.add(0, "å¼ ä¸‰");
    personList.add(1, "æå››");
    personList.add(2, "ç‹äº”");
    personList.add(3, "èµµå…­");
    request.setAttribute("personList", personList);
%>

<%--
var æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„å˜é‡
item è¦éå†çš„å¯¹è±¡
begin å¼€å§‹ä¸‹æ ‡
end ç»“æŸä¸‹æ ‡
step  æ­¥é•¿
--%>
<c:forEach var="person" items="${personList}">
    <c:out value="${person}"/><br/>
</c:forEach>
<hr/>
<c:forEach var="person" items="${personList}" begin="1" end="3" step="2">
    <c:out value="${person}"/><br/>
</c:forEach>

</body>
</html>

```

# 22.javabeanåŠä½œä¸š

å®ä½“ç±»

javaBeanç‰¹å®šçš„å†™æ³•ï¼š

- å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ 
- å±æ€§å¿…é¡»ç§æœ‰åŒ–
- å¿…é¡»æœ‰å¯¹åº”çš„get/setæ–¹æ³•

ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“å­—æ®µåšæ˜ å°„

ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„

- è¡¨--->ç±»
- å­—æ®µ--->å±æ€§
- è¡Œè®°å½•-->å¯¹è±¡

| id   | name | age  | address |
| ---- | ---- | ---- | ------- |
| 1    | å¼ ä¸‰ | 18   | æ·±åœ³    |
| 2    | æå›› | 17   | æ·±åœ³    |
| 3    | ç‹äº” | 18   | æ·±åœ³    |

```java
public class Student {
    private int id;
    private String name;
    private int age;
    private String address;
    //...çœäº†æ„é€ æ–¹æ³•å’Œget set æ–¹æ³•
}
```

javabean.jsp

```xml
<%@ page import="com.zyy.pojo.Student" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<%
//    Student student = new Student();
//    student.setAddress("æ·±åœ³");
//    student.setAge(18);
//    student.setId(1);
//    student.setName("zyy");
%>

<jsp:useBean id="student" class="com.zyy.pojo.Student" scope="page"/>

<jsp:setProperty name="student" property="address" value="æ·±åœ³"/>
<jsp:setProperty name="student" property="age" value="18"/>
<jsp:setProperty name="student" property="id" value="1"/>
<jsp:setProperty name="student" property="name" value="zyy"/>

<%--  <%=student.getAddress()%>   --%>
åœ°å€ï¼š<jsp:getProperty name="student" property="address"/>
å¹´é¾„ï¼š<jsp:getProperty name="student" property="age"/>
idï¼š<jsp:getProperty name="student" property="id"/>
å§“åï¼š<jsp:getProperty name="student" property="name"/>

</body>
</html>

```



# 23.mvcä¸‰å±‚æ¶æ„

ä»€ä¹ˆæ˜¯MVCï¼šModel  View  Controller  æ¨¡å‹è§†å›¾æ§åˆ¶å™¨

## 1.æ—©äº›å¹´

ç”¨æˆ·ç›´æ¥è®¿é—®æ§åˆ¶å±‚ï¼Œæ§åˆ¶å±‚å°±å¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“ 

![image-20220729152928593](D:\ç®—æ³•Typora\picture\image-20220729152928593.png)



```
servlet--CRUD[å¢åŠ (Create)ã€æ£€ç´¢(Retrieve)ã€æ›´æ–°(Update)å’Œåˆ é™¤(Delete)]-->æ•°æ®åº“
å¼Šç«¯ï¼šç¨‹åºååˆ†è‡ƒè‚¿ï¼Œä¸åˆ©äºç»´æŠ¤
servletçš„ä»£ç ä¸­ï¼šå¤„ç†è¯·æ±‚ã€å“åº”ã€è§†å›¾è·³è½¬ã€å¤„ç†jdbcã€å¤„ç†ä¸šåŠ¡ä»£ç ã€å¤„ç†é€»è¾‘ä»£ç 
    
æ¶æ„ï¼šæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚è§£å†³ä¸äº†çš„ï¼

ç¨‹åºå‘˜è°ƒç”¨
|
JDBC
|
Mysql Oracle SqlService

```

## 2.MVCä¸‰å±‚æ¶æ„

![image-20211110220623517](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211110220623517.png)

View

- å±•ç¤ºæ•°æ®
- æä¾›é“¾æ¥å‘èµ·Servletè¯·æ±‚

Controller

- æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼ˆreq:è¯·æ±‚å‚æ•°  Sessionä¿¡æ¯ã€‚ã€‚ã€‚ï¼‰

- äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†å¯¹åº”çš„ä»£ç 

- æ§åˆ¶è¯•å›¾çš„è·³è½¬

  ```java
  ç™»å½•  -->  æ¥æ”¶ç”¨æˆ·çš„ç™»å½•è¯·æ±‚  
  -->  å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ˆè·å–ç”¨æˆ·ç™»å½•çš„å‚æ•°ï¼Œusername,passwordï¼‰
  -->  äº¤ç»™ä¸šåŠ¡å¤„ç†ç™»å½•ä¸šåŠ¡ï¼ˆåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ï¼šäº‹åŠ¡ï¼‰
  -->  Daoå±‚æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
  -->  æ•°æ®åº“
  ```
  


Model

- ä¸šåŠ¡å¤„ç†ï¼šä¸šåŠ¡é€»è¾‘ï¼ˆServiceï¼‰
- æ•°æ®æŒä¹…å±‚ï¼šCRUDï¼ˆDaoï¼‰



# 24.è¿‡æ»¤å™¨Filter

Filterï¼šè¿‡æ»¤å™¨

- å¤„ç†ä¸­æ–‡ä¹±ç 
- ç™»å½•éªŒè¯...

![image-20220729153824004](D:\ç®—æ³•Typora\picture\image-20220729153824004.png)

filterå¼€å‘æ­¥éª¤

- å¯¼åŒ…1

- ç¼–å†™è¿‡æ»¤å™¨

  - åŒ…ä¸è¦å¯¼å…¥é”™è¯¯äº†

    ```java
    import javax.servlet.Filter;
    ```

  - å®ç°Filteræ¥å£ï¼Œé‡å†™å¯¹åº”çš„æ–¹æ³•å³å¯

  - web.xmlä¸­é…ç½®è¿‡æ»¤å™¨

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1"
         metadata-complete="true">
    <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.zyy.servlets.HelloServlet</servlet-class>
    </servlet>


    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/servlet/hello</url-pattern>
    </servlet-mapping>

    <filter>
        <filter-name>characterEncodingFilter</filter-name>
        <filter-class>com.zyy.filters.CharacterEncodingFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>characterEncodingFilter</filter-name>
        <url-pattern>/servlet/*</url-pattern>
    </filter-mapping>


</web-app>
```

HelloServlet.java

```java
package com.zyy.servlets;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: HelloServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/11/12 16:21
 * @Version: 1.0
 */
public class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        resp.getWriter().write("ä½ å¥½ï¼Œä¸–ç•Œï¼");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        this.doGet(req, resp);
    }
}

```

```java
package com.zyy.filters;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import java.io.IOException;

/**
 * @ClassName: CharacterEncodingFilter
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/11/12 16:14
 * @Version: 1.0
 */
public class CharacterEncodingFilter implements Filter {
    /**
     * åˆå§‹åŒ–
     * webæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œåˆå§‹åŒ–å°±ä¼šæ‰§è¡Œ
     * @param filterConfig
     * @throws ServletException
     */
    public void init(FilterConfig filterConfig) throws ServletException {
        System.out.println("CharacterEncodingFilter åˆå§‹åŒ–ã€‚ã€‚ã€‚");

    }

    /**
     * chain é“¾
     * 1.è¿‡æ»¤å™¨ä¸­çš„ä»£ç ï¼Œåœ¨è¿‡æ»¤ç‰¹å®šè¯·æ±‚çš„æ—¶å€™ä¼šæ‰§è¡Œ
     * 2.å¿…é¡»è®©è¿‡æ»¤å™¨ç»§ç»­é€šè¡Œ
     *   chain.doFilter(request, response);
     * @param request
     * @param response
     * @param chain
     * @throws IOException
     * @throws ServletException
     */
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        request.setCharacterEncoding("GBK");
        response.setCharacterEncoding("GBK");
        System.out.println("doFilteræ‰§è¡Œå‰ã€‚ã€‚ã€‚ã€‚");
        //è®©è¯·æ±‚ç»§ç»­èµ°ï¼Œå¦‚æœä¸å†™ç¨‹åºåˆ°è¿™é‡Œå°±è¢«æ‹¦æˆªåœæ­¢äº†ï¼
        chain.doFilter(request, response);
        System.out.println("doFilteræ‰§è¡Œåã€‚ã€‚ã€‚ã€‚");
    }

    /**
     * é”€æ¯
     * webæœåŠ¡å™¨å…³é—­çš„æ—¶å€™ï¼Œè¿‡æ»¤å™¨ä¼šé”€æ¯
     */
    public void destroy() {
        System.out.println("CharacterEncodingFilter é”€æ¯ã€‚ã€‚ã€‚");

    }
}

```



# 25.ç›‘å¬å™¨

å®ç°ä¸€ä¸ªç›‘å¬å™¨çš„æ¥å£(æœ‰Nç§)

1. å®ç°ä¸€ä¸ªç›‘å¬å™¨æ¥å£

   ```java
   import javax.servlet.ServletContext;
   import javax.servlet.http.HttpSessionEvent;
   import javax.servlet.http.HttpSessionListener;
   
   /**
    * @ClassName: OnLineCountListener
    * @Description: ç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°ï¼Œç»Ÿè®¡sessionæ•°
    * @Author: zyy
    * @Date: 2021/12/01 17:17
    * @Version: 1.0
    */
   public class OnLineCountListener implements HttpSessionListener {
       /**
        * åˆ›å»ºsessionç›‘å¬ï¼Œä¸€æ—¦åˆ›å»ºsessionå°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶
        * @param se
        */
       public void sessionCreated(HttpSessionEvent se) {
           System.out.println(se.getSession().getId());
           ServletContext servletContext = se.getSession().getServletContext();
           Integer onLineCount = (Integer) servletContext.getAttribute("onLineCount");
           if (onLineCount == null) {
               onLineCount = new Integer(1);
           } else {
               onLineCount = new Integer(onLineCount + 1);
           }
   
           servletContext.setAttribute("onLineCount", onLineCount);
   
       }
   
       /**
        * é”€æ¯sessionç›‘å¬ï¼Œä¸€æ—¦é”€æ¯sessionå°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶
        * @param se
        */
       public void sessionDestroyed(HttpSessionEvent se) {
           ServletContext servletContext = se.getSession().getServletContext();
           Integer onLineCount = (Integer) servletContext.getAttribute("onLineCount");
           if (onLineCount == null) {
               onLineCount = new Integer(0);
           } else {
               onLineCount = new Integer(onLineCount - 1);
           }
   
           servletContext.setAttribute("onLineCount", onLineCount);
   
           se.getSession().invalidate();
   
       }
   
       /**
        * sessionçš„é”€æ¯
        * 1.æ‰‹åŠ¨é”€æ¯  getSession().invalidate();
        * 2.è‡ªåŠ¨é”€æ¯
        *     <session-config>
        *         <session-timeout>1</session-timeout>
        *     </session-config>
        *
        * 3.å…³é—­æœåŠ¡å™¨
        */
   }
   ```

2. é…ç½®ç›‘å¬å™¨web.xml

   ```xml
       <!--    æ³¨å†Œç›‘å¬å™¨-->
       <listener>
           <listener-class>com.zyy.listeners.OnLineCountListener</listener-class>
       </listener>
   ```

3. é¡µé¢éªŒè¯

   ```jsp
   <%@ page contentType="text/html;charset=UTF-8" language="java" %>
   <html>
     <head>
       <title>$Title$</title>
     </head>
     <body>
     <h1>å½“å‰å…±æœ‰<span><%=this.getServletConfig().getServletContext().getAttribute("onLineCount")%></span>äººè®¿é—®</h1>
     </body>
   </html>
   ```

   ![image-20211201174935212](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211201174935212.png)

# 26.ç›‘å¬å™¨GUIä¸­ç†è§£

## 1.è¿‡æ»¤å™¨ï¼Œç›‘å¬å™¨å¸¸è§åº”ç”¨

**ç›‘å¬å™¨ï¼šGUIç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨**

```java
import java.awt.*;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;

/**
 * @ClassName: TestPanel
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/02 15:15
 * @Version: 1.0
 */
public class TestPanel {
    public static void main(String[] args) {
        Frame frame = new Frame("æµ‹è¯•");
        Panel panel = new Panel();

        frame.setLayout(null);
        frame.setBounds(300, 300, 500, 500);
        frame.setBackground(new Color(0, 0, 255));

        panel.setBounds(50, 50, 300, 300);
        panel.setBackground(new Color(255, 0, 0));

        frame.add(panel);
        frame.setVisible(true);

        //æ·»åŠ ä¸€ä¸ªçª—å£å…³é—­çš„ç›‘å¬äº‹ä»¶
        frame.addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent e) {
                System.exit(0);
            }
        });

    }
}
```

ç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½è¿›å…¥ä¸»é¡µï¼ç”¨æˆ·æ³¨é”€åå°±ä¸èƒ½è¿›å…¥ä¸»é¡µäº†ï¼

1. ç”¨æˆ·ç™»å½•åï¼Œæƒ³sessionä¸­æ”¾å…¥ç”¨æˆ·ä¿¡æ¯
2. è¿›å…¥ä¸»é¡µçš„æ—¶å€™è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼ˆè¦æ±‚ï¼šåœ¨è¿‡æ»¤å™¨ä¸­å®ç°ï¼‰

# 27.Filterå®ç°æƒé™æ‹¦æˆª

![image-20211202175207924](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211202175207924.png)

ç™»å½•é¡µé¢login.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<form method="post" action="/servlet/login">
    <input type="text" name="username">
    <input type="submit">
</form>

</body>
</html>

```

é”™è¯¯é¡µé¢error.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>

<h1>å¤±è´¥</h1>

<h1>æ²¡æœ‰æƒé™ï¼Œç”¨æˆ·è¾“å…¥æœ‰è¯¯</h1>

<p><a href="login.jsp">è¿”å›ç™»å½•é¡µé¢</a></p>

</body>
</html>

```

ç™»å½•æ¥å£LoginServlet

```java
import com.zyy.utils.Constant;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: LoginServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/02 15:32
 * @Version: 1.0
 */
public class LoginServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String userName = req.getParameter("username");
        if ("admin".equals(userName)) {
            //ç™»å½•æˆåŠŸ
            req.getSession().setAttribute(Constant.USER_SESSION, req.getSession().getId());
            //è·³è½¬
            resp.sendRedirect("/sys/success.jsp");
        } else {
            //ç™»å½•å¤±è´¥
            resp.sendRedirect("/error.jsp");

        }

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

æ³¨é”€é¡µé¢LogoutServlet

```java
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: LogoutServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/02 16:28
 * @Version: 1.0
 */
public class LogoutServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {

        Object userSession = req.getSession().getAttribute(Constant.USER_SESSION);
        if (userSession != null) {
            req.getSession().removeAttribute(Constant.USER_SESSION);
            //è·³è½¬åˆ°ç™»å½•é¡µé¢
            resp.sendRedirect("/login.jsp");
        } else {
            //è·³è½¬åˆ°ç™»å½•é¡µé¢
            resp.sendRedirect("/login.jsp");
        }
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

å¸¸é‡ç±»Constant

```java
public class Constant {

    public static final String USER_SESSION = "USER_SESSION";
}
```

è¿‡æ»¤å™¨LoginFilter

```java
import com.zyy.utils.Constant;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: LoginFilter
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/02 17:27
 * @Version: 1.0
 */
public class LoginFilter implements Filter {
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse rep = (HttpServletResponse) response;
        Object userSession = req.getSession().getAttribute(Constant.USER_SESSION);
        if (userSession == null) {
            //è·³è½¬é”™è¯¯é¡µé¢
            rep.sendRedirect("/error.jsp");
        }
        chain.doFilter(request, response);

    }

    public void destroy() {

    }
}
```

æ¥å£é…ç½®web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1"
         metadata-complete="true">
    <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.zyy.servlets.HelloServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/servlet/hello</url-pattern>
    </servlet-mapping>

    <servlet-mapping>
        <servlet-name>login</servlet-name>
        <url-pattern>/servlet/login</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>login</servlet-name>
        <servlet-class>com.zyy.servlets.LoginServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>logout</servlet-name>
        <url-pattern>/servlet/logout</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>logout</servlet-name>
        <servlet-class>com.zyy.servlets.LogoutServlet</servlet-class>
    </servlet>

    <filter>
        <filter-name>characterEncodingFilter</filter-name>
        <filter-class>com.zyy.filters.CharacterEncodingFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>characterEncodingFilter</filter-name>
        <url-pattern>/servlet/*</url-pattern>
    </filter-mapping>


    <filter>
        <filter-name>loginFilter</filter-name>
        <filter-class>com.zyy.filters.LoginFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>loginFilter</filter-name>
        <url-pattern>/sys/*</url-pattern>
    </filter-mapping>

    <!--    æ³¨å†Œç›‘å¬å™¨-->
    <listener>
        <listener-class>com.zyy.listeners.OnLineCountListener</listener-class>
    </listener>

    <session-config>
        <session-timeout>10</session-timeout>
    </session-config>


</web-app>
```



# 28.jdbcå¤ä¹ 

ä»€ä¹ˆæ˜¯jdbcï¼šjavaè¿æ¥æ•°æ®åº“ï¼

![image-20211214162231438](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211214162231438.png)

éœ€è¦jaråŒ…çš„æ”¯æŒï¼š

- java.sql
- javax.sql
- mysql-connection-java...ï¼ˆè¿æ¥é©±åŠ¨ï¼‰



**å®éªŒç¯å¢ƒæ­å»º**

```sql
DROP TABLE `users`;


CREATE TABLE `users`(
  `id` INT PRIMARY KEY,
  `name` VARCHAR(50) NOT NULL,
  `password` VARCHAR(40) NOT NULL,
  `email` VARCHAR(60) NOT NULL,
  `birthday` DATE
) ENGINE=INNODB DEFAULT CHARSET=utf8

INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('1','å¼ ä¸‰','123456','zs@sina.com','2021-07-14');
INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('2','æå››','123456','lisi@sina.com','1981-12-04');
INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('3','ç‹äº”','123456','wangwu@sina.com','1982-12-04');
INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('4','èµµå…­','123456','zhaoliu@sina.com','1987-12-05');
INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('5','é’±ä¸ƒ','123456','qianqi@sina.com','2021-07-19');
INSERT INTO `users` (`id`, `name`, `password`, `email`, `birthday`) VALUES('6','åˆ˜å…«','123456','liuba@sina.com','2021-07-19');
```

å¯¼å…¥æ•°æ®åº“ä¾èµ–pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.zyy</groupId>
    <artifactId>javaweb-jdbc</artifactId>
    <version>1.0-SNAPSHOT</version>

    <dependencies>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.49</version>
        </dependency>
    </dependencies>


</project>
```

ideaè¿æ¥æ•°æ®åº“

![image-20211214222433294](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211214222433294.png)



jdbcå›ºå®šæ­¥éª¤ï¼š

1. åŠ è½½é©±åŠ¨
2. è¿æ¥æ•°æ®åº“
3. åˆ›å»ºStatement
4. ç¼–å†™sql
5. æ‰§è¡Œsql
6. å…³é—­è¿æ¥

```sql
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

/**
 * @ClassName: TestJdbc
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/14 17:16
 * @Version: 1.0
 */
public class TestJdbc {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/jdbcstudy?useUnicode=true&characterEncoding=utf-8";
        String user = "root";
        String pwd = "123456";
        try {

            //1. åŠ è½½é©±åŠ¨
            Class.forName("com.mysql.jdbc.Driver");
            //2. è¿æ¥æ•°æ®åº“
            Connection con = DriverManager.getConnection(url, user, pwd);
            //3. å‘æ•°æ®åº“å‘é€sqlçš„å¯¹è±¡Statement
            Statement statement = con.createStatement();

            //4.sql
            String str = "select * from users";

            //5.æ‰§è¡Œsql
            ResultSet rs = statement.executeQuery(str);
            while (rs.next()) {
                System.out.println("id=" + rs.getInt("id"));
                System.out.println("name=" + rs.getString("name"));
                System.out.println("password=" + rs.getString("password"));
                System.out.println("email=" + rs.getString("email"));
                System.out.println("birthday=" + rs.getString("birthday"));
            }
            //6.å…³é—­
            rs.close();
            statement.close();
            con.close();

        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```



é¢„ç¼–è¯‘

```java
public class Test2Jdbc {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/jdbcstudy?useUnicode=true&characterEncoding=utf-8";
        String user = "root";
        String pwd = "123456";
        try {

            //1. åŠ è½½é©±åŠ¨
            Class.forName("com.mysql.jdbc.Driver");
            //2. è¿æ¥æ•°æ®åº“
            Connection con = DriverManager.getConnection(url, user, pwd);

            //3.sql
            String str = "insert into users(id, name, password, email, birthday) values (?,?,?,?,?)";
            //4. é¢„ç¼–è¯‘
            PreparedStatement statement = con.prepareStatement(str);
            statement.setInt(1,8);
            statement.setString(2,"å°çº¢");
            statement.setString(3,"123456");
            statement.setString(4,"xiaohong@sina.com");
            statement.setDate(5,new java.sql.Date(System.currentTimeMillis()));


            //5.æ‰§è¡Œsql
            int count = statement.executeUpdate();

            if (count > 0) {
                System.out.println("æ’å…¥æˆåŠŸï¼");
            }
            statement.close();
            con.close();

        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```



# 29.jdbcäº‹åŠ¡

è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥

ACIDåŸåˆ™ï¼šä¿è¯æ•°æ®çš„å®‰å…¨

```
å¼€å¯äº‹åŠ¡
äº‹åŠ¡æäº¤  commit()
äº‹åŠ¡å›æ»š  rollback()
å…³é—­äº‹åŠ¡

è½¬è´¦ï¼š
A:1000
B:1000

A(900)   ---100-->    B(1100)
```

**Junitå•å…ƒæµ‹è¯•**

ä¾èµ–

```xml
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13</version>
        </dependency>
```

ç®€å•å®ç”¨

@Testæ³¨è§£åªæœ‰åœ¨æ–¹æ³•ä¸Šæœ‰æ•ˆï¼Œåªè¦åŠ äº†è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œï¼

```java
import org.junit.Test;

/**
 * @ClassName: Test3Jdbc
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/16 21:11
 * @Version: 1.0
 */
public class Test3Jdbc {

    @Test
    public void test() {
        System.out.println("hello");
    }
}
```

![image-20211216211935607](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211216211935607.png)å¤±è´¥æƒ…å†µ

![image-20211216212029230](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211216212029230.png)



æ–°å»ºè¡¨å¹¶æ’å…¥æ•°æ®

```sql
CREATE TABLE `account`(
  `id` INT PRIMARY KEY,
  `name` VARCHAR(50) NOT NULL,
  `money` FLOAT NOT NULL
) ENGINE=INNODB DEFAULT CHARSET=utf8

INSERT INTO `account` (`id`, `name`, `money`) VALUES(1,'A',1000);
INSERT INTO `account` (`id`, `name`, `money`) VALUES(2,'B',1000);
INSERT INTO `account` (`id`, `name`, `money`) VALUES(3,'C',1000);

```



```sql
# å¼€å¯äº‹åŠ¡
start transaction ;

# æ¨¡æ‹Ÿè½¬è´¦

update account set money=money-100 where name='A';

update account set money=money+100 where name='B';

# å›æ»š
rollback ;

# æäº¤
commit;
```



```java
import org.junit.Test;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

/**
 * @ClassName: Test3Jdbc
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/16 21:11
 * @Version: 1.0
 */
public class Test3Jdbc {

    @Test
    public void test() {

        String url = "jdbc:mysql://localhost:3306/jdbcstudy?useUnicode=true&characterEncoding=utf-8";
        String user = "root";
        String pwd = "123456";
        Connection con = null;
        try {

            Class.forName("com.mysql.jdbc.Driver");
            con = DriverManager.getConnection(url, user, pwd);


            //å¼€å¯äº‹åŠ¡ è¿™é‡Œä¸å¼€å¯äº‹åŠ¡çš„è¯å¼‚å¸¸æƒ…å†µå°±ä¼šæœ‰é—®é¢˜   falseæ˜¯å¼€å¯
            con.setAutoCommit(false);

            con.prepareStatement("update account set money=money-100 where name='A'").executeUpdate();

            //åˆ¶é€ é”™è¯¯
//            int i = 1 / 0;

            con.prepareStatement("update account set money=money+100 where name='B'").executeUpdate();

            con.commit();

            System.out.println("success");

        } catch (Exception e) {
            System.out.println("error rollback");
            if (con != null) {
                try {
                    con.rollback();
                } catch (SQLException ex) {
                    ex.printStackTrace();
                }
            }


        } finally {
            if (con != null) {
                try {
                    con.close();
                } catch (SQLException e) {
                    e.printStackTrace();
                }
            }
        }

    }
}
```





# 30.smbmsé¡¹ç›®æ­å»º

è¶…å¸‚è®¢å•ç®¡ç†ç³»ç»Ÿ

![image-20211216220629927](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211216220629927.png)

æ•°æ®åº“

```sql
DROP TABLE IF EXISTS `smbms_address`;
CREATE TABLE `smbms_address`  (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `contact` VARCHAR(15) NULL DEFAULT NULL COMMENT 'è”ç³»äººå§“å',
  `addressDesc` VARCHAR(50) NULL DEFAULT NULL COMMENT 'æ”¶è´§åœ°å€æ˜ç»†',
  `postCode` VARCHAR(15) NULL DEFAULT NULL COMMENT 'é‚®ç¼–',
  `tel` VARCHAR(20) NULL DEFAULT NULL COMMENT 'è”ç³»äººç”µè¯',
  `createdBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `creationDate` DATETIME NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `modifyBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'ä¿®æ”¹è€…',
  `modifyDate` DATETIME NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `userId` BIGINT(20) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `smbms_address` VALUES (1, 'ç‹ä¸½', 'åŒ—äº¬å¸‚ä¸œåŸåŒºä¸œäº¤æ°‘å··44å·', '100010', '13678789999', 1, '2016-04-13 00:00:00', NULL, NULL, 1);
INSERT INTO `smbms_address` VALUES (2, 'å¼ çº¢ä¸½', 'åŒ—äº¬å¸‚æµ·æ·€åŒºä¸¹æ£±è¡—3å·', '100000', '18567672312', 1, '2016-04-13 00:00:00', NULL, NULL, 1);
INSERT INTO `smbms_address` VALUES (3, 'ä»»å¿—å¼º', 'åŒ—äº¬å¸‚ä¸œåŸåŒºç¾æœ¯é¦†åè¡—23å·', '100021', '13387906742', 1, '2016-04-13 00:00:00', NULL, NULL, 1);
INSERT INTO `smbms_address` VALUES (4, 'æ›¹é¢–', 'åŒ—äº¬å¸‚æœé˜³åŒºæœé˜³é—¨å—å¤§è¡—14å·', '100053', '13568902323', 1, '2016-04-13 00:00:00', NULL, NULL, 2);
INSERT INTO `smbms_address` VALUES (5, 'ææ…§', 'åŒ—äº¬å¸‚è¥¿åŸåŒºä¸‰é‡Œæ²³è·¯å—ä¸‰å··3å·', '100032', '18032356666', 1, '2016-04-13 00:00:00', NULL, NULL, 3);
INSERT INTO `smbms_address` VALUES (6, 'ç‹å›½å¼º', 'åŒ—äº¬å¸‚é¡ºä¹‰åŒºé«˜ä¸½è¥é•‡é‡‘é©¬å·¥ä¸šåŒº18å·', '100061', '13787882222', 1, '2016-04-13 00:00:00', NULL, NULL, 3);

DROP TABLE IF EXISTS `smbms_bill`;
CREATE TABLE `smbms_bill`  (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `billCode` VARCHAR(20) NULL DEFAULT NULL COMMENT 'è´¦å•ç¼–ç ',
  `productName` VARCHAR(20) NULL DEFAULT NULL COMMENT 'å•†å“åç§°',
  `productDesc` VARCHAR(50) NULL DEFAULT NULL COMMENT 'å•†å“æè¿°',
  `productUnit` VARCHAR(10) NULL DEFAULT NULL COMMENT 'å•†å“å•ä½',
  `productCount` DECIMAL(20, 2) NULL DEFAULT NULL COMMENT 'å•†å“æ•°é‡',
  `totalPrice` DECIMAL(20, 2) NULL DEFAULT NULL COMMENT 'å•†å“æ€»é¢',
  `isPayment` INT(10) NULL DEFAULT NULL COMMENT 'æ˜¯å¦æ”¯ä»˜ï¼ˆ1ï¼šæœªæ”¯ä»˜ 2ï¼šå·²æ”¯ä»˜ï¼‰',
  `createdBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…ï¼ˆuserIdï¼‰',
  `creationDate` DATETIME NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `modifyBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'æ›´æ–°è€…ï¼ˆuserIdï¼‰',
  `modifyDate` DATETIME NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `providerId` BIGINT(20) NULL DEFAULT NULL COMMENT 'ä¾›åº”å•†ID',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `smbms_bill` VALUES (2, 'BILL2016_002', 'é¦™çš‚ã€è‚¥çš‚ã€è¯çš‚', 'æ—¥ç”¨å“-çš‚ç±»', 'å—', 1000.00, 10000.00, 2, 1, '2016-03-23 04:20:40', NULL, NULL, 13);
INSERT INTO `smbms_bill` VALUES (3, 'BILL2016_003', 'å¤§è±†æ²¹', 'é£Ÿå“-é£Ÿç”¨æ²¹', 'æ–¤', 300.00, 5890.00, 2, 1, '2014-12-14 13:02:03', NULL, NULL, 6);
INSERT INTO `smbms_bill` VALUES (4, 'BILL2016_004', 'æ©„æ¦„æ²¹', 'é£Ÿå“-è¿›å£é£Ÿç”¨æ²¹', 'æ–¤', 200.00, 9800.00, 2, 1, '2013-10-10 03:12:13', NULL, NULL, 7);
INSERT INTO `smbms_bill` VALUES (5, 'BILL2016_005', 'æ´—æ´ç²¾', 'æ—¥ç”¨å“-å¨æˆ¿æ¸…æ´', 'ç“¶', 500.00, 7000.00, 2, 1, '2014-12-14 13:02:03', NULL, NULL, 9);
INSERT INTO `smbms_bill` VALUES (6, 'BILL2016_006', 'ç¾å›½å¤§æä»', 'é£Ÿå“-åšæœ', 'è¢‹', 300.00, 5000.00, 2, 1, '2016-04-14 06:08:09', NULL, NULL, 4);
INSERT INTO `smbms_bill` VALUES (7, 'BILL2016_007', 'æ²æµ´æ¶²ã€ç²¾æ²¹', 'æ—¥ç”¨å“-æ²æµ´ç±»', 'ç“¶', 500.00, 23000.00, 1, 1, '2016-07-22 10:10:22', NULL, NULL, 14);
INSERT INTO `smbms_bill` VALUES (8, 'BILL2016_008', 'ä¸é”ˆé’¢ç›˜ç¢—', 'æ—¥ç”¨å“-å¨æˆ¿ç”¨å…·', 'ä¸ª', 600.00, 6000.00, 2, 1, '2016-04-14 05:12:13', NULL, NULL, 14);
INSERT INTO `smbms_bill` VALUES (9, 'BILL2016_009', 'å¡‘æ–™æ¯', 'æ—¥ç”¨å“-æ¯å­', 'ä¸ª', 350.00, 1750.00, 2, 1, '2016-02-04 11:40:20', NULL, NULL, 14);
INSERT INTO `smbms_bill` VALUES (10, 'BILL2016_010', 'è±†ç“£é…±', 'é£Ÿå“-è°ƒæ–™', 'ç“¶', 200.00, 2000.00, 2, 1, '2013-10-29 05:07:03', NULL, NULL, 8);
INSERT INTO `smbms_bill` VALUES (11, 'BILL2016_011', 'æµ·ä¹‹è“', 'é¥®æ–™-å›½é…’', 'ç“¶', 50.00, 10000.00, 1, 1, '2016-04-14 16:16:00', NULL, NULL, 1);
INSERT INTO `smbms_bill` VALUES (12, 'BILL2016_012', 'èŠåå£«', 'é¥®æ–™-æ´‹é…’', 'ç“¶', 20.00, 6000.00, 1, 1, '2016-09-09 17:00:00', NULL, NULL, 1);
INSERT INTO `smbms_bill` VALUES (13, 'BILL2016_013', 'é•¿åŸçº¢è‘¡è„é…’', 'é¥®æ–™-çº¢é…’', 'ç“¶', 60.00, 800.00, 2, 1, '2016-11-14 15:23:00', NULL, NULL, 1);
INSERT INTO `smbms_bill` VALUES (14, 'BILL2016_014', 'æ³°å›½é¦™ç±³', 'é£Ÿå“-å¤§ç±³', 'æ–¤', 400.00, 5000.00, 2, 1, '2016-10-09 15:20:00', NULL, NULL, 3);
INSERT INTO `smbms_bill` VALUES (15, 'BILL2016_015', 'ä¸œåŒ—å¤§ç±³', 'é£Ÿå“-å¤§ç±³', 'æ–¤', 600.00, 4000.00, 2, 1, '2016-11-14 14:00:00', NULL, NULL, 3);
INSERT INTO `smbms_bill` VALUES (16, 'BILL2016_016', 'å¯å£å¯ä¹', 'é¥®æ–™', 'ç“¶', 2000.00, 6000.00, 2, 1, '2012-03-27 13:03:01', NULL, NULL, 2);
INSERT INTO `smbms_bill` VALUES (17, 'BILL2016_017', 'è„‰åŠ¨', 'é¥®æ–™', 'ç“¶', 1500.00, 4500.00, 2, 1, '2016-05-10 12:00:00', NULL, NULL, 2);
INSERT INTO `smbms_bill` VALUES (18, 'BILL2016_018', 'å“‡å“ˆå“ˆ', 'é¥®æ–™', 'ç“¶', 2000.00, 4000.00, 2, 1, '2015-11-24 15:12:03', NULL, NULL, 2);

DROP TABLE IF EXISTS `smbms_provider`;
CREATE TABLE `smbms_provider`  (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `proCode` VARCHAR(20) NULL DEFAULT NULL COMMENT 'ä¾›åº”å•†ç¼–ç ',
  `proName` VARCHAR(20) NULL DEFAULT NULL COMMENT 'ä¾›åº”å•†åç§°',
  `proDesc` VARCHAR(50) NULL DEFAULT NULL COMMENT 'ä¾›åº”å•†è¯¦ç»†æè¿°',
  `proContact` VARCHAR(20) NULL DEFAULT NULL COMMENT 'ä¾›åº”å•†è”ç³»äºº',
  `proPhone` VARCHAR(20) NULL DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
  `proAddress` VARCHAR(50) NULL DEFAULT NULL COMMENT 'åœ°å€',
  `proFax` VARCHAR(20) NULL DEFAULT NULL COMMENT 'ä¼ çœŸ',
  `createdBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…ï¼ˆuserIdï¼‰',
  `creationDate` DATETIME NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `modifyDate` DATETIME NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `modifyBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'æ›´æ–°è€…ï¼ˆuserIdï¼‰',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `smbms_provider` VALUES (1, 'BJ_GYS001', 'åŒ—äº¬ä¸‰æœ¨å ‚å•†è´¸æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“:èŒ…å°ã€äº”ç²®æ¶²ã€éƒé…’ã€é…’é¬¼é…’ã€æ³¸å·è€çª–ã€èµ–èŒ…é…’ã€æ³•å›½çº¢é…’ç­‰', 'å¼ å›½å¼º', '13566667777', 'åŒ—äº¬å¸‚ä¸°å°åŒºè‚²èŠ³å›­åŒ—è·¯', '010-58858787', 1, '2013-03-21 16:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (2, 'HB_GYS001', 'çŸ³å®¶åº„å¸…ç›Šé£Ÿå“è´¸æ˜“æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“:é¥®æ–™ã€æ°´é¥®æ–™ã€æ¤ç‰©è›‹ç™½é¥®æ–™ã€ä¼‘é—²é£Ÿå“ã€æœæ±é¥®æ–™ã€åŠŸèƒ½é¥®æ–™ç­‰', 'ç‹å†›', '13309094212', 'æ²³åŒ—çœçŸ³å®¶åº„æ–°ååŒº', '0311-67738876', 1, '2016-04-13 04:20:40', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (3, 'GZ_GYS001', 'æ·±åœ³å¸‚æ³°é¦™ç±³ä¸šæœ‰é™å…¬å¸', 'åˆæ¬¡åˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šè‰¯è®°é‡‘è½®ç±³,é¾™è½®é¦™ç±³ç­‰', 'éƒ‘ç¨‹ç€š', '13402013312', 'å¹¿ä¸œçœæ·±åœ³å¸‚ç¦ç”°åŒºæ·±å—å¤§é“6006åä¸°å¤§å¦', '0755-67776212', 1, '2014-03-21 16:56:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (4, 'GZ_GYS002', 'æ·±åœ³å¸‚å–œæ¥å®¢å•†è´¸æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šåšæœç‚’è´§.æœè„¯èœœé¥¯.å¤©ç„¶èŠ±èŒ¶.è¥å…»è±†è±†.ç‰¹è‰²ç¾é£Ÿ.è¿›å£é£Ÿå“.æµ·å‘³é›¶é£Ÿ.è‚‰è„¯è‚‰', 'æ—å¦®', '18599897645', 'å¹¿ä¸œçœæ·±åœ³å¸‚ç¦é¾™å·¥ä¸šåŒºB2æ ‹3æ¥¼è¥¿', '0755-67772341', 1, '2013-03-22 16:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (5, 'JS_GYS001', 'å…´åŒ–ä½³ç¾è°ƒå‘³å“å‚', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šå¤©ç„¶é¦™è¾›æ–™ã€é¸¡ç²¾ã€å¤åˆè°ƒå‘³æ–™', 'å¾å›½æ´‹', '13754444221', 'æ±Ÿè‹çœå…´åŒ–å¸‚æ—æ¹–å·¥ä¸šåŒº', '0523-21299098', 1, '2015-11-22 16:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (6, 'BJ_GYS002', 'åŒ—äº¬çº³ç¦å°”é£Ÿç”¨æ²¹æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šå±±èŒ¶æ²¹ã€å¤§è±†æ²¹ã€èŠ±ç”Ÿæ²¹ã€æ©„æ¦„æ²¹ç­‰', 'é©¬èº', '13422235678', 'åŒ—äº¬å¸‚æœé˜³åŒºç æ±Ÿå¸æ™¯1å·æ¥¼', '010-588634233', 1, '2012-03-21 17:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (7, 'BJ_GYS003', 'åŒ—äº¬å›½ç²®é£Ÿç”¨æ²¹æœ‰é™å…¬å¸', 'åˆæ¬¡åˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šèŠ±ç”Ÿæ²¹ã€å¤§è±†æ²¹ã€å°ç£¨æ²¹ç­‰', 'ç‹é©°', '13344441135', 'åŒ—äº¬å¤§å…´é’äº‘åº—å¼€å‘åŒº', '010-588134111', 1, '2016-04-13 00:00:00', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (8, 'ZJ_GYS001', 'æ…ˆæºªå¸‚å¹¿å’Œç»¿è‰²é£Ÿå“å‚', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šè±†ç“£é…±ã€é»„è±†é…±ã€ç”œé¢é…±ï¼Œè¾£æ¤’ï¼Œå¤§è’œç­‰å†œäº§å“', 'è–›åœ£ä¸¹', '18099953223', 'æµ™æ±Ÿçœå®æ³¢å¸‚æ…ˆæºªå‘¨å··å°å®‰æ‘', '0574-34449090', 1, '2013-11-21 06:02:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (9, 'GX_GYS001', 'ä¼˜ç™¾å•†è´¸æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šæ—¥åŒ–äº§å“', 'æç«‹å›½', '13323566543', 'å¹¿è¥¿å—å®å¸‚ç§€å¢å¤§é“42-1å·', '0771-98861134', 1, '2013-03-21 19:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (10, 'JS_GYS002', 'å—äº¬ç«å¤´å†›ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šä¸é”ˆé’¢å¨å…·ç­‰', 'é™ˆå¥³å£«', '13098992113', 'æ±Ÿè‹çœå—äº¬å¸‚æµ¦å£åŒºæµ¦å£å¤§é“1å·æ–°åŸæ€»éƒ¨å¤§å¦Aåº§903å®¤', '025-86223345', 1, '2013-03-25 16:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (11, 'GZ_GYS003', 'å¹¿å·å¸‚ç™½äº‘åŒºç¾æ˜Ÿäº”é‡‘åˆ¶å“å‚', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šæµ·ç»µåºŠå«ã€åå«ã€é å«ã€æµ·ç»µæ•å¤´ã€å¤´æ•ç­‰', 'æ¢å¤©', '13562276775', 'å¹¿å·å¸‚ç™½äº‘åŒºé’Ÿè½æ½­é•‡ç¦é¾™è·¯20å·', '020-85542231', 1, '2016-12-21 06:12:17', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (12, 'BJ_GYS004', 'åŒ—äº¬éš†ç››æ—¥åŒ–ç§‘æŠ€', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šæ—¥åŒ–ç¯ä¿æ¸…æ´—å‰‚ï¼Œå®¶å±…æ´—æ¶¤ä¸“å–ã€æ´—æ¶¤ç”¨å“ç½‘ã€å¢™ä½“é™¤éœ‰å‰‚ã€å¢™é¢éœ‰èŒæ¸…é™¤å‰‚ç­‰', 'å­™æ¬£', '13689865678', 'åŒ—äº¬å¸‚å¤§å…´åŒºæ—§å®«', '010-35576786', 1, '2014-11-21 12:51:11', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (13, 'SD_GYS001', 'å±±ä¸œè±ªå…‹åå…‰è”åˆå‘å±•æœ‰é™å…¬å¸', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šæ´—è¡£çš‚ã€æ´—è¡£ç²‰ã€æ´—è¡£æ¶²ã€æ´—æ´ç²¾ã€æ¶ˆæ€ç±»ã€é¦™çš‚ç­‰', 'å´æ´ªè½¬', '13245468787', 'å±±ä¸œæµé˜³æµåŒ—å·¥ä¸šåŒºä»å’Œè¡—21å·', '0531-53362445', 1, '2015-01-28 10:52:07', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (14, 'JS_GYS003', 'æ— é”¡å–œæºå¤å•†è¡Œ', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šæ—¥åŒ–å“æ‰¹é”€', 'å‘¨ä¸€æ¸…', '18567674532', 'æ±Ÿè‹æ— é”¡ç››å²¸è¥¿è·¯', '0510-32274422', 1, '2016-04-23 11:11:11', NULL, NULL);
INSERT INTO `smbms_provider` VALUES (15, 'ZJ_GYS002', 'ä¹æ‘†æ—¥ç”¨å“å‚', 'é•¿æœŸåˆä½œä¼™ä¼´ï¼Œä¸»è¥äº§å“ï¼šå„ç§ä¸­ã€é«˜æ¡£å¡‘æ–™æ¯ï¼Œå¡‘æ–™ä¹æ‰£æ°´æ¯ï¼ˆå¯†å°æ¯ï¼‰ã€ä¿é²œæ¯ï¼ˆä¿é²œç›’ï¼‰ã€å¹¿å‘Šæ¯ã€ç¤¼å“æ¯', 'ç‹ä¸–æ°', '13212331567', 'æµ™æ±Ÿçœé‡‘åå¸‚ä¹‰ä¹Œå¸‚ä¹‰ä¸œè·¯', '0579-34452321', 1, '2016-08-22 10:01:30', NULL, NULL);


DROP TABLE IF EXISTS `smbms_role`;
CREATE TABLE `smbms_role`  (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `roleCode` VARCHAR(15) NULL DEFAULT NULL COMMENT 'è§’è‰²ç¼–ç ',
  `roleName` VARCHAR(15) NULL DEFAULT NULL COMMENT 'è§’è‰²åç§°',
  `createdBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `creationDate` DATETIME NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `modifyBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'ä¿®æ”¹è€…',
  `modifyDate` DATETIME NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=INNODB DEFAULT CHARSET=utf8;


INSERT INTO `smbms_role` VALUES (1, 'SMBMS_ADMIN', 'ç³»ç»Ÿç®¡ç†å‘˜', 1, '2016-04-13 00:00:00', NULL, NULL);
INSERT INTO `smbms_role` VALUES (2, 'SMBMS_MANAGER', 'ç»ç†', 1, '2016-04-13 00:00:00', NULL, NULL);
INSERT INTO `smbms_role` VALUES (3, 'SMBMS_EMPLOYEE', 'æ™®é€šå‘˜å·¥', 1, '2016-04-13 00:00:00', NULL, NULL);


DROP TABLE IF EXISTS `smbms_user`;
CREATE TABLE `smbms_user`  (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `userCode` VARCHAR(15) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·ç¼–ç ',
  `userName` VARCHAR(15) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·åç§°',
  `userPassword` VARCHAR(15) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·å¯†ç ',
  `gender` INT(10) NULL DEFAULT NULL COMMENT 'æ€§åˆ«ï¼ˆ1:å¥³ã€ 2:ç”·ï¼‰',
  `birthday` DATE NULL DEFAULT NULL COMMENT 'å‡ºç”Ÿæ—¥æœŸ',
  `phone` VARCHAR(15) NULL DEFAULT NULL COMMENT 'æ‰‹æœº',
  `address` VARCHAR(30) NULL DEFAULT NULL COMMENT 'åœ°å€',
  `userRole` BIGINT(20) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·è§’è‰²ï¼ˆå–è‡ªè§’è‰²è¡¨-è§’è‰²idï¼‰',
  `createdBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…ï¼ˆuserIdï¼‰',
  `creationDate` DATETIME NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `modifyBy` BIGINT(20) NULL DEFAULT NULL COMMENT 'æ›´æ–°è€…ï¼ˆuserIdï¼‰',
  `modifyDate` DATETIME NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `smbms_user` VALUES (1, 'admin', '111', '111111', 1, '2021-04-22', '13688889999', 'åŒ—äº¬å¸‚æµ·æ·€åŒºæˆåºœè·¯207å·', 3, 1, '2013-03-21 16:52:07', 1, '2021-04-22 17:43:02');
INSERT INTO `smbms_user` VALUES (2, 'liming', 'ææ˜', '0000000', 2, '1983-12-10', '13688884457', 'åŒ—äº¬å¸‚ä¸œåŸåŒºå‰é—¨ä¸œå¤§è¡—9å·', 2, 1, '2014-12-31 19:52:09', NULL, NULL);
INSERT INTO `smbms_user` VALUES (5, 'hanlubiao', 'éŸ©è·¯å½ª', '0000000', 2, '1984-06-05', '18567542321', 'åŒ—äº¬å¸‚æœé˜³åŒºåŒ—è¾°ä¸­å¿ƒ12å·', 2, 1, '2014-12-31 19:52:09', NULL, NULL);
INSERT INTO `smbms_user` VALUES (6, 'zhanghua', 'å¼ å', '0000000', 1, '1983-06-15', '13544561111', 'åŒ—äº¬å¸‚æµ·æ·€åŒºå­¦é™¢è·¯61å·', 3, 1, '2013-02-11 10:51:17', NULL, NULL);
INSERT INTO `smbms_user` VALUES (7, 'wangyang', 'ç‹æ´‹', '0000000', 2, '1982-12-31', '13444561124', 'åŒ—äº¬å¸‚æµ·æ·€åŒºè¥¿äºŒæ——è¾‰ç…Œå›½é™…16å±‚', 3, 1, '2014-06-11 19:09:07', NULL, NULL);
INSERT INTO `smbms_user` VALUES (8, 'zhaoyan', 'èµµç‡•', '0000000', 2, '2021-04-22', '18098764545', 'åŒ—äº¬å¸‚æµ·æ·€åŒºå›é¾™è§‚å°åŒº10å·æ¥¼', 2, 1, '2016-04-21 13:54:07', 1, '2021-04-22 17:56:11');
INSERT INTO `smbms_user` VALUES (10, 'sunlei', 'å­™ç£Š', '0000000', 2, '1981-01-04', '13387676765', 'åŒ—äº¬å¸‚æœé˜³åŒºç®¡åº„æ–°æœˆå°åŒº12æ¥¼', 3, 1, '2015-05-06 10:52:07', NULL, NULL);
INSERT INTO `smbms_user` VALUES (11, 'sunxing', 'å­™å…´', '0000000', 2, '1978-03-12', '13367890900', 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½é—¨å—å¤§è¡—10å·', 3, 1, '2016-11-09 16:51:17', NULL, NULL);
INSERT INTO `smbms_user` VALUES (12, 'zhangchen', 'å¼ æ™¨', '0000000', 1, '1986-03-28', '18098765434', 'æœé˜³åŒºç®¡åº„è·¯å£åŒ—æŸæ—çˆ±ä¹ä¸‰æœŸ13å·æ¥¼', 3, 1, '2016-08-09 05:52:37', 1, '2016-04-14 14:15:36');
INSERT INTO `smbms_user` VALUES (13, 'dengchao', 'é‚“è¶…', '0000000', 2, '1981-11-04', '13689674534', 'åŒ—äº¬å¸‚æµ·æ·€åŒºåŒ—èˆªå®¶å±é™¢10å·æ¥¼', 3, 1, '2016-07-11 08:02:47', NULL, NULL);
INSERT INTO `smbms_user` VALUES (15, 'zhaomin', 'èµµæ•', '0000000', 1, '1987-12-04', '18099897657', 'åŒ—äº¬å¸‚æ˜Œå¹³åŒºå¤©é€šè‹‘3åŒº12å·æ¥¼', 2, 1, '2015-09-12 12:02:12', NULL, NULL);
INSERT INTO `smbms_user` VALUES (18, '111', '111', '111111', 1, '2021-04-22', '15072151323', '111', 3, 1, '2021-04-22 18:13:07', NULL, NULL);


```

æ¶æ„è®¾è®¡å›¾

![image-20211220170838726](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211220170838726.png)

é¡¹ç›®å¦‚ä½•æ­å»º

è€ƒè™‘æ˜¯å¦ä½¿ç”¨maven?   ä¾èµ–,jar



## é¡¹ç›®æ­å»ºå‡†å¤‡å·¥ä½œ

1. æ­å»ºä¸€ä¸ªmaven webé¡¹ç›®

2. é…ç½®tomcat

3. æµ‹è¯•é¡¹ç›®æ˜¯å¦å¯ä»¥è·‘èµ·æ¥

4. å¯¼å…¥é¡¹ç›®ä¸­æ‰€éœ€jaråŒ…

5. åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„

6. ç¼–å†™å®ä½“ç±»

   ORMæ˜ å°„ï¼šè¡¨-ç±»æ˜ å°„

7. ç¼–å†™åŸºç¡€å…¬å…±ç±»

   1. æ•°æ®åº“é…ç½®æ–‡ä»¶
   2. ç¼–å†™æ•°æ®åº“çš„å…¬å…±ç±»
   3. ç¼–å†™å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨

8. å¯¼å…¥é™æ€èµ„æº

è¯¦ç»†çš„ç›¸å…³ä»£ç è§ï¼š[å¤§åšå¤§æ‘†/smsbs - ç äº‘ - å¼€æºä¸­å›½ (gitee.com)](https://gitee.com/zhayuyao/smsbs)

![image-20211223115004711](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211223115004711.png)

![image-20211223115048298](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211223115048298.png)

pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.zyy</groupId>
  <artifactId>smbms</artifactId>
  <version>1.0-SNAPSHOT</version>
  <packaging>war</packaging>

  <dependencies>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>servlet-api</artifactId>
      <version>2.5</version>
    </dependency>
    <dependency>
      <groupId>javax.servlet.jsp</groupId>
      <artifactId>javax.servlet.jsp-api</artifactId>
      <version>2.3.3</version>
    </dependency>
    <dependency>
      <groupId>mysql</groupId>
      <artifactId>mysql-connector-java</artifactId>
      <version>5.1.47</version>
    </dependency>
    <dependency>
      <groupId>javax.servlet.jsp.jstl</groupId>
      <artifactId>jstl-api</artifactId>
      <version>1.2</version>
    </dependency>
    <dependency>
      <groupId>taglibs</groupId>
      <artifactId>standard</artifactId>
      <version>1.1.2</version>
    </dependency>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
    </dependency>
  </dependencies>

</project>


```

![image-20211223115156796](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211223115156796.png)

```java
import java.util.Date;

/**
 * @ClassName: Address
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/22 17:35
 * @Version: 1.0
 */
public class Address {
    private Integer id;
    private String contact;
    private String addressDesc;
    private String postCode;
    private String tel;
    private Integer createdBy;
    private Integer modifyBy;
    private Date creationDate;
    private Date modifyDate;
    private Integer userId;
    //...çœç•¥get setæ–¹æ³•
}
```

```java
import java.util.Date;

/**
 * @ClassName: Bill
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/22 17:35
 * @Version: 1.0
 */
public class Bill {
    private Integer id;
    private String billCode;
    private String productName;
    private String productDesc;
    private String productUnit;
    private Double productCount;
    private Double totalPrice;
    private Integer isPayment;
    private Integer createdBy;
    private Integer modifyBy;
    private Date creationDate;
    private Date modifyDate;
    private Integer providerId;
    //...çœç•¥get setæ–¹æ³•
}
```

```java
import java.util.Date;

/**
 * @ClassName: Provider
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/22 17:35
 * @Version: 1.0
 */
public class Provider {
    private Integer id;
    private String proCode;
    private String proName;
    private String proDesc;
    private String proContact;
    private String proPhone;
    private String proAddress;
    private String proFax;
    private Integer createdBy;
    private Integer modifyBy;
    private Date creationDate;
    private Date modifyDate;
    //...çœç•¥get setæ–¹æ³•
}
```

```java

import java.util.Date;

/**
 * @ClassName: Role
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/22 17:35
 * @Version: 1.0
 */
public class Role {
    private Integer id;
    private String roleCode;
    private String roleName;
    private Integer createdBy;
    private Integer modifyBy;
    private Date creationDate;
    private Date modifyDate;
    //...çœç•¥get setæ–¹æ³•
}
```

```java
import java.util.Calendar;
import java.util.Date;

/**
 * @ClassName: User
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/22 17:34
 * @Version: 1.0
 */
public class User {
    private Integer id;
    private String userCode;
    private String userName;
    private String userPassword;
    private Integer gender;
    private Date birthday;
    private String phone;
    private String address;
    private Integer userRole;
    private Integer createdBy;
    private Integer modifyBy;
    private Date creationDate;
    private Date modifyDate;

    private Integer age;
    private String userRoleName;

    public Integer getAge() {
        Date date = new Date();
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(date);
        int nowYear = calendar.get(Calendar.YEAR);
        calendar.setTime(birthday);
        int birthYear = calendar.get(Calendar.YEAR);

        return nowYear - birthYear;
    }
    //...çœç•¥å…¶ä»–get setæ–¹æ³•

}
```

db.properties

æ³¨æ„è¿™é‡Œéœ€è¦æŒ‡å®šæ•°æ®åº“

```properties
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/smbms?useUnicode=true&characterEncoding=utf-8
username=root
password=123456
```

```java
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Properties;

/**
 * @ClassName: BaseDao
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/23 10:14
 * @Version: 1.0
 */
public class BaseDao {

    private static String driver;
    private static String url;
    private static String userName;
    private static String password;

    static {
        Properties properties = new Properties();

        InputStream is = BaseDao.class.getClassLoader().getResourceAsStream("db.properties");

        try {
            properties.load(is);

            driver = properties.getProperty("driver");
            url = properties.getProperty("url");
            userName = properties.getProperty("username");
            password = properties.getProperty("password");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static Connection getConnection() {
        Connection con = null;
        try {
            Class.forName(driver);
            con = DriverManager.getConnection(url, userName, password);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return con;
    }

    public static ResultSet execute(Connection con, PreparedStatement ps, ResultSet rs, String sql, Object[] params) throws SQLException {
        ps = con.prepareStatement(sql);
        for (int i = 0; i < params.length; i++) {
            //setObject å ä½ç¬¦ä¸‹æ ‡ä»1å¼€å§‹ï¼Œæˆ‘ä»¬æ•°ç»„æ˜¯ä»0å¼€å§‹
            ps.setObject(i + 1, params[i]);
        }
        rs = ps.executeQuery();
        return rs;
    }

    public static int execute(Connection con, PreparedStatement ps, String sql, Object[] params) throws SQLException {
        ps = con.prepareStatement(sql);
        for (int i = 0; i < params.length; i++) {
            //setObject å ä½ç¬¦ä¸‹æ ‡ä»1å¼€å§‹ï¼Œæˆ‘ä»¬æ•°ç»„æ˜¯ä»0å¼€å§‹
            ps.setObject(i + 1, params[i]);
        }
        return ps.executeUpdate();
    }

    public static boolean closeResource(Connection con, PreparedStatement ps, ResultSet rs) {
        boolean closeFlag = true;
        if (rs != null) {
            try {
                rs.close();
                rs = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        if (ps != null) {
            try {
                ps.close();
                ps = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        if (con != null) {
            try {
                con.close();
                con = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        return closeFlag;
    }

    public static boolean closeResource(Connection con) {
        boolean closeFlag = true;
        if (con != null) {
            try {
                con.close();
                con = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        return closeFlag;
    }

    public static boolean closeResource(PreparedStatement ps, ResultSet rs) {
        boolean closeFlag = true;
        if (rs != null) {
            try {
                rs.close();
                rs = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        if (ps != null) {
            try {
                ps.close();
                ps = null;
            } catch (SQLException e) {
                e.printStackTrace();
                closeFlag = false;
            }
        }
        return closeFlag;
    }

}
```

```java
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import java.io.IOException;

/**
 * @ClassName: CharacterEncodingFilter
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2021/12/23 11:36
 * @Version: 1.0
 */
public class CharacterEncodingFilter implements Filter {
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        request.setCharacterEncoding("utf-8");
        response.setCharacterEncoding("utf-8");
        chain.doFilter(request, response);
    }

    public void destroy() {

    }
}
```

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1"
         metadata-complete="true">

    <filter>
        <filter-name>characterEncoding</filter-name>
        <filter-class>com.zyy.filter.CharacterEncodingFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>characterEncoding</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>


</web-app>
```



# 31.smbmsç™»å½•æµç¨‹å®ç°

![image-20220109102130484](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220109102130484.png)

1. ç¼–å†™å‰ç«¯é¡µé¢login.jsp

2. è®¾ç½®é¡µé¢web.xml

   ```xml
       <welcome-file-list>
           <welcome-file>login.jsp</welcome-file>
       </welcome-file-list>
   ```

   

3. ç¼–å†™daoå±‚ç™»å½•ç”¨æˆ·çš„æ¥å£

   ```java
   import com.zyy.pojo.User;
   
   import java.sql.Connection;
   import java.sql.SQLException;
   
   /**
    * @ClassName: UserDao
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2022/01/09 10:38
    * @Version: 1.0
    */
   public interface UserDao {
       /**
        * æ ¹æ®ç”¨æˆ·ç¼–ç è·å–ç”¨æˆ·ä¿¡æ¯
        * @param con
        * @param userCode
        * @return
        */
       User getLoginUser(Connection con, String userCode) throws SQLException;
   }
   ```

   

4. ç¼–å†™daoæ¥å£çš„å®ç°ç±»

   ```java
   import com.zyy.dao.BaseDao;
   import com.zyy.dao.user.UserDao;
   import com.zyy.pojo.User;
   
   import java.sql.Connection;
   import java.sql.PreparedStatement;
   import java.sql.ResultSet;
   import java.sql.SQLException;
   
   /**
    * @ClassName: UserDaoImpl
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2022/01/09 10:51
    * @Version: 1.0
    */
   public class UserDaoImpl implements UserDao {
       public User getLoginUser(Connection con, String userCode) throws SQLException {
           PreparedStatement ps = null;
           ResultSet rs = null;
           User user = null;
           if (con != null) {
               String sql = "select id, userCode, userName, userPassword, gender, birthday, phone, address, userRole, createdBy, creationDate, modifyBy, modifyDate from smbms_user where userCode=?";
               Object[] params = {userCode};
               rs = BaseDao.execute(con, ps, rs, sql, params);
               if (rs.next()) {
                   user = new User();
                   user.setId(rs.getInt("id"));
                   user.setUserCode(rs.getString("userCode"));
                   user.setUserName(rs.getString("userName"));
                   user.setUserPassword(rs.getString("userPassword"));
                   user.setGender(rs.getInt("gender"));
                   user.setBirthday(rs.getDate("birthday"));
                   user.setPhone(rs.getString("phone"));
                   user.setAddress(rs.getString("address"));
                   user.setUserRole(rs.getInt("userRole"));
                   user.setCreatedBy(rs.getInt("createdBy"));
                   user.setModifyBy(rs.getInt("modifyBy"));
                   user.setCreationDate(rs.getTimestamp("creationDate"));
                   user.setModifyDate(rs.getTimestamp("modifyDate"));
               }
               //å…³é—­
               BaseDao.closeResource(ps, rs);
           }
           return user;
       }
   }
   ```

5. ä¸šåŠ¡å±‚æ¥å£

   ```java
   import com.zyy.pojo.User;
   
   /**
    * @InterfaceName: UserService
    * @Description: TODO æ¥å£æè¿°
    * @Author: zyy
    * @Date: 2022/01/09 11:18
    * @Version: 1.0
    */
   public interface UserService {
       /**
        * ç™»å½•
        * @param userCode
        * @param password
        * @return
        */
       User login(String userCode, String password);
   }
   ```

   

6. ä¸šåŠ¡å±‚å®ç°ç±»

   ```java
   import com.zyy.dao.BaseDao;
   import com.zyy.dao.user.UserDao;
   import com.zyy.dao.user.impl.UserDaoImpl;
   import com.zyy.pojo.User;
   import com.zyy.service.user.UserService;
   
   import java.sql.Connection;
   import java.sql.SQLException;
   
   /**
    * @ClassName: UserServiceImpl
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2022/01/09 11:20
    * @Version: 1.0
    */
   public class UserServiceImpl implements UserService {
       /**
        * ä¸šåŠ¡å±‚ä¼šè°ƒç”¨daoå±‚ï¼Œæ‰€ä»¥è¿™é‡Œå¼•å…¥Daoå±‚
        */
       private UserDao userDao;
   
       public UserServiceImpl() {
           userDao = new UserDaoImpl();
       }
   
       public User login(String userCode, String password) {
           Connection con = null;
           User user = null;
           try {
               con = BaseDao.getConnection();
               user = userDao.getLoginUser(con, userCode);
           } catch (SQLException e) {
               e.printStackTrace();
           } finally {
               BaseDao.closeResource(con);
           }
           return user;
       }
   
   }
   ```

   7. ç¼–å†™servlet

      ```java
      import com.zyy.pojo.User;
      import com.zyy.service.user.UserService;
      import com.zyy.service.user.impl.UserServiceImpl;
      import com.zyy.util.Constants;
      
      import javax.servlet.ServletException;
      import javax.servlet.http.HttpServlet;
      import javax.servlet.http.HttpServletRequest;
      import javax.servlet.http.HttpServletResponse;
      import java.io.IOException;
      
      /**
       * @ClassName: LoginServlet
       * @Description: TODO ç±»æè¿°
       * @Author: zyy
       * @Date: 2022/01/09 11:36
       * @Version: 1.0
       */
      public class LoginServlet extends HttpServlet {
          @Override
          protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
              System.out.println("LoginServlet---start----");
              //ç”¨æˆ·å‰ç«¯è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç 
              String userCode = req.getParameter("userCode");
              String userPassword = req.getParameter("userPassword");
              //è°ƒç”¨ä¸šåŠ¡å±‚
              UserService userService = new UserServiceImpl();
              User user = userService.login(userCode, userPassword);
              if (user != null) {
                  //æŸ¥æœ‰æ­¤äºº
                  //å°†ç”¨æˆ·çš„ä¿¡æ¯æ”¾åˆ°sessionä¸­
                  req.getSession().setAttribute(Constants.USER_SESSION, user);
                  //è·³è½¬åˆ°ä¸»é¡µ
                  resp.sendRedirect("jsp/frame.jsp");
              } else {
                  //æŸ¥æ— æ­¤äºº
                  //è½¬å‘å›ç™»å½•é¡µé¢ï¼Œå¹¶æç¤ºå®ƒç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯
                  req.setAttribute("error", "ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯");
                  req.getRequestDispatcher("login.jsp").forward(req, resp);
              }
      
      
          }
      
          @Override
          protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
              this.doGet(req, resp);
          }
      }
      ```

   8. æ³¨å†ŒServlet

      ```xml
          <servlet>
              <servlet-name>LoginServlet</servlet-name>
              <servlet-class>com.zyy.servlet.LoginServlet</servlet-class>
          </servlet>
          
          <servlet-mapping>
              <servlet-name>LoginServlet</servlet-name>
              <url-pattern>/login.do</url-pattern>
          </servlet-mapping>
      ```

   9. æµ‹è¯•è®¿é—®ï¼Œç¡®ä¿ä¸Šé¢åŠŸèƒ½æˆåŠŸï¼

      ![image-20220109123609348](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220109123609348.png)

      

![image-20220109145226990](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220109145226990.png)

# 32.smbmsæ³¨é”€åŠæƒé™è¿‡æ»¤

æ³¨é”€åŠŸèƒ½ï¼š

æ€è·¯ï¼šç§»é™¤sessionï¼Œè¿”å›ç™»å½•é¡µé¢

ç¼–å†™é€€å‡ºservlet

```java
import com.zyy.util.Constants;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: LogoutServlet
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2022/01/09 14:13
 * @Version: 1.0
 */
public class LogoutServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //ç§»é™¤session
        req.getSession().removeAttribute(Constants.USER_SESSION);
        //è·³è½¬ç™»å½•é¡µé¢
        resp.sendRedirect(req.getContextPath() + "/login.jsp");

    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        this.doGet(req, resp);
    }
}
```

æ³¨å†Œé€€å‡ºæ¥å£

```xml
    <servlet>
        <servlet-name>LogoutServlet</servlet-name>
        <servlet-class>com.zyy.servlet.LogoutServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>LogoutServlet</servlet-name>
        <url-pattern>/user/logout</url-pattern>
    </servlet-mapping>
```

ç™»å½•æ‹¦æˆªä¼˜åŒ–

ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨å¹¶æ³¨å†Œ

```java
import com.zyy.pojo.User;
import com.zyy.util.Constants;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName: SysFilter
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2022/01/09 14:28
 * @Version: 1.0
 */
public class SysFilter implements Filter {
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        User user = (User) req.getSession().getAttribute(Constants.USER_SESSION);
        if (user == null) {
            //å·²ç»è¢«ç§»é™¤æˆ–è€…æ³¨é”€äº†ï¼Œæˆ–è€…æ²¡æœ‰ç™»å½•
            resp.sendRedirect("/smbms/error.jsp");
            return;
        }
        chain.doFilter(req, resp);
    }

    public void destroy() {

    }
}
```

```xml
    <filter>
        <filter-name>SysFilter</filter-name>
        <filter-class>com.zyy.filter.SysFilter</filter-class>
    </filter>

    <filter-mapping>
        <filter-name>SysFilter</filter-name>
        <url-pattern>/jsp/*</url-pattern>
    </filter-mapping>
```

éªŒè¯åŠŸèƒ½ï¼

æ²¡æœ‰ç™»å½•ç›´æ¥è¯·æ±‚http://localhost:8080/smbms/jsp/frame.jsp

![image-20220109145707392](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220109145707392.png)





# 33.smbmså¯†ç ä¿®æ”¹å®ç°

1. å¯¼å…¥å‰ç«¯ç´ æpwdmodify.jsp

2. å†™é¡¹ç›®ï¼Œå»ºè®®ä»åº•å±‚å‘ä¸Šå†™

3. UserDaoæ¥å£

   ```java
       /**
        * ä¿®æ”¹å¯†ç 
        *
        * @param con
        * @param id
        * @param password
        * @return
        * @throws SQLException
        */
       int updatePwd(Connection con, int id, String password) throws SQLException;
   ```

4. UserDaoæ¥å£å®ç°

   ```java
       public int updatePwd(Connection con, int id, String password) throws SQLException {
           int updateCount = 0;
           if (con != null) {
               PreparedStatement ps = null;
               String str = "update smbms_user set userPassword = ? where id = ?";
               Object[] params = {password, id};
               updateCount = BaseDao.execute(con, ps, str, params);
               BaseDao.closeResource(ps, null);
          }
           return updateCount;
      }
   ```

5. UserServiceæ¥å£

   ```java
       /**
        * ä¿®æ”¹å¯†ç 
        *
        * @param id
        * @param password
        * @return
        */
       boolean updatePwd(int id, String password);
   ```

6. UserServiceæ¥å£å®ç°

   ```java
       public boolean updatePwd(int id, String password) {
           Connection con = null;
           boolean updateFlag = false;
           try {
               con = BaseDao.getConnection();
               int updateCount = userDao.updatePwd(con, id, password);
               if (updateCount > 0) {
                   updateFlag = true;
              }
          } catch (SQLException e) {
               e.printStackTrace();
          } finally {
               BaseDao.closeResource(con);
          }
           return updateFlag;
      }
   ```

7. ç¼–å†™servlet

   ```java
   import com.mysql.jdbc.StringUtils;
   import com.zyy.pojo.User;
   import com.zyy.service.user.UserService;
   import com.zyy.service.user.impl.UserServiceImpl;
   import com.zyy.util.Constants;
   
   import javax.servlet.ServletException;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;
   
   /**
    * @ClassName: UserServlet
    * @Description: Servletå¤ç”¨
    * @Author: zyy
    * @Date: 2022/01/15 15:39
    * @Version: 1.0
    */
   public class UserServlet extends HttpServlet {
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           String method = req.getParameter("method");
           if (method != null && "savepwd".equals(method)) {
               updatePwd(req, resp);
          }
   
      }
   
       protected void updatePwd(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           //ä»sessionè·å–ç”¨æˆ·id
           Object obj = req.getSession().getAttribute(Constants.USER_SESSION);
           //è·å–å…¥å‚ä¸­çš„æ–°å¯†ç 
           String newPassWord = req.getParameter("newpassword");
           if (obj == null || StringUtils.isNullOrEmpty(newPassWord)) {
               req.setAttribute("message", "æ–°å¯†ç ä¸å¯ä¸ºç©º~");
          } else {
               UserService userService = new UserServiceImpl();
               boolean flag = userService.updatePwd(((User) obj).getId(), newPassWord);
               if (flag) {
                   req.setAttribute("message", "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é€€å‡ºï¼Œä½¿ç”¨æ–°å¯†ç ç™»å½•~");
                   //ä¿®æ”¹æˆåŠŸï¼Œç§»é™¤session
                   req.getSession().removeAttribute(Constants.USER_SESSION);
              } else {
                   req.setAttribute("message", "å¯†ç ä¿®æ”¹å¤±è´¥~");
              }
          }
           req.getRequestDispatcher("pwdmodify.jsp").forward(req, resp);
      }
   
       @Override
       protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           this.doGet(req, resp);
      }
   }
   ```

8. æ³¨å†Œservlet

   ```xml
       <servlet>
           <servlet-name>UserServlet</servlet-name>
           <servlet-class>com.zyy.servlet.UserServlet</servlet-class>
       </servlet>
   
       <servlet-mapping>
           <servlet-name>UserServlet</servlet-name>
           <url-pattern>/jsp/user.do</url-pattern>
       </servlet-mapping>
   ```

9. éªŒè¯åŠŸèƒ½

# 34.ajaxéªŒè¯æ—§å¯†ç å®ç°

1. æ·»åŠ fastjsonåŒ…

   ```xml
       <dependency>
         <groupId>com.alibaba</groupId>
         <artifactId>fastjson</artifactId>
         <version>1.2.79</version>
       </dependency>
   ```

2. UserServletä¸­æ·»åŠ æ–¹æ³•

   ```java
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           String method = req.getParameter("method");
           if (method != null) {
               if ("savepwd".equals(method)) {
                   updatePwd(req, resp);
               } else if ("checkoldpwd".equals(method)) {
                   checkOldPwd(req, resp);
               }
           }
       }
   
   
   
       protected void checkOldPwd(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           //ä»sessionä¸­è·å–æ—§å¯†ç 
           Object obj = req.getSession().getAttribute(Constants.USER_SESSION);
           //è·å–å…¥å‚ä¸­çš„æ—§å¯†ç 
           String oldPassWord = req.getParameter("oldpassword");
           Map<String, Object> resultMap = new HashMap<String, Object>(16);
           if (obj == null) {
               //sessionè¿‡æœŸ
               resultMap.put("result", "sessionerror");
           } else if (StringUtils.isNullOrEmpty(oldPassWord)) {
               //æ—§å¯†ç è¾“å…¥ä¸ºç©º
               resultMap.put("result", "error");
           } else {
               if (oldPassWord.equals(((User) obj).getUserPassword())) {
                   //æ—§å¯†ç è¾“å…¥æ­£ç¡®
                   resultMap.put("result", "true");
               } else {
                   //æ—§å¯†ç è¾“å…¥æœ‰è¯¯
                   resultMap.put("result", "false");
               }
           }
   
           resp.setContentType("application/json");
           PrintWriter writer = resp.getWriter();
           writer.write(JSON.toJSONString(resultMap));
           writer.flush();
           writer.close();
       }
   ```

   

# 35.smbmsç”¨æˆ·ç®¡ç†åº•å±‚å®ç°

 ![image-20220116150528824](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220116150528824.png)

1. å¯¼å…¥åˆ†é¡µçš„å·¥å…·ç±»
2. ç”¨æˆ·åˆ—è¡¨ userlist.jsp å’Œåˆ†é¡µé¡µé¢userlist.jsp

## è·å–ç”¨æˆ·æ•°æ®é‡

1. UserDao

   ```java
   /**
        * æ ¹æ®ç”¨æˆ·åæˆ–è€…è§’è‰²æŸ¥è¯¢ç”¨æˆ·æ€»æ•°
        * @param con
        * @param userName
        * @param userRole
        * @return
        * @throws SQLException
        */
       int getUserCount(Connection con, String userName, int userRole) throws SQLException;
   ```

2. UserDaoImpl

   ```java
   
       public int getUserCount(Connection con, String userName, int userRole) throws SQLException {
           PreparedStatement ps = null;
           ResultSet rs = null;
           int count = 0;
           if (con != null) {
               StringBuffer sql = new StringBuffer("select count(1) as 'count' from smbms_user u,smbms_role r where u.userRole=r.id");
               List<Object> list = new ArrayList<Object>();
               if (!StringUtils.isNullOrEmpty(userName)) {
                   sql.append(" and u.userName like ?");
                   list.add("%" + userName + "%");
               }
               if (userRole > 0) {
                   sql.append(" and r.id = ?");
                   list.add(userRole);
               }
               Object[] params = list.toArray();
               rs = BaseDao.execute(con, ps, rs, sql.toString(), params);
               if (rs.next()) {
                   count = rs.getInt("count");
               }
               BaseDao.closeResource(ps, rs);
           }
           return count;
       }
   ```

3. UserService

   ```java
       /**
        * æŸ¥è¯¢è®°å½•æ•°
        * @param userName
        * @param userRole
        * @return
        */
       int getUserCount(String userName, int userRole);
   ```

4. UserServiceImpl

   ```java
       public int getUserCount(String userName, int userRole) {
           Connection con = null;
           int count = 0;
           try {
               con = BaseDao.getConnection();
               count = userDao.getUserCount(con, userName, userRole);
           } catch (SQLException e) {
               e.printStackTrace();
           } finally {
               BaseDao.closeResource(con);
           }
           return count;
       }
   ```



## è·å–ç”¨æˆ·åˆ—è¡¨

1. UserDao

   ```java
       /**
        * è·å–ç”¨æˆ·åˆ—è¡¨
        *
        * @param con
        * @param userName
        * @param userRole
        * @param currentPageNo
        * @param pageSize
        * @return
        * @throws SQLException
        */
       List<User> getUserList(Connection con, String userName, int userRole, int currentPageNo, int pageSize) throws SQLException;
   
   ```

   

2. UserDaoImpl

   ```java
       public List<User> getUserList(Connection con, String userName, int userRole, int currentPageNo, int pageSize) throws SQLException {
           PreparedStatement ps = null;
           ResultSet rs = null;
           List<User> userList = new ArrayList<User>();
           if (con != null) {
               StringBuffer sql = new StringBuffer("select u.*,r.roleName as `userRoleName` from smbms_user u,smbms_role r where u.userRole=r.id");
               List<Object> list = new ArrayList<Object>();
               if (!StringUtils.isNullOrEmpty(userName)) {
                   sql.append(" and u.userName like ?");
                   list.add("%" + userName + "%");
               }
               if (userRole > 0) {
                   sql.append(" and r.id = ?");
                   list.add(userRole);
               }
               //mysql åˆ†é¡µä½¿ç”¨limit startIndex, pageSize
               //æ¯”å¦‚ç°åœ¨ä¸€å…±13æ¡æ•°æ®ï¼Œæ¯é¡µæœ€å¤§å®¹é‡æ˜¯5
               //0,5 01234 ç¬¬ä¸€é¡µ
               //5,5 56789 ç¬¬äºŒé¡µ
               //10,3 10,11,12 ç¬¬ä¸‰é¡µ
               sql.append(" order by u.creationDate desc limit ?,?");
               currentPageNo = (currentPageNo - 1) * pageSize;
               list.add(currentPageNo);
               list.add(pageSize);
               Object[] params = list.toArray();
               rs = BaseDao.execute(con, ps, rs, sql.toString(), params);
               while (rs.next()) {
                   User user = new User();
                   user.setId(rs.getInt("id"));
                   user.setUserCode(rs.getString("userCode"));
                   user.setUserName(rs.getString("userName"));
                   user.setGender(rs.getInt("gender"));
                   user.setBirthday(rs.getDate("birthday"));
                   user.setPhone(rs.getString("phone"));
                   user.setUserRole(rs.getInt("userRole"));
                   user.setUserRoleName(rs.getString("userRoleName"));
                   userList.add(user);
               }
               BaseDao.closeResource(ps, rs);
   
           }
           return userList;
       }
   ```

3. UserService

   ```java
       /**
        * æ ¹æ®æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
        *
        * @param queryUserName
        * @param queryUserRole
        * @param currentPageNo
        * @param pageSize
        * @return
        */
       List<User> getUserList(String queryUserName, int queryUserRole, int currentPageNo, int pageSize);
   ```

   

4. UserServiceImpl

   ```java
       public List<User> getUserList(String queryUserName, int queryUserRole, int currentPageNo, int pageSize) {
           Connection con = null;
           List<User> userList = null;
           try {
               con = BaseDao.getConnection();
               userList = userDao.getUserList(con, queryUserName, queryUserRole, currentPageNo, pageSize);
           } catch (SQLException e) {
               e.printStackTrace();
           } finally {
               BaseDao.closeResource(con);
           }
           return userList;
   ```

   



# 36.smbmsç”¨æˆ·ç®¡ç†åˆ†é¡µok

## è·å–è§’è‰²æ“ä½œ

ä¸ºäº†æˆ‘ä»¬èŒè´£ç»Ÿä¸€ï¼Œå¯ä»¥æŠŠè§’è‰²çš„æ“ä½œå•ç‹¬æ”¾åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå’ŒPOJOç±»å¯¹åº”

![image-20220210212006026](https://typora-picture1234.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20220210212006026.png)

1. RoleDao

   ```java
   package com.zyy.dao.role;
   
   import com.zyy.pojo.Role;
   
   import java.sql.Connection;
   import java.sql.SQLException;
   import java.util.List;
   
   /**
    * @InterfaceName: RoleDao
    * @Description: TODO æ¥å£æè¿°
    * @Author: zyy
    * @Date: 2022/02/10 21:10
    * @Version: 1.0
    */
   public interface RoleDao {
   
       /**
        * è·å–è§’è‰²åˆ—è¡¨
        * @param con
        * @return
        * @throws SQLException
        */
       List<Role> getRoleList(Connection con) throws SQLException;
   }
   ```

   

2. RoleDaoImpl

   ```java
   package com.zyy.dao.role.impl;
   
   import com.zyy.dao.BaseDao;
   import com.zyy.dao.role.RoleDao;
   import com.zyy.pojo.Role;
   
   import java.sql.Connection;
   import java.sql.PreparedStatement;
   import java.sql.ResultSet;
   import java.sql.SQLException;
   import java.util.ArrayList;
   import java.util.List;
   
   /**
    * @ClassName: RoleDaoImpl
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2022/02/10 21:10
    * @Version: 1.0
    */
   public class RoleDaoImpl implements RoleDao {
       public List<Role> getRoleList(Connection con) throws SQLException {
           PreparedStatement ps = null;
           ResultSet rs = null;
           List<Role> roleList = new ArrayList<Role>();
           if (con != null) {
               String sql = "select id, roleName, roleCode from smbms_role";
               Object[] params = {};
               rs = BaseDao.execute(con, ps, rs, sql, params);
               while (rs.next()) {
                   Role role = new Role();
                   role.setId(rs.getInt("id"));
                   role.setRoleCode(rs.getString("roleCode"));
                   role.setRoleName(rs.getString("roleName"));
                   roleList.add(role);
               }
           }
           return roleList;
       }
   }
   ```

   

3. RoleService

   ```java
   package com.zyy.service.role;
   
   import com.zyy.pojo.Role;
   
   import java.util.List;
   
   /**
    * @InterfaceName: RoleService
    * @Description: TODO æ¥å£æè¿°
    * @Author: zyy
    * @Date: 2022/02/10 21:12
    * @Version: 1.0
    */
   public interface RoleService {
       /**
        * è·å–è§’è‰²åˆ—è¡¨
        * @return
        */
       List<Role> getRoleList();
   }
   
   ```

   

4. RoleServiceImpl

   ```java
   package com.zyy.service.role.impl;
   
   import com.zyy.dao.BaseDao;
   import com.zyy.dao.role.RoleDao;
   import com.zyy.dao.role.impl.RoleDaoImpl;
   import com.zyy.pojo.Role;
   import com.zyy.service.role.RoleService;
   
   import java.sql.Connection;
   import java.sql.SQLException;
   import java.util.List;
   
   /**
    * @ClassName: RoleServiceImpl
    * @Description: TODO ç±»æè¿°
    * @Author: zyy
    * @Date: 2022/02/10 21:13
    * @Version: 1.0
    */
   public class RoleServiceImpl implements RoleService {
       private RoleDao roleDao;
   
       public RoleServiceImpl() {
           roleDao = new RoleDaoImpl();
       }
   
   
       public List<Role> getRoleList() {
           Connection con = null;
           List<Role> roleList = null;
           try {
               con = BaseDao.getConnection();
               roleList = roleDao.getRoleList(con);
           } catch (SQLException e) {
               e.printStackTrace();
           } finally {
               BaseDao.closeResource(con);
           }
           return roleList;
       }
   }
   
   ```

## ç”¨æˆ·æ˜¾ç¤ºçš„servlet

1. è·å–ç”¨æˆ·å‰ç«¯çš„æ•°æ®ï¼ˆæŸ¥è¯¢ï¼‰

2. åˆ¤æ–­è¯·æ±‚æ˜¯å¦éœ€è¦æ‰§è¡Œï¼Œçœ‹å‚æ•°çš„å€¼åˆ¤æ–­

3. ä¸ºäº†å®ç°åˆ†é¡µï¼Œéœ€è¦è®¡ç®—å‡ºå½“å‰é¡µé¢å’Œæ€»é¡µæ•°ï¼Œé¡µé¢å¤§å°ã€‚ã€‚

4. ç”¨æˆ·åˆ—è¡¨å±•ç¤º

5. è¿”å›å‰ç«¯

   ```java
   
       protected void query(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           //è·å–å…¥å‚
           String queryName = req.getParameter("queryname");
           String temp = req.getParameter("queryUserRole");
           String pageIndex = req.getParameter("pageIndex");
           //è§’è‰²
           int queryUserRole = 0;
           //æ¯é¡µæœ€å¤§å®¹é‡å¯ä»¥å‰ç«¯ä¼ å…¥ï¼Œä¹Ÿå¯ä»¥å†™æˆé…ç½®é¡¹ï¼Œè¿™é‡Œæš‚æ—¶å†™æ­»
           int pageSize = 5;
           int currentPageNo = 1;
           //å‚æ•°å¤„ç†
           if (temp != null && temp.length() > 0) {
               queryUserRole = Integer.parseInt(temp);
           }
           if (pageIndex != null && pageIndex.length() > 0) {
               currentPageNo = Integer.parseInt(pageIndex);
           }
   
           UserService userService = new UserServiceImpl();
           //è·å–ç”¨æˆ·æ€»æ•°(ä¸Šä¸€é¡µï¼Œä¸‹ä¸€é¡µ)
           int totalCount = userService.getUserCount(queryName, queryUserRole);
           //æ€»é¡µæ•°æ”¯æŒ
           PageSupport pageSupport = new PageSupport();
           pageSupport.setCurrentPageNo(currentPageNo);
           pageSupport.setPageSize(pageSize);
           pageSupport.setTotalCount(totalCount);
   
           int totalPageCount = pageSupport.getTotalPageCount();
           //æ§åˆ¶é¦–é¡µå’Œå°¾é¡µ
           if (currentPageNo < 0) {
               currentPageNo = 0;
           } else if (currentPageNo > totalPageCount) {
               currentPageNo = totalPageCount;
           }
           //æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
           List<User> userList = userService.getUserList(queryName, queryUserRole, currentPageNo, pageSize);
           //è·å–è§’è‰²åˆ—è¡¨
           RoleService roleService = new RoleServiceImpl();
           List<Role> roleList = roleService.getRoleList();
   
   
           req.setAttribute("userList", userList);
           req.setAttribute("roleList", roleList);
           req.setAttribute("totalCount", totalCount);
           req.setAttribute("currentPageNo", currentPageNo);
           req.setAttribute("totalPageCount", totalPageCount);
           req.setAttribute("queryUserName", queryName);
           req.setAttribute("queryUserRole", queryUserRole);
   
           req.getRequestDispatcher("userlist.jsp").forward(req, resp);
       }
   ```

   

# 37.smbmsæ¶æ„åˆ†æåŠæ–¹æ³•



# 38.æ–‡ä»¶ä¼ è¾“åŸç†åŠä»‹ç»



# 39.æ–‡ä»¶ä¸Šä¼ åŠæ‹“å±•é¸¡æ±¤
å¯¼åŒ…

commons-fileupload-1.4.jar

commons-io-2.11.0.jar



index.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
  <title>$Title$</title>
</head>
<body>
<form action="${pageContext.request.contextPath}/upload.do" enctype="multipart/form-data" method="post">
  ä¸Šä¼ ç”¨æˆ·ï¼š<input type="text" name="username"><br/>
  <p><input type="file" name="file1"></p>
  <p><input type="file" name="file2"></p>
  <p><input type="submit"> | <input type="reset"></p>
</form>

</body>
</html>
```

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    <servlet>
        <servlet-name>FileServlet</servlet-name>
        <servlet-class>com.zyy.servlet.FileServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>FileServlet</servlet-name>
        <url-pattern>/upload.do</url-pattern>
    </servlet-mapping>
</web-app>
```

FileServlet.java

```java
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.ProgressListener;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;
import java.util.UUID;

public class FileServlet extends HttpServlet {
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //åˆ¤æ–­ä¸Šä¼ çš„è¡¨å•æ˜¯æ™®é€šè¡¨å•è¿˜æ˜¯æ–‡ä»¶è¡¨å•
        if (!ServletFileUpload.isMultipartContent(request)) {
            //ç»ˆæ­¢æ–¹æ³•è¿è¡Œï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„è¡¨å•ï¼Œç›´æ¥è¿”å›
            return;
        }
        //åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œå»ºè®®åœ¨web-infè·¯å¾„ä¸‹ï¼Œå®‰å…¨ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶
        String uploadPath = this.getServletContext().getRealPath("/WEB-INF/upload");
        File uploadFile = new File(uploadPath);
        if (!uploadFile.exists()) {
            uploadFile.mkdir();
        }

        //ä¸´æ—¶æ–‡ä»¶
        //ä¸´æ—¶è·¯å¾„ï¼Œå‡å¦‚æ–‡ä»¶è¶…è¿‡äº†é¢„æœŸçš„å¤§å°ï¼Œæˆ‘ä»¬å°±æŠŠä»–æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè¿‡å‡ å¤©è‡ªåŠ©åˆ é™¤ï¼Œæˆ–è€…æé†’ç”¨æˆ·è½¬å­˜ä¸ºæ°¸ä¹…
        String tempPath = this.getServletContext().getRealPath("/WEB-INF/temp");
        File tempFile = new File(tempPath);
        if (!tempFile.exists()) {
            tempFile.mkdir();
        }
        //å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½éœ€è¦é€šè¿‡æµæ¥è·å–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨request.getInputStream()ï¼ŒåŸç”Ÿæ€çš„æ–‡ä»¶ä¸Šä¼ æµè·å–ï¼Œååˆ†éº»çƒ¦
        //ä½†æ˜¯æˆ‘ä»¬éƒ½æ˜¯å»ºè®®ä½¿ç”¨Apacheçš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ¥å®ç°ï¼Œcommon-fileuploadï¼Œå®ƒéœ€è¦ä¾èµ–äºcommons-ioç»„ä»¶

        //1.åˆ›å»ºDiskFileItemFactoryå¯¹è±¡,å¤„ç†æ–‡ä»¶è·¯å¾„ä¸Šä¼ æˆ–è€…å¤§å°é™åˆ¶çš„
        DiskFileItemFactory factory = createDiskFileItemFactory(tempFile);
        //2.è·å–ServletFileUpload
        ServletFileUpload upload = creatServletFileUpload(factory);
        //3.å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        String msg = uploadFile(request, uploadPath, upload);

        //è½¬å‘
        request.setAttribute("msg", msg);
        request.getRequestDispatcher("/info.jsp").forward(request, response);

    }

    private String uploadFile(HttpServletRequest request, String uploadPath, ServletFileUpload upload) throws IOException {
        String msg = "";
        //æŠŠå‰ç«¯è¯·æ±‚è§£æï¼Œå°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡ï¼Œéœ€è¦ä»ServletFileUploadå¯¹è±¡ä¸­è·å–
        try {
            List<FileItem> fileItems = upload.parseRequest(request);
            for (FileItem fileItem : fileItems) {
                if (fileItem.isFormField()) {
                    String fieldName = fileItem.getFieldName();
                    //å¤„ç†ä¹±ç 
                    String value = fileItem.getString("UTF-8");
                    System.out.println(fieldName + ":" + value);
                } else {
                    //æ–‡ä»¶
                    //===========å¤„ç†æ–‡ä»¶============
                    String uploadFileName = fileItem.getName();
                    System.out.println("uploadFileName:" + uploadFileName);
                    //å¯èƒ½å­˜åœ¨æ–‡ä»¶åä¸åˆæ³•çš„æƒ…å†µ
                    if (uploadFileName == null || "".equals(uploadFileName.trim())) {
                        continue;
                    }
                    //è·å–ä¸Šä¼ çš„æ–‡ä»¶å
                    String fileName = uploadFileName.substring(uploadFileName.lastIndexOf("/") + 1);
                    //è·å–æ–‡ä»¶çš„åç¼€å
                    String fileExtName = uploadFileName.substring(uploadFileName.lastIndexOf(".") + 1);
                    //å¦‚æœæ–‡ä»¶åç¼€åfileExtNameä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œå°±ç›´æ¥return,ä¸å¤„ç†ï¼Œå‘Šè¯‰ç”¨æˆ·æ–‡ä»¶ç±»å‹ä¸å¯¹

                    //å¯ä»¥ä½¿ç”¨UUIDï¼ˆç»Ÿä¸€è¯†åˆ«çš„é€šç”¨ç ï¼‰ï¼Œä¿è¯æ–‡ä»¶åå”¯ä¸€
                    //UUID.randomUUID() éšæœºç”Ÿä¸€ä¸ªå”¯ä¸€è¯†åˆ«çš„é€šç”¨ç 
                    //ç½‘ç»œä»ä¼ è¾“ä¸­çš„ä¸œè¥¿ï¼Œéƒ½éœ€è¦åºåˆ—åŒ–
                    //implements java.io.Serializable æ ‡è®°æ¥å£  æœ¬åœ°æ–¹æ³•æ ˆ--ã€‹C++
                    String uuidPath = UUID.randomUUID().toString();

                    //===========å­˜æ”¾åœ°å€============
                    String realPath = uploadPath + "/" + uuidPath;
                    File realPathFile = new File(realPath);
                    if (!realPathFile.exists()) {
                        realPathFile.mkdir();
                    }
                    //===========æ–‡ä»¶ä¼ è¾“============
                    InputStream inputStream = fileItem.getInputStream();
                    FileOutputStream fos = new FileOutputStream(realPath + "/" + fileName);
                    byte[] buffer = new byte[1024 * 1024];
                    int len = 0;
                    while ((len = inputStream.read(buffer)) > 0) {
                        fos.write(buffer, 0, len);
                    }
                    fos.close();
                    inputStream.close();
                    msg = "ä¸Šä¼ æˆåŠŸ~";
                }
            }
        } catch (FileUploadException e) {
            e.printStackTrace();
            msg = "ä¸Šä¼ å¤±è´¥~";
        }
        return msg;
    }

    private ServletFileUpload creatServletFileUpload(DiskFileItemFactory factory) {
        ServletFileUpload upload = new ServletFileUpload(factory);
        //ç›‘å¬æ–‡ä»¶ä¸Šä¼ è¿›åº¦
        upload.setProgressListener(new ProgressListener() {
            /**
             *
             * @param pBytesRead å·²ç»è¯»å–åˆ°çš„æ–‡ä»¶å¤§å°
             * @param pContentLength æ–‡ä»¶æ€»å¤§å°
             * @param pItems
             */
            @Override
            public void update(long pBytesRead, long pContentLength, int pItems) {
                System.out.println("æ€»å¤§å°ï¼š" + pContentLength + "å·²ç»ä¸Šä¼ ï¼š" + pBytesRead);
            }
        });
        //å¤„ç†ä¹±ç é—®é¢˜
        upload.setHeaderEncoding("UTF-8");
        //è®¾ç½®å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å€¼
        upload.setFileSizeMax(1020 * 1024 * 10);
        //è®¾ç½®æ€»å…±èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶çš„å¤§å°
        //1020 = 1kb * 1024 = 1M * 10 = 10M
        upload.setSizeMax(1020 * 1024 * 10);
        return upload;
    }

    private DiskFileItemFactory createDiskFileItemFactory(File tempFile) {
        DiskFileItemFactory factory = new DiskFileItemFactory();
        //é€šè¿‡è¿™ä¸ªå·¥å‚è®¾ç½®ä¸€ä¸ªç¼“å†²åŒºï¼Œå½“ä¸Šä¼ çš„æ–‡ä»¶å¤§äºè¿™ä¸ªç¼“å†²åŒºçš„æ—¶å€™ï¼Œå°†ä»–æ”¾åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­
        //ç¼“å†²åŒºå¤§å°ä¸º1M
        factory.setSizeThreshold(1024 * 1024);
        //ä¸´æ—¶ç›®å½•çš„ä¿å­˜ç›®å½•
        factory.setRepository(tempFile);
        return factory;
    }

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }
}
```

# 40.é‚®ä»¶å‘é€åŸç†åŠå®ç°

<img src="D:\ç®—æ³•Typora\picture\image-20220801210415541.png" alt="image-20220801210415541" style="zoom:67%;" />

1. éœ€è¦å¯¼åŒ…

   activation-1.1.1.jar

   mail-1.4.7.jar

2. ç¼–å†™ä»£ç 

   ```java
   import com.sun.mail.util.MailSSLSocketFactory;
   
   import javax.mail.Authenticator;
   import javax.mail.Message;
   import javax.mail.PasswordAuthentication;
   import javax.mail.Session;
   import javax.mail.Transport;
   import javax.mail.internet.InternetAddress;
   import javax.mail.internet.MimeMessage;
   import java.util.Properties;
   
   /**
    * @ClassName: MailDemo01
    * @Description: å‘é€ä¸€ä¸ªç®€å•é‚®ä»¶
    * @Author: zyy
    * @Date: 2022/02/26 16:06
    * @Version: 1.0
    */
   public class MailDemo01 {
       public static void main(String[] args) throws Exception {
   
           Properties properties = new Properties();
           //è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
           properties.setProperty("mail.host", "smtp.qq.com");
           //é‚®ä»¶å‘é€åè®®
           properties.setProperty("mail.transport.protocol", "smtp");
           //éœ€è¦éªŒè¯ç”¨æˆ·åå¯†ç 
           properties.setProperty("mail.smtp.auth", "true");
   
           //å…³äºQQé‚®ç®±ï¼Œè¿˜éœ€è¦è®¾ç½®SSLåŠ å¯†ï¼ŒåŠ ä¸Šä»¥ä¸‹ä»¥ä¸‹ä»£ç å³å¯
           MailSSLSocketFactory sf = new MailSSLSocketFactory();
           sf.setTrustAllHosts(true);
           properties.put("mail.smtp.ssl.enable", "true");
           properties.put("mail.smtp.ssl.socketFactory", sf);
   
           //ä½¿ç”¨javaMailå‘é€é‚®ä»¶çš„5ä¸ªæ­¥éª¤
           //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¯å¢ƒä¿¡æ¯çš„Sessionå¯¹è±¡
           Session session = Session.getDefaultInstance(properties, new Authenticator() {
               @Override
               protected PasswordAuthentication getPasswordAuthentication() {
                   //å‘ä»¶äººé‚®ä»¶ç”¨æˆ·åã€æˆæƒç 
                   return new PasswordAuthentication("2550705615@qq.com", "æˆæƒç ");
               }
           });
           //--å¼€å¯debugæ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€emailçš„è¿è¡ŒçŠ¶æ€
           session.setDebug(true);
           //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
           Transport ts = session.getTransport();
           //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨
           ts.connect("smtp.qq.com", "2550705615@qq.com", "æˆæƒç ");
           //4.åˆ›å»ºé‚®ä»¶
           MimeMessage message = new MimeMessage(session);
           //--é‚®ä»¶çš„å‘ä»¶äºº
           message.setFrom(new InternetAddress("2550705615@qq.com"));
           //--é‚®ä»¶çš„æ”¶ä»¶äºº
           message.setRecipient(Message.RecipientType.TO, new InternetAddress("2550705615@qq.com"));
           //--é‚®ä»¶çš„æ ‡é¢˜
           message.setSubject("hello");
           //--é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
           message.setContent("<h1 style='color: red'>ä½ å¥½å•Š</h1>", "text/html;charset=UTF-8");
           //5.å‘é€é‚®ä»¶
           ts.sendMessage(message, message.getAllRecipients());
           //6.å…³é—­è¿æ¥
           ts.close();
       }
   }
   ```

   ```java
   import com.sun.mail.util.MailSSLSocketFactory;
   
   import javax.activation.DataHandler;
   import javax.activation.FileDataSource;
   import javax.mail.Authenticator;
   import javax.mail.Message;
   import javax.mail.PasswordAuthentication;
   import javax.mail.Session;
   import javax.mail.Transport;
   import javax.mail.internet.InternetAddress;
   import javax.mail.internet.MimeBodyPart;
   import javax.mail.internet.MimeMessage;
   import javax.mail.internet.MimeMultipart;
   import java.util.Properties;
   
   /**
    * @ClassName: MailDemo01
    * @Description: å‘é€ä¸€ä¸ªç®€å•é‚®ä»¶
    * @Author: zyy
    * @Date: 2022/02/26 16:06
    * @Version: 1.0
    */
   public class MailDemo02 {
       public static void main(String[] args) throws Exception {
   
           Properties properties = new Properties();
           //è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
           properties.setProperty("mail.host", "smtp.qq.com");
           //é‚®ä»¶å‘é€åè®®
           properties.setProperty("mail.transport.protocol", "smtp");
           //éœ€è¦éªŒè¯ç”¨æˆ·åå¯†ç 
           properties.setProperty("mail.smtp.auth", "true");
   
           //å…³äºQQé‚®ç®±ï¼Œè¿˜éœ€è¦è®¾ç½®SSLåŠ å¯†ï¼ŒåŠ ä¸Šä»¥ä¸‹ä»¥ä¸‹ä»£ç å³å¯
           MailSSLSocketFactory sf = new MailSSLSocketFactory();
           sf.setTrustAllHosts(true);
           properties.put("mail.smtp.ssl.enable", "true");
           properties.put("mail.smtp.ssl.socketFactory", sf);
   
           //ä½¿ç”¨javaMailå‘é€é‚®ä»¶çš„5ä¸ªæ­¥éª¤
           //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¯å¢ƒä¿¡æ¯çš„Sessionå¯¹è±¡
           Session session = Session.getDefaultInstance(properties, new Authenticator() {
               @Override
               protected PasswordAuthentication getPasswordAuthentication() {
                   //å‘ä»¶äººé‚®ä»¶ç”¨æˆ·åã€æˆæƒç 
                   return new PasswordAuthentication("2550705615@qq.com", "æˆæƒç ");
               }
           });
           //--å¼€å¯debugæ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€emailçš„è¿è¡ŒçŠ¶æ€
           session.setDebug(true);
           //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
           Transport ts = session.getTransport();
           //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨
           ts.connect("smtp.qq.com", "2550705615@qq.com", "æˆæƒç ");
           //4.åˆ›å»ºé‚®ä»¶
           MimeMessage message = new MimeMessage(session);
           //--é‚®ä»¶çš„å‘ä»¶äºº
           message.setFrom(new InternetAddress("2550705615@qq.com"));
           //--é‚®ä»¶çš„æ”¶ä»¶äºº
           message.setRecipient(Message.RecipientType.TO, new InternetAddress("2550705615@qq.com"));
           //--é‚®ä»¶çš„æ ‡é¢˜
           message.setSubject("hello");
           //ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€Šã€Šã€Šã€Šã€Šã€Šã€Šã€Šã€Š
           //å›¾ç‰‡
           MimeBodyPart image = new MimeBodyPart();
           //å›¾ç‰‡éœ€è¦æ•°æ®å¤„ç†  DataHandler
           DataHandler dh = new DataHandler(new FileDataSource("src/resources/bz.jpg"));
           image.setDataHandler(dh);
           //ç»™å›¾ç‰‡è®¾ç½®ä¸€ä¸ªid
           image.setContentID("bz.jpg");
   
           //æ–‡æœ¬
           MimeBodyPart text = new MimeBodyPart();
           text.setContent("è¿™æ˜¯ä¸€å°é‚®ä»¶å¸¦å›¾ç‰‡<img src='cid:bz.jpg'/>çš„é‚®ä»¶","text/html;charset=UTF-8");
           //æ•´åˆ
           MimeMultipart mm = new MimeMultipart();
           mm.addBodyPart(text);
           mm.addBodyPart(image);
           mm.setSubType("related");
   
           //æ”¾åˆ°æ¶ˆæ¯ä¸­ï¼Œä¿å­˜ä¿®æ”¹
           message.setContent(mm);
           message.saveChanges();;
           //ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€‹ã€Šã€Šã€Šã€Šã€Šã€Šã€Šã€Šã€Š
           //5.å‘é€é‚®ä»¶
           ts.sendMessage(message, message.getAllRecipients());
           //6.å…³é—­è¿æ¥
           ts.close();
       }
   }
   ```

   

# 41.ç½‘ç«™æ³¨å†Œå‘é€é‚®ä»¶å®ç°

pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.zyy</groupId>
    <artifactId>webMail</artifactId>
    <version>1.0-SNAPSHOT</version>


    <dependencies>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
        </dependency>
        <dependency>
            <groupId>javax.mail</groupId>
            <artifactId>mail</artifactId>
            <version>1.4.7</version>
        </dependency>
        <dependency>
            <groupId>javax.activation</groupId>
            <artifactId>activation</artifactId>
            <version>1.1.1</version>
        </dependency>
    </dependencies>
</project>
```



index.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>æ³¨å†Œ</title>
</head>
<body>
<form action="${pageContext.request.contextPath}/registerServlet.do" method="post">
    ç”¨æˆ·åï¼š<input type="text" name="userName"/><br/>
    å¯†ç ï¼š<input type="password" name="password"/><br/>
    é‚®ç®±ï¼š<input type="text" name="email"/><br/>
    <input type="submit" value="æ³¨å†Œ"/>
</form>
</body>
</html>
```

info.jsp

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
${message}

</body>
</html>
```

web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    <servlet-mapping>
        <servlet-name>registerServlet</servlet-name>
        <url-pattern>/registerServlet.do</url-pattern>
    </servlet-mapping>
    <servlet>
        <servlet-name>registerServlet</servlet-name>
        <servlet-class>com.zyy.servlet.RegisterServlet</servlet-class>
    </servlet>
</web-app>
```

User.java

```java
import java.io.Serializable;

/**
 * @ClassName: User
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2022/02/26 23:53
 * @Version: 1.0
 */
public class User implements Serializable {
    private String userName;
    private String password;
    private String email;

    public User() {
    }

    public User(String userName, String password, String email) {
        this.userName = userName;
        this.password = password;
        this.email = email;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @Override
    public String toString() {
        return "User{" +
                "userName='" + userName + '\'' +
                ", password='" + password + '\'' +
                ", email='" + email + '\'' +
                '}';
    }
}
```

RegisterServlet.java

```java
import com.zyy.pojo.User;
import com.zyy.util.SendMail;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class RegisterServlet extends HttpServlet {
    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //æ¥å—ç”¨æˆ·è¯·æ±‚ï¼Œå°è£…æˆå¯¹è±¡
        String userName = request.getParameter("userName");
        String password = request.getParameter("password");
        String email = request.getParameter("email");

        User user = new User(userName, password, email);
        SendMail sendMail = new SendMail(user);
        sendMail.run();

        request.setAttribute("message", "å‘é€æˆåŠŸ");
        request.getRequestDispatcher("info.jsp").forward(request, response);
    }

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    }
}
```

SendMail.java

```java
import com.sun.mail.util.MailSSLSocketFactory;
import com.zyy.pojo.User;

import javax.mail.Authenticator;
import javax.mail.Message;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.util.Properties;

/**
 * @ClassName: SendMail
 * @Description: TODO ç±»æè¿°
 * @Author: zyy
 * @Date: 2022/02/26 23:59
 * @Version: 1.0
 */
public class SendMail extends Thread {

    private String from = "2550705615@qq.com";
    private String userName = "2550705615@qq.com";
    private String password = "æˆæƒç ";
    private String host = "smtp.qq.com";
    private User user;

    public SendMail(User user) {
        this.user = user;
    }

    @Override
    public void run() {
        try {
            Properties properties = new Properties();
            //è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
            properties.setProperty("mail.host", host);
            //é‚®ä»¶å‘é€åè®®
            properties.setProperty("mail.transport.protocol", "smtp");
            //éœ€è¦éªŒè¯ç”¨æˆ·åå¯†ç 
            properties.setProperty("mail.smtp.auth", "true");

            //å…³äºQQé‚®ç®±ï¼Œè¿˜éœ€è¦è®¾ç½®SSLåŠ å¯†ï¼ŒåŠ ä¸Šä»¥ä¸‹ä»¥ä¸‹ä»£ç å³å¯
            MailSSLSocketFactory sf = new MailSSLSocketFactory();
            sf.setTrustAllHosts(true);
            properties.put("mail.smtp.ssl.enable", "true");
            properties.put("mail.smtp.ssl.socketFactory", sf);

            //ä½¿ç”¨javaMailå‘é€é‚®ä»¶çš„5ä¸ªæ­¥éª¤
            //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¯å¢ƒä¿¡æ¯çš„Sessionå¯¹è±¡
            Session session = Session.getDefaultInstance(properties, new Authenticator() {
                @Override
                protected PasswordAuthentication getPasswordAuthentication() {
                    //å‘ä»¶äººé‚®ä»¶ç”¨æˆ·åã€æˆæƒç 
                    return new PasswordAuthentication(from, password);
                }
            });
            //--å¼€å¯debugæ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€emailçš„è¿è¡ŒçŠ¶æ€
            session.setDebug(true);
            //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
            Transport ts = session.getTransport();
            //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨
            ts.connect(host, from, password);
            //4.åˆ›å»ºé‚®ä»¶
            MimeMessage message = new MimeMessage(session);
            //--é‚®ä»¶çš„å‘ä»¶äºº
            message.setFrom(new InternetAddress(userName));
            //--é‚®ä»¶çš„æ”¶ä»¶äºº
            message.setRecipient(Message.RecipientType.TO, new InternetAddress(userName));
            //--é‚®ä»¶çš„æ ‡é¢˜
            message.setSubject("hello");
            //--é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
            message.setContent("<h1 style='color: red'>ä½ å¥½å•Š</h1>", "text/html;charset=UTF-8");
            //5.å‘é€é‚®ä»¶
            ts.sendMessage(message, message.getAllRecipients());
            //6.å…³é—­è¿æ¥
            ts.close();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }
}
```

æ³¨æ„ï¼šspringæ¡†æ¶å¯ä»¥ç”¨JavaMailSenderImplå®ç°

# 42.ä¹‹åè¯¥æ€ä¹ˆæŒç»­å­¦ä¹ 